<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>The Golo Programming Language</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6c818f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #444444; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #111111; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-weight: bold; font-style: normal; color: #465158; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #909ea7; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; color: #444444; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #748590; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #748590; }

blockquote, blockquote p { line-height: 1.5; color: #909ea7; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 0 #dddddd; }
table thead, table tfoot { background: none; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: none; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.95em; font-style: normal !important; letter-spacing: 0; padding: 0; background-color: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; line-height: inherit; }

pre, pre > code { line-height: 1.2; color: inherit; font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; }

.keyseq { color: #333333; }

kbd { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #373737; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #111111; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #748590; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #909ea7; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #909ea7; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #111111; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6c818f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: black; padding: 1.25em; }

#footer-text { color: white; line-height: 1.35; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #465158; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #3b444a; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #111111; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #748590; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6c818f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 6px; border-radius: 6px; word-wrap: break-word; padding: 0.5em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: inherit; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.5em; -webkit-border-radius: 6px; border-radius: 6px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #909ea7; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6c818f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #748590; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #909ea7; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #748590; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 0 0 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 0 0 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 0 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 0 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 0 0 0 0; }

table.frame-all { border-width: 0; }

table.frame-sides { border-width: 0 0; }

table.frame-topbot { border-width: 0 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.5; background: none; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #333333; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h4 { color: #6c818f; }

.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 6px; border-radius: 6px; margin-left: 2em; margin-right: 2em; }

.admonitionblock { margin-left: 2em; margin-right: 2em; }
.admonitionblock > table { border: 1px solid #609060; border-top-width: 1.5em; background-color: #e9ffe9; border-collapse: separate; -webkit-border-radius: 0; border-radius: 0; }
.admonitionblock > table td.icon { padding-top: .5em; padding-bottom: .5em; }
.admonitionblock > table td.content { padding: .5em 1em; color: black; font-size: .9em; border-left: none; }

.sidebarblock { background-color: #e8ecef; border-color: #ccc; }
.sidebarblock > .content > .title { color: #444444; }

table.tableblock.grid-all { border-collapse: collapse; -webkit-border-radius: 0; border-radius: 0; }
table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock { border-bottom: 1px solid #aaa; }

#footer { background-color: #465158; padding: 2em; }

#footer-text { color: #eee; font-size: 0.8em; text-align: center; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="icon"
      href="data:image/x-icon;base64,AAABAAEAFBQAAAEAIAC4BgAAFgAAACgAAAAUAAAAKAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmd/wAAAAAAmZmZDaWlpUSpqalbqampWqWlpT6SkpIF
AAAAAAOW9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaX9AAAAAAApaWlOqCgoMmF
hYX/a2tr/1tbW/9ZWVn/aGho/4ODg/+goKC0paWlJgAAAAAAjvEAAAAAAAAAAAAAAAAAAAAAAAAA
AAAImfQAAAAAAKWlpZ56enr/QEBA/0NDQ/9ERET/Q0ND/0NDQ/9ERET/Q0ND/0FBQf+Dg4P/qKio
eQAAAAAHlvEAAAAAAAAAAAAAAAAADJnzAAAAAACjo6PBU1NT/0ZGRv9ERET/UVFR/2lpaf9/f3//
fn5+/2ZmZv9NTU3/RUVF/0RERP9paWn/p6enmgAAAAAAgP8AAAAAAAAAAAAAAAAAqampmVVVVf9J
SUn/SkpK/4eHh/+pqanwpqamrKOjo2akpKRtpqamuqqqqvhzc3P/R0dH/0hISP9vb2//qqqqagAA
AAAAAAAAHpT3AKioqC97e3v/SkpK/0pKSv+cnJz/p6enqgAAAAAAAAAAAAAAAACA/wAAAAAAAAAA
AKioqM+Dg4P/SUlJ/0ZGRv+Tk5P/pKSkCA+d9AAAAAAAra2tuUtLS/9LS0v/h4eH/6enp6QAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAJofYAAAAAAKurq9NnZ2f/TExM/15eXv+tra2MAAAAAAAAAACP
j4//TU1N/1NTU/+urq7/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASnfQApaWlHJ6e
nv9KSkr/SUlJ/6Ojo+sAAAAAq6urNnl5ef9QUFD/cnJy/66urpwAAAAAAAAAAAAAAAAlSnoAAAAA
AFBQUAIAAAAAAAAAAAAAAAAAAAAAsLCwzFdXV/9PT0//jo6O/6CgoAizs7NVbm5u/1JSUv+BgYH/
r6+vZRea7wAAAAAAAAAAAAAAAABUVFSFVFRU/1NTUyMAAAAAAAAAAAAAAACwsLCXampq/1JSUv+D
g4P/qqqqJLW1tVdwcHD/VVVV/4KCgv+xsbFhF6LoAAAAAAAAAAAAAAAAAFVVVapVVVX/VlZW/1RU
VB8mTn8AAAAAALGxsZNvb2//VVVV/4ODg/+rq6smr6+vQH5+fv9XV1f/cnJy/7KyspAAAAAAAAAA
AAAAAAAySG4AAAAAAFhYWNNXV1f/V1dX/1VVVR0AAAAAs7OzwGRkZP9WVlb/jIyM/6mpqQ+qqqoL
lpaW/1ZWVv9XV1f/tLS08wAAAAAAAAAAAAAAAAAAAAAnT4EAAAAAAFpaWtZZWVn/WVlZ/3BwcCSt
ra3/U1NT/1VVVf+goKD2AAAAAAAAAAC2trbUWlpa/1paWv+Kior/tLS0fQAAAAAAAAAAAAAAAAAA
AAApUoMAAAAAAFxcXNpbW1v+W1tb/nd3d/9bW1v/YWFh/7m5uZ8AAAAAAAAAALW1tVaIiIj/XV1d
/1tbW/+mpqb/tLS0cgAAAAAqrPcAAAAAAAAAAAAtiMUAAAAAAGRkZO9dXV3/XFxc/1xcXP+Tk5P/
sbGxHSSq9AAAAAAAAAAAALe3t8dpaWn/YGBg/2BgYP+ZmZn/ubm53La2tm2xsbEksrKyKbW1tYO0
tLTps7Oz/2hoaP9gYGD/b29v/7m5uZIAAAAAAAAAAAAAAAAprfcAsLCwBbOzs+1mZmb+YmJi/19f
X/9tbW3/mZmZ/7e3t/+2trb/tbW1/7W1tf+1tbX/srKy/5eXl/+0tLTHAAAAACuu9wAAAAAAAAAA
AAAAAAAutf8AtbW1Cra2ttd/f3//X19f/2RkZP9eXl7/uLi4/7a2tv+2trb/tra2/7a2tv+2trb/
uLi4tgAAAAAtrvgAAAAAAAAAAAAAAAAAAAAAAAAAAAAusvkAAAAAAMDAwGesrKz3jIyM/5OTk/+5
ubn/uLi4/7e3t/+5ubn/ubm58Lu7u1YAAAAALrH3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAC/v780vb29arm5uYW5ubmHu7u7bLu7uzQAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAA/gfwAPgB8ADwAPAA4ABwAMAAMACB+BAAg/wQAIf8EAAH3gAAB44AAAeGAAAHwgAA
B+AQAIPwEACB+BAAwAAwAMAAcADgAPAA+AHwAP4H8AA="/>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The Golo Programming Language</h1>
<div class="details">
<span id="revnumber">version 3.4.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_basics">1. Basics</a>
<ul class="sectlevel2">
<li><a href="#_editor_ide_support">1.1. Editor / IDE support</a></li>
<li><a href="#_hello_world">1.2. Hello world</a></li>
<li><a href="#_running_hello_world">1.3. Running <em>"Hello world"</em></a></li>
<li><a href="#_compiling_golo_source_code">1.4. Compiling Golo source code</a></li>
<li><a href="#_running_compiled_golo_code">1.5. Running compiled Golo code</a></li>
<li><a href="#_running_golo_script">1.6. Running Golo script</a></li>
<li><a href="#_passing_jvm_specific_flags">1.7. Passing JVM-specific flags</a></li>
<li><a href="#_bash_autocompletion">1.8. Bash autocompletion</a></li>
<li><a href="#_zsh_autocompletion">1.9. Zsh autocompletion</a></li>
<li><a href="#_comments">1.10. Comments</a></li>
<li><a href="#_variable_and_constant_references">1.11. Variable and constant references</a></li>
<li><a href="#_local_definitions">1.12. Local definitions</a></li>
<li><a href="#_data_literals">1.13. Data literals</a></li>
<li><a href="#_collection_literals">1.14. Collection literals</a></li>
<li><a href="#_collection_comprehension">1.15. Collection comprehension</a></li>
<li><a href="#destructuring">1.16. Destructuring</a></li>
<li><a href="#_operators">1.17. Operators</a></li>
<li><a href="#_calling_a_method">1.18. Calling a method</a></li>
<li><a href="#_java_jvm_arrays">1.19. Java / JVM arrays</a></li>
</ul>
</li>
<li><a href="#_creating_new_projects">2. Creating new project(s)</a>
<ul class="sectlevel2">
<li><a href="#_free_form_project">2.1. Free-form project</a></li>
<li><a href="#_maven_driven_project">2.2. Maven-driven project</a></li>
<li><a href="#_gradle_driven_project">2.3. Gradle-driven project</a></li>
<li><a href="#_version_control">2.4. Version control</a></li>
<li><a href="#_profile">2.5. Profile</a></li>
</ul>
</li>
<li><a href="#_functions">3. Functions</a>
<ul class="sectlevel2">
<li><a href="#_parameter_less_functions">3.1. Parameter-less functions</a></li>
<li><a href="#_functions_with_parameters">3.2. Functions with parameters</a></li>
<li><a href="#_variable_arity_functions">3.3. Variable-arity functions</a></li>
<li><a href="#_named_parameters">3.4. Named parameters</a></li>
<li><a href="#_functions_from_other_modules_and_imports">3.5. Functions from other modules and imports</a></li>
<li><a href="#_local_functions">3.6. Local functions</a></li>
<li><a href="#_recursive_tail_call_optimization">3.7. Recursive Tail Call Optimization</a></li>
<li><a href="#_module_level_state">3.8. Module-level state</a></li>
</ul>
</li>
<li><a href="#_java_interoperability">4. Java interoperability</a>
<ul class="sectlevel2">
<li><a href="#_main_function_java_compliance">4.1. Main function Java compliance</a></li>
<li><a href="#_calling_static_methods">4.2. Calling static methods</a></li>
<li><a href="#_calling_instance_methods">4.3. Calling instance methods</a></li>
<li><a href="#_named_arguments">4.4. Named arguments</a></li>
<li><a href="#warning-deprecate">4.5. Deprecated method</a></li>
<li><a href="#_null_safe_instance_method_invocations">4.6. <code>null</code>-safe instance method invocations</a></li>
<li><a href="#_creating_objects">4.7. Creating objects</a></li>
<li><a href="#_static_fields">4.8. Static fields</a></li>
<li><a href="#_instance_fields">4.9. Instance fields</a></li>
<li><a href="#_properties_support">4.10. Properties support</a></li>
<li><a href="#_inner_classes_and_enumerations">4.11. Inner classes and enumerations</a></li>
<li><a href="#_clashes_with_golo_operators_and_escaping">4.12. Clashes with Golo operators and escaping</a></li>
<li><a href="#_golo_class_loader">4.13. Golo class loader</a></li>
<li><a href="#_primitive_data_types">4.14. Primitive Data Types</a></li>
</ul>
</li>
<li><a href="#_control_flow">5. Control flow</a>
<ul class="sectlevel2">
<li><a href="#_conditional_branching">5.1. Conditional branching</a></li>
<li><a href="#_case_branching">5.2. <code>case</code> branching</a></li>
<li><a href="#match_expressions">5.3. <code>match</code> expressions</a></li>
<li><a href="#_while_loops">5.4. <code>while</code> loops</a></li>
<li><a href="#_for_loops">5.5. <code>for</code> loops</a></li>
<li><a href="#foreach_loops">5.6. <code>foreach</code> loops</a></li>
<li><a href="#_foreach_loops_with_a_guard">5.7. <code>foreach</code> loops with a guard</a></li>
<li><a href="#_break_and_continue">5.8. <code>break</code> and <code>continue</code></a></li>
<li><a href="#_why_no_value_from_most_control_flow_constructions">5.9. Why no value from most control flow constructions?</a></li>
</ul>
</li>
<li><a href="#_exceptions">6. Exceptions</a>
<ul class="sectlevel2">
<li><a href="#_raising_exceptions">6.1. Raising exceptions</a></li>
<li><a href="#_raising_specialized_exceptions">6.2. Raising specialized exceptions</a></li>
<li><a href="#_exception_handling">6.3. Exception handling</a></li>
</ul>
</li>
<li><a href="#_closures">7. Closures</a>
<ul class="sectlevel2">
<li><a href="#_defining_and_using_a_closure">7.1. Defining and using a closure</a></li>
<li><a href="#_compact_closures">7.2. Compact closures</a></li>
<li><a href="#_calling_closures">7.3. Calling closures</a></li>
<li><a href="#_limitations">7.4. Limitations</a></li>
<li><a href="#_closures_to_single_method_interfaces">7.5. Closures to single-method interfaces</a></li>
<li><a href="#_closures_to_java_8_functional_interfaces">7.6. Closures to Java 8 functional interfaces</a></li>
<li><a href="#_direct_closure_passing_works">7.7. Direct closure passing works</a></li>
<li><a href="#_conversion_to_single_method_interfaces">7.8. Conversion to single-method interfaces</a></li>
<li><a href="#_getting_a_reference_to_a_closure_golo_function">7.9. Getting a reference to a closure / Golo function</a></li>
<li><a href="#_binding_and_composing">7.10. Binding and composing</a></li>
<li><a href="#_calling_functions_that_return_functions">7.11. Calling functions that return functions</a></li>
</ul>
</li>
<li><a href="#_predefined_functions">8. Predefined functions</a>
<ul class="sectlevel2">
<li><a href="#_console_output">8.1. Console output</a></li>
<li><a href="#_console_input">8.2. Console input</a></li>
<li><a href="#_file_io">8.3. File I/O</a></li>
<li><a href="#_number_type_conversions">8.4. Number type conversions</a></li>
<li><a href="#_exceptions_2">8.5. Exceptions</a></li>
<li><a href="#_preconditions">8.6. Preconditions</a></li>
<li><a href="#_arrays">8.7. Arrays</a></li>
<li><a href="#_ranges">8.8. Ranges</a></li>
<li><a href="#_closures_2">8.9. Closures</a></li>
<li><a href="#_array_types">8.10. Array types</a></li>
<li><a href="#_misc">8.11. Misc.</a></li>
</ul>
</li>
<li><a href="#_class_augmentations">9. Class augmentations</a>
<ul class="sectlevel2">
<li><a href="#_wrapping_a_string_with_a_function">9.1. Wrapping a string with a function</a></li>
<li><a href="#_augmenting_classes">9.2. Augmenting classes</a></li>
<li><a href="#_augmentation_scopes_reusable_augmentations">9.3. Augmentation scopes, reusable augmentations</a></li>
<li><a href="#_named_augmentations">9.4. Named augmentations</a></li>
<li><a href="#augment_order">9.5. Augmentations Resolution Order</a></li>
<li><a href="#_defining_a_fallback_behavior">9.6. Defining a fallback behavior</a></li>
<li><a href="#_standard_augmentations">9.7. Standard augmentations</a></li>
</ul>
</li>
<li><a href="#structs">10. Structs</a>
<ul class="sectlevel2">
<li><a href="#_definition">10.1. Definition</a></li>
<li><a href="#_jvm_existence">10.2. JVM existence</a></li>
<li><a href="#_tostring_behavior">10.3. <code>toString()</code> behavior</a></li>
<li><a href="#_immutable_structs">10.4. Immutable structs</a></li>
<li><a href="#struct-custom-factories">10.5. Custom factories</a></li>
<li><a href="#_copying">10.6. Copying</a></li>
<li><a href="#_equals_and_hashcode_semantics">10.7. <code>equals()</code> and <code>hashCode()</code> semantics</a></li>
<li><a href="#_comparison_semantics">10.8. Comparison semantics</a></li>
<li><a href="#_helper_methods">10.9. Helper methods</a></li>
<li><a href="#_private_members">10.10. Private members</a></li>
<li><a href="#struct-augmentation">10.11. Augmenting structs</a></li>
</ul>
</li>
<li><a href="#_unions">11. Unions</a>
<ul class="sectlevel2">
<li><a href="#_definition_2">11.1. Definition</a></li>
<li><a href="#_usage_example">11.2. Usage example</a></li>
<li><a href="#_jvm_existence_2">11.3. JVM existence</a></li>
<li><a href="#_special_testing_methods">11.4. Special testing methods</a></li>
<li><a href="#_augmenting_unions">11.5. Augmenting unions</a></li>
</ul>
</li>
<li><a href="#_dynamic_objects">12. Dynamic objects</a>
<ul class="sectlevel2">
<li><a href="#_creating_dynamic_objects">12.1. Creating dynamic objects</a></li>
<li><a href="#_defining_values">12.2. Defining values</a></li>
<li><a href="#_defining_methods">12.3. Defining methods</a></li>
<li><a href="#_querying_the_properties">12.4. Querying the properties</a></li>
<li><a href="#_defining_a_fallback_behavior_2">12.5. Defining a fallback behavior</a></li>
<li><a href="#_kind_of_dynamic_objects">12.6. Kind of dynamic objects</a></li>
</ul>
</li>
<li><a href="#_adapters">13. Adapters</a>
<ul class="sectlevel2">
<li><a href="#_a_simple_example">13.1. A simple example</a></li>
<li><a href="#_implementing_interfaces">13.2. Implementing interfaces</a></li>
<li><a href="#_overrides">13.3. Overrides</a></li>
<li><a href="#_star_implementations_and_overrides">13.4. Star implementations and overrides</a></li>
<li><a href="#_misc_2">13.5. Misc.</a></li>
<li><a href="#_adapters_helper">13.6. Adapters helper</a></li>
</ul>
</li>
<li><a href="#decorators">14. Decorators</a>
<ul class="sectlevel2">
<li><a href="#_presentation">14.1. Presentation</a></li>
<li><a href="#deco_principles">14.2. Principles and syntax</a></li>
<li><a href="#_use_cases_and_examples">14.3. Use cases and examples</a></li>
</ul>
</li>
<li><a href="#_banged_function_call">15. Banged function call</a>
<ul class="sectlevel2">
<li><a href="#_principles_and_syntax">15.1. Principles and syntax</a></li>
<li><a href="#_banged_decorators">15.2. Banged decorators</a></li>
</ul>
</li>
<li><a href="#_dynamic_code_evaluation">16. Dynamic code evaluation</a>
<ul class="sectlevel2">
<li><a href="#_loading_a_module">16.1. Loading a module</a></li>
<li><a href="#_anonymous_modules">16.2. Anonymous modules</a></li>
<li><a href="#_functions_2">16.3. Functions</a></li>
<li><a href="#_running_code">16.4. Running code</a></li>
</ul>
</li>
<li><a href="#_concurrency_with_workers">17. Concurrency with workers</a>
<ul class="sectlevel2">
<li><a href="#_the_big_picture">17.1. The big picture</a></li>
<li><a href="#_worker_environments">17.2. Worker environments</a></li>
<li><a href="#_spawning_a_worker_and_passing_messages">17.3. Spawning a worker and passing messages</a></li>
<li><a href="#_a_complete_and_useless_example">17.4. A complete and useless example</a></li>
</ul>
</li>
<li><a href="#_golo_template_engine">18. Golo template engine</a>
<ul class="sectlevel2">
<li><a href="#_example">18.1. Example</a></li>
<li><a href="#_directives">18.2. Directives</a></li>
</ul>
</li>
<li><a href="#_macros">19. Macros</a>
<ul class="sectlevel2">
<li><a href="#macros-principle">19.1. Principle</a></li>
<li><a href="#_creating_macros">19.2. Creating macros</a></li>
<li><a href="#_using_macros">19.3. Using macros</a></li>
<li><a href="#_some_macro_pitfalls">19.4. Some macro pitfalls</a></li>
<li><a href="#_testing_and_debugging_macros">19.5. Testing and debugging macros</a></li>
<li><a href="#_examples_of_macros">19.6. Examples of macros</a></li>
</ul>
</li>
<li><a href="#_documenting_golo_code">20. Documenting Golo code</a>
<ul class="sectlevel2">
<li><a href="#_documentation_blocks">20.1. Documentation blocks</a></li>
<li><a href="#_package_documentation">20.2. Package documentation</a></li>
<li><a href="#_rendering_documentation">20.3. Rendering documentation</a></li>
<li><a href="#_alignment">20.4. Alignment</a></li>
</ul>
</li>
<li><a href="#_misc_modules">21. Misc. modules</a>
<ul class="sectlevel2">
<li><a href="#_standard_augmentations_gololang_standardaugmentations">21.1. Standard augmentations (<code>gololang.StandardAugmentations</code>)</a></li>
<li><a href="#_json_support_gololang_json">21.2. JSON support (<code>gololang.JSON</code>)</a></li>
<li><a href="#_scala_like_dynamic_variable_gololang_dynamicvariable">21.3. Scala-like dynamic variable (<code>gololang.DynamicVariable</code>)</a></li>
<li><a href="#_observable_references_gololang_observable">21.4. Observable references (<code>gololang.Observable</code>)</a></li>
<li><a href="#_asynchronous_programming_helpers_gololang_async">21.5. Asynchronous programming helpers (<code>gololang.Async</code>)</a></li>
<li><a href="#_lazy_lists_gololang_lazylists">21.6. Lazy lists (<code>gololang.LazyLists</code>)</a></li>
<li><a href="#_console_ansi_codes_gololang_ansicodes">21.7. Console ANSI codes (<code>gololang.AnsiCodes</code>)</a></li>
<li><a href="#_functional_errors_gololang_errors">21.8. Functional errors (<code>gololang.Errors</code>)</a></li>
</ul>
</li>
<li><a href="#_common_pitfalls">22. Common pitfalls</a>
<ul class="sectlevel2">
<li><a href="#_new">22.1. <code>new</code></a></li>
<li><a href="#_imports">22.2. Imports</a></li>
<li><a href="#_method_invocations">22.3. Method invocations</a></li>
<li><a href="#_match_is_not_a_closure">22.4. <code>match</code> is not a closure</a></li>
<li><a href="#_shebang_scans_sub_folders">22.5. Shebang scans sub-folders</a></li>
</ul>
</li>
<li><a href="#_index">23. Index</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is the documentation for the Golo programming language.</p>
</div>
<div class="listingblock">
<div class="title">Copyright and License Notice</div>
<div class="content">
<pre>Copyright (c) 2012-2021 Institut National des Sciences Appliquées de Lyon (INSA Lyon) and others

This program and the accompanying materials are made available under the
terms of the Eclipse Public License 2.0 which is available at
http://www.eclipse.org/legal/epl-2.0.

SPDX-License-Identifier: EPL-2.0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Copyright and License Notice for the short code snippets and samples provided in this documentation.</div>
<div class="content">
<pre>Copyright (c) 2012-2021 Institut National des Sciences Appliquées de Lyon (INSA Lyon) and others

All rights reserved. This Example Content is intended to demonstrate
usage of Eclipse technology. It is provided to you under the terms and
conditions of the Eclipse Distribution License v1.0 which is available
at http://www.eclipse.org/org/documents/edl-v10.php</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basics">1. Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us start with the Golo basics.</p>
</div>
<div class="sect2">
<h3 id="_editor_ide_support">1.1. Editor / IDE support</h3>
<div class="paragraph">
<p>Editor and IDE support for Golo is available for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jponge/vim-golo">Vim</a></p>
</li>
<li>
<p><a href="https://github.com/k33g/sublime-golo">Sublime Text 2 &amp; 3</a></p>
</li>
<li>
<p><a href="https://github.com/k33g/golo-storm">IntelliJ IDEA (syntax highthing)</a></p>
</li>
<li>
<p><a href="https://github.com/golo-lang/gldt">Eclipse</a> (initially contributed by Jeff Maury, currently outdated and seeking for new contributors)</p>
</li>
<li>
<p><a href="https://github.com/golo-lang/golo-netbeans">Netbeans</a> (contributed by <a href="http://www.serli.com/">Serli</a>)</p>
</li>
<li>
<p><a href="https://atom.io/packages/golo-ide">Atom</a> (package golo-ide)</p>
</li>
<li>
<p><a href="https://github.com/zyedidia/micro">Micro</a> (Gololang support for Micro is native)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_hello_world">1.2. Hello world</h3>
<div class="paragraph">
<p>Golo source code need to be placed in <em>modules</em>. Module names are
separated with dots, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">Foo
foo.Bar
foo.bar.Baz
(...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is suggested yet not enforced that the first elements in a module
name are in lowercase, and that the last one have an uppercase first
letter.</p>
</div>
<div class="paragraph">
<p>A Golo module can be executable if it has a <em>function</em> named <code>main</code> and
that takes an argument for the JVM program arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module hello.World

function main = |args| {
  println("Hello world!")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>println</code> is a predefined function that outputs a value to the standard
console. As you can easily guess, here we output <code>Hello, world!</code> and
that is an awesome achievement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Newlines are important in Golo, so make sure that your editor ends files with a newline.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Golo identifiers can be non-ascii characters (e.g., Japanese, Emoji, Arabic, etc).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_running_hello_world">1.3. Running <em>"Hello world"</em></h3>
<div class="paragraph">
<p>Of course, we need to run this incredibly complex application.</p>
</div>
<div class="paragraph">
<p>Golo comes with a <a href="./man/man1/golo.html"><code>golo</code></a> script found in the distribution <code>bin/</code> folder. It provides several
commands, notably:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>version</code> to query the Golo version, and</p>
</li>
<li>
<p><code>compile</code> to compile some Golo code to JVM classes, and</p>
</li>
<li>
<p><code>run</code> to execute some already compiled Golo code, and</p>
</li>
<li>
<p><code>golo</code> to directly execute Golo code from source files, and</p>
</li>
<li>
<p><code>diagnose</code> to print compiler internal diagnosis information, and</p>
</li>
<li>
<p><code>check</code> to check code for compilation errors (e.g. as an editor hook), and</p>
</li>
<li>
<p><code>doc</code> to generate module(s) documentation, and</p>
</li>
<li>
<p><code>new</code> to generate new project(s).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The complete commands usage instructions can be listed by running <code>golo --help</code>.
A command usage instructions can be listed by running <code>golo --usage ${command}</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>golo</code> script comes with JVM tuning settings that may not be appropriate to your
environment. We also provide a <code>vanilla-golo</code> script with no tuning. You may use the <code>$JAVA_OPTS</code>
environment variable to provide custom JVM tuning to <code>vanilla-golo</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Provided that <code>golo</code> is available from your current <code>$PATH</code>, you may run the program above as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo golo --files samples/helloworld.golo
Hello world!
$ golo golo --files samples/ --module hello.World
Hello world!
$</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="./man/man1/golo-golo.html"><code>golo golo</code></a> takes several Golo source files (*.golo and directories) as input.
It expects the last one of them to have a <code>main</code> function to call (or use
<code>--module</code> to define the golo module with the <code>main</code> function).
The Golo code is compiled on the fly and executed straight into a JVM.</p>
</div>
<div class="paragraph">
<p>You may also pass arguments to the <code>main</code> function by appending <code>--args</code>
on the command line invocation. Suppose that we have a module <code>EchoArgs</code>
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module EchoArgs

function main = |args| {
  foreach arg in args {
    println("-&gt;  " + arg)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We may invoke it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo golo --files samples/echo-args.golo --args plop da plop
-&gt; plop
-&gt; da
-&gt; plop
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>args</code> is expected to be an array.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>--classpath</code> flag allows to specify a list of classpath elements, which can be either
directories or <code>.jar</code> files. The system property <code>golo.class.path</code> or the environment variable <code>GOLOPATH</code> can also be used to specify these elements.
See the <code>golo --help</code> command for details on the various Golo commands.</p>
</div>
</div>
<div class="sect2">
<h3 id="_compiling_golo_source_code">1.4. Compiling Golo source code</h3>
<div class="paragraph">
<p>Golo comes with a compiler (<a href="./man/man1/golo-compile.html"><code>compile</code></a> command) that generates JVM bytecode in <code>.class</code> files. We will give more details
in the chapter on interoperability with Java.</p>
</div>
<div class="paragraph">
<p>Compiling Golo files is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo compile --output classes samples/helloworld.golo
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the code found in <code>samples/helloworld.golo</code> and outputs
the generated classes to a <code>classes</code> folder (it will be created if
needed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ tree classes/
classes/
└── hello
    └── World.class

1 directory, 1 file
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to output to a Jar archive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo compile --output hello.jar samples/*.golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would take all <code>.golo</code> files from the <code>sample</code> folder, and assemble the resulting JVM class files in <code>hello.jar</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_compiled_golo_code">1.5. Running compiled Golo code</h3>
<div class="paragraph">
<p>Golo provides a <a href="./man/man1/golo-run.html"><code>run</code></a> command for running compiled Golo code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ cd classes
$ golo run --module hello.World
Hello world!
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Simple, isn&#8217;t it?</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_golo_script">1.6. Running Golo script</h3>
<div class="paragraph">
<p>Golo provides a <a href="./man/man1/golo-shebang.html"><code>shebang</code></a> command for running a Golo file as a simple script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module hello

function main = |args| {
  require(args: length() &gt; 1, "You should set at least one argument!")
  println("Hello " + args: get(1) + " from '" + args: get(0) + "'!")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the script above can be executed with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo shebang hello.golo World
Hello World from 'hello.golo'!
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Naturally the main goal is to use this command to make the script self-executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">#!/path/to/golo shebang
module hello

function main = |args| {
  require(args: length() &gt; 1, "You should set at least one argument!")
  println("Hello " + args: get(1) + " from '" + args: get(0) + "'!")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can run the script directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ chmod +x hello.golo
$ ./hello.golo World
Hello World from 'hello.golo'!
$</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Golo also provides <code>golosh</code> script that is a shortcut for the <code>golo shebang</code> command, thus
a golo script can be hasbanged with <code>env</code>:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">#!/usr/bin/env golosh
module hello

function main = |args| {
  require(args: length() &gt; 1, "You should set at least one argument!")
  println("Hello " + args: get(1) + " from '" + args: get(0) + "'!")
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each <code>golo</code> and <code>jar</code> files present in the script file&#8217;s directory or the sub directories will be scanned.
This makes it easy to run scripts and have an automatic classpath for libraries, and automatically compile and load other Golo files.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ tree ./
./
└── libs
    └── libA.jar
    └── libB.jar
└── commons
    └── utils.golo
    └── others.golo
    └── vendors
        └── otherlib.jar
└── hello.golo
└── library.golo
$</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_passing_jvm_specific_flags">1.7. Passing JVM-specific flags</h3>
<div class="paragraph">
<p>Both <a href="./man/man1/golo-golo.html"><code>golo</code></a> and <a href="./man/man1/golo-run.html"><code>run</code></a> commands can be given JVM-specific flags using the <code>JAVA_OPTS</code> environment
variable.</p>
</div>
<div class="paragraph">
<p>As an example, the following runs <code>fibonacci.golo</code> and prints JIT compilation along the way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs"># Exporting an environment variable
$ export JAVA_OPTS=-XX:+PrintCompilation
$ golo golo --files samples/fibonacci.golo

# ...or you may use this one-liner
$ JAVA_OPTS=-XX:+PrintCompilation golo golo --files samples/fibonacci.golo</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bash_autocompletion">1.8. Bash autocompletion</h3>
<div class="paragraph">
<p>A bash script can be found in <code>share/shell-completion/</code> called <code>golo-bash-completion</code> that will provide autocomplete support for the <code>golo</code> and <code>vanilla-golo</code> CLI scripts. You may either <code>source</code> the script, or drop the script into your <code>bash_completion.d/</code> folder and restart your terminal.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Not sure where your <code>bash_completion.d/</code> folder is? Try <code>/etc/bash_completion.d/</code> on Linux or <code>/usr/local/etc/bash_completion.d/</code> for Mac Homebrew users.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zsh_autocompletion">1.9. Zsh autocompletion</h3>
<div class="paragraph">
<p>A zsh script can be found in <code>share/shell-completion/</code> called <code>golo-zsh-completion</code> that works using the <code>golo-bash-completion</code> to provide autocomplete support using the bash autocomplete support provided by zsh. Place both files into the same directory and <code>source golo-zsh-completion</code> from your terminal or <code>.zshrc</code> to give it a try!</p>
</div>
</div>
<div class="sect2">
<h3 id="_comments">1.10. Comments</h3>
<div class="paragraph">
<p>Golo comments start with a <code>#</code>, just like in Bash, Python or Ruby:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># This is a comment
println("Plop") # it works here, too</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_variable_and_constant_references">1.11. Variable and constant references</h3>
<div class="paragraph">
<p>Golo does not check for types at compile time, and they are not declared. Everything happens at
runtime in Golo.</p>
</div>
<div class="paragraph">
<p>Variables are declared using the <code>var</code> keyword, while constant references are declared with <code>let</code>.
It is strongly advised that you favour <code>let</code> over <code>var</code> unless you are certain that you need
mutability.</p>
</div>
<div class="paragraph">
<p>Variables and constants need to be initialized when declared. Failing to do so results in a
compilation error.</p>
</div>
<div class="paragraph">
<p>Here are a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Ok
var i = 3
i = i + 1

# The assignment fails because truth is a constant
let truth = 42
truth = 666

# Invalid statement, variables / constants have to be initialized
var foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Valid names contain upper and lower case letters within the <code>[a..z]</code> range, underscores (<code>_</code>),
dollar symbols (<code>$</code>) and numbers. In any case, an identifier must not start with a number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Ok, but not necessarily great for humans...
let _$_f_o_$$666 = 666

# Wrong!
let 666_club = 666</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_local_definitions">1.12. Local definitions</h3>
<div class="paragraph">
<p>It is possible to define a constant reference locally to the evaluation of an expression using the <code>with</code> keyword.</p>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let r = [a + 1, a - 1] with { a = 42 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>is functionally equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a = 42
let r = [a + 1, a - 1]</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the <code>a</code> variable exists only in the scope of the expression evaluation. Indeed, code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let r = [a + 1, a - 1] with { a = 42 }
println(a)</code></pre>
</div>
</div>
<div class="paragraph">
<p>will not compile since <code>a</code> is unknown in the outer scope.</p>
</div>
<div class="paragraph">
<p>Besides the locality, this construct is really interesting when constructing other expressions (e.g. <a href="#match_expressions"><code>match</code> constructs</a>), and can help to keep a functional style form of writing functions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_literals">1.13. Data literals</h3>
<div class="paragraph">
<p>Golo supports a set of data literals. They directly map to their counterparts from the Java Standard
API. We give them along with examples in <a href="#data-literals">the data literals table</a> below.</p>
</div>
<table id="data-literals" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java type</th>
<th class="tableblock halign-left valign-top">Golo literals</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"hello world"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Character</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'a'</code>, <code>'b'</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>123</code>, <code>-123</code>, <code>1_234</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>123_L</code>, <code>-123_L</code>, <code>1_234_L</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.234</code>, <code>-1.234</code>, <code>1.234e9</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.234_F</code>, <code>-1.234_F</code>, <code>1.234e9_F</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1_B</code>, <code>-42_B</code>, <code>1_234_B</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0_B</code>, <code>-1_234.56_B</code>, <code>1.234e-4_B</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String.class</code>, <code>java.lang.String.class</code>, <code>gololang.Predef.module</code>, <code>byte.class</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gololang.FunctionReference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^foo</code>, <code>^some.module::foo</code>, &#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Speaking of strings, Golo also supports multi-line strings using the <code>"""</code> delimiters, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let text = """This is
a multi-line string.
  How
    cool
      is
        that?"""

println(text)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet would print the following to the standard console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This is
a multi-line string.
  How
    cool
      is
        that?</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_collection_literals">1.14. Collection literals</h3>
<div class="paragraph">
<p>Golo has special support for common collections. The syntax uses brackets prefixed by a
collection name, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let s = set[1, 2, "a", "b"]
let v = vector[1, 2, 3]
let m = map[[1, "a"], [2, "b"]]
# (...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax and type matchings are the following:</p>
</div>
<table id="collection-literals-matching" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Collection</th>
<th class="tableblock halign-left valign-top">Java type</th>
<th class="tableblock halign-left valign-top">Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tuple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gololang.Tuple</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tuple[1, 2, 3]</code>, or simply <code>[1, 2, 3]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Object[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array[1, 2, 3]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list[1, 2, 3]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.ArrayList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vector[1, 2, 3]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedHashSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>set[1, 2, 3]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedHashMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map[[1, "a"], [2, "b"]]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gololang.Range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1..10]</code>, <code>['a'..'f']</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_a_note_on_lists">1.14.1. A note on lists</h4>
<div class="paragraph">
<p>Since in Golo, every value is actually an instance of <code>Object</code>, there is no
overloading, and thus the <code>remove</code> method on lists can&#8217;t be used to remove an
element at a given position. If you want to remove a list element given its
position, use the <code>removeAt</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_note_on_tuples">1.14.2. A note on tuples</h4>
<div class="paragraph">
<p>Tuples essentially behave as comparable and immutable heterogeneous arrays.</p>
</div>
<div class="paragraph">
<p>The <code>gololang.Tuple</code> class provides the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a constructor with a variable-arguments list of values,</p>
</li>
<li>
<p>a <code>get(index)</code> method to get the element at a specified index,</p>
</li>
<li>
<p>a <code>head()</code> method to get the first element,</p>
</li>
<li>
<p>a <code>tail()</code> method returning a copy without the first element,</p>
</li>
<li>
<p><code>size()</code> and <code>isEmpty()</code> methods that do what their names suggest,</p>
</li>
<li>
<p>an <code>iterator()</code> method because tuples are iterable,</p>
</li>
<li>
<p><code>toArray()</code> and <code>Tuple.fromArray()</code> for converting between tuples and arrays,</p>
</li>
<li>
<p><code>subTuple(start, end)</code> to extract a new tuple,</p>
</li>
<li>
<p><code>extend(&#8230;&#8203;)</code> to create a new tuple with added values, and</p>
</li>
<li>
<p><code>equals(other)</code>, <code>hashCode()</code> and <code>toString()</code> do just what you would expect.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_note_on_maps">1.14.3. A note on maps</h4>
<div class="paragraph">
<p>The map collection literal expects entries to be specified as tuples where the first entry is the
key, and the second entry is the value. This allows nested structures to be specified as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let m = map[
  ["foo", "bar"],
  ["plop", set[1, 2, 3, 4, 5]],
  ["mrbean", map[
    ["name", "Mr Bean"],
    ["email", "bean@outlook.com"]
  ]]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few rules to observe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>not providing a series of tuples will yield class cast exceptions,</p>
</li>
<li>
<p>tuples must have at least 2 entries or will yield index bound exceptions,</p>
</li>
<li>
<p>tuples with more than 2 entries are ok, but only the first 2 entries matter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of that, the following code compiles but raises exceptions at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let m1 = map[1, 2, 4, 5]
let m2 = map[
  [1],
  ["a", "b"]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rationale for map literals to be loose is that we let you put any valid Golo expression, like
functions returning valid tuples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a = -&gt; [1, 'a']
let b = -&gt; [2, 'b']
let m = map[a(), b()]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_collection_comprehension">1.15. Collection comprehension</h3>
<div class="paragraph">
<p>In addition to literals, collections can be created using collection
comprehension. This is a simple way to create a new collection based on another
one (actually on any iterable object), by filtering and transforming its
content. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let data = list[1, 2, 3, 4, 5, 6]
let transformed = list[x * 2 foreach x in data when (x % 2) == 0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a more readable and more powerful version of <code>filter</code>+<code>map</code>.
Indeed, the previous example could be rewritten as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let transformed2 = data: filter(|x| -&gt; (x % 2) == 0): map(|x| -&gt; x * 2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general syntax is a collection literal containing an expression followed
by one or more loop-like expression. If more than one loop is given, it is
equivalent to nested loops. Thus</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[ [x, y] foreach x in [0..5] foreach y in list["a", "b", "c"] ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[]
foreach x in [0..5] {
  foreach y in list["a", "b", "c"] {
    l: add([x, y])
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>for</code> loop can be used, as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[ 2 * x for (var x = 1, x &lt; 5, x = x + 1) ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Contrary to the <code>filter</code>+<code>map</code> approach, where the kind on collection is kept,
comprehension can transform the source collection type, which can be any
iterable. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let dices = set[ x + y foreach x in [1..7] foreach y in [1..7]]
assertThat(dices, containsInAnyOrder(2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12))</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the result collection can only be of the type of one of the predefined
collection literal types.</p>
</div>
<div class="paragraph">
<p><a href="#destructuring">Destructuring</a> can also be used in collection
comprehension, as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let couples = list[ [1, 2], [2, 3], [3, 4] ]
let sums = list[ a + b foreach a, b in couples ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maps can also be created, provided the given expression is either a pair tuple or
a instance of <code>Map.Entry</code> (you can use the predefined <code>mapEntry(key, value)</code>
function to create such objects). For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let myMap = map[ ["k" + i, i] foreach i in [1..5] ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>A collection comprehension is a expression, and can thus be used as such. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">foreach v in [[x,x] foreach x in [0..3]] {
  println(v)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The analogy can be made between comprehension and SQL queries. As an
illustration, compare:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sql" class="language-sql hljs">select distinct
  p.name, p.age, c.product
from
  persons as p,
  commands as c
where
  p.id == c.customer
  and p.age &gt; 18</code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println(set[
  [p: name(), p: age(), c: product()]
  foreach p in persons
  foreach c in commands
  when p: id() == c: customer()
       and p: age() &gt; 18
])</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_collection_comprehension_vs_map_and_filter">1.15.1. Collection comprehension vs. <code>map</code> and <code>filter</code></h4>
<div class="paragraph">
<p>Collection comprehension is actually quite similar to using <code>map</code> and <code>filter</code>
higher-order function on a collection. Indeed, a comprehension such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">list[f(x) foreach x in aList when pred(x)]</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">aList: filter(^pred): map(^f)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, should you use collection comprehension or higher-order functions? Despite some
implementation differences, it&#8217;s above all a matter of taste. Some people
consider comprehension more readable, since it is more similar to the
mathematical <a href="https://en.wikipedia.org/wiki/Set-builder_notation">set-builder notation</a>.
As an example, compare the two functionally equivalent expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">list[ 2 * x for x in aList when (x % 2) == 0 ]
aList: filter(|x| -&gt; (x % 2) == 0): map(|x| -&gt; 2 * x)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The more powerful expressiveness of comprehension shines when using nested
iterators or <a href="#destructuring">destructuring</a>. For instance, an expression such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[
"%s: %s": format(k, x * v)
foreach x in [1..10]
  when (x % 2) == 1
foreach k, v in aMap:entrySet()
  when k: startsWith("f") or v &gt;= 42
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>would be cumbersome to write using only <code>map</code> and <code>filter</code>.</p>
</div>
<div class="paragraph">
<p>The comprehension approach has also several advantages. First, while the code
executed is almost identical when mapping a function and using a comprehension,
that is something similar to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tmp = list[]
foreach elt in aList {
  tmp: add(f(elt))
}
return tmp</code></pre>
</div>
</div>
<div class="paragraph">
<p>the comprehension code is generated at compile time, whereas the <code>map</code>
application is a function called at runtime.
As such, when using a filtering clause, the use of <code>filter</code> creates an
intermediate list that will be fed to <code>map</code>. This is not the case with
comprehension. Moreover, since the expression used to build the values of the
new collection is used at compile time, no closure is created, neither for the
filter.</p>
</div>
<div class="paragraph">
<p>An other advantage of comprehension is the fact that it can be used with any
iterable, to build a different kind of collection. The <code>map</code> and <code>filter</code> methods are
not (yet) available for any iterable, and for those that have them, the
result collection is of the same type as the initial one. This approach is more
polymorphic, but can be less readable if you need to change the collection type.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="destructuring">1.16. Destructuring</h3>
<div class="paragraph">
<p>Golo supports simple destructuring, that is automatic extraction of values
from an object and assignment to multiple variables in one instruction.</p>
</div>
<div class="paragraph">
<p>For instance, using destructuring on a tuple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a, b = [1, 2]
# a = 1, b = 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are more or fewer variables than values to assign, an exception is raised.
A special syntax is available to assign the rest of the values, similar to varargs notation. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a, b, c = list[1, 2]               # raises an exception
let a, b = list[1, 2, 3]               # raises an exception
let a, b, c... = list[1, 2, 3, 4, 5]   # a = 1, b = 2, c = list[3, 4, 5]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reminder has the same type than the destructured object. Note that only container-like object can be destructured using this syntax.
For instance, golo structures can&#8217;t use the rest syntax and raise an exception.</p>
</div>
<div class="paragraph">
<p>Any object having a <code>__$$_destruct(number, rest, toSkip)</code> method returning an array can be used in
  destructuring assignments. Golo specific data structures and some Java native
ones (arrays, maps, collections) can be destructured. Augmentations can be used to make an existing class
destructurable.</p>
</div>
<div class="paragraph">
<p>For instance, <a href="#structs">golo structures</a> are destructurable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">struct Point = { x, y }
#...
let p = Point(3, 4)
let x, y = p
require(x == 3, "err")
require(y == 4, "err")</code></pre>
</div>
</div>
<div class="paragraph">
<p>as well as java lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let lst = list[1, 2, 3, 4, 5]
let head, tail... = lst        # head = 1, tail = list[2, 3, 4, 5]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Already defined variables can also be assigned with destructuring. For
instance, one can easily swap two variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var a, b = [1, 2]  # a = 1, b = 2
a, b = [b, a]      # a = 2, b = 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Destucturing can also be used in <a href="#foreach_loops"><code>foreach</code> loops</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">foreach key, value in myMap: entrySet() {
  # do something...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is moreover possible to ignore some of the destructured values by using the special <code>_</code> variable name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a, _, _, _, b = list[1, 2, 3, 4, 5]
# a = 1 and b = 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>This name can be used with the remainder syntax, to avoid the creation of a new structure to hold the other values.
For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let _, a, _, b, _... = [1..500]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>a</code> is <code>2</code> and <code>b</code> is <code>4</code>. No new range is created for the remaining values.</p>
</div>
<div class="sect3">
<h4 id="_destructuring_method">1.16.1. Destructuring method</h4>
<div class="paragraph">
<p>To be destructurable, an object must have a <code>__$$_destruct(number, rest, skip)</code> method, whose parameters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the number of values to be assigned to,</p>
</li>
<li>
<p>whether the assignment has a rest (i.e. if remainder syntax <code>&#8230;&#8203;</code> is used)</p>
</li>
<li>
<p>a list describing the positions to skip (<code>_</code> special name)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and must return an array containing the values to assign (<code>null</code> if skipped).
If the <code>number</code> does not match the contained values, a
<code>org.eclipse.golo.runtime.InvalidDestructuringException</code> is thrown.</p>
</div>
<div class="paragraph">
<p>For instance, the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a, _, b... = [8..20]

let it = list[1, 2, 3, 4, 5]: iterator()
let _, x, y, _... = it</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tmp1 = [8..20]: __$$_destruct(3, true, array[false, true, false])
let a = tmp: get(0)
let b = tmp: get(2)

let it = list[1, 2, 3, 4, 5]: iterator()
let tmp2 = it: __$$_destruct(4, true, array[true, false, false, true])
let x = it: get(1)
let y = it: get(2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>tmp1</code> will be <code>array[8, null, [10..20]]</code> and <code>tmp2</code> will be <code>array[null, 2, 3, null]</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of version 3.4, the destructuring behavior has changed, particularly the remainder aspect and when not enough variables are provided.
To use the old-syle behavior, one can use the <code>&amp;useOldstyleDestruct()</code> macro to switch locally, or set the <code>golo.destruct.newstyle</code> property or
<code>GOLO_DESTRUCT_NEWSTYLE</code> environment variable to <code>true</code> to switch globally.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operators">1.17. Operators</h3>
<div class="paragraph">
<p>Golo supports the following <a href="#operators">set of operators</a>.</p>
</div>
<table id="operators" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbol(s)</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addition on numbers and strings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 + 2</code> gives <code>3</code>.</p>
<p class="tableblock"><code>"foo" + "bar"</code> gives <code>"foobar"</code>.</p>
<p class="tableblock"><code>"foo" + something</code> where <code>something</code> is any object instance is equivalent to
<code>"foo" + something.toString()</code> in Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtraction on numbers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4 - 1</code> gives <code>3</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication on numbers and strings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2 * 2</code> gives <code>4</code>.</p>
<p class="tableblock"><code>"a" * 3</code> gives <code>"aaa"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division on numbers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4 / 2</code> gives <code>2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'%'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo on numbers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4 % 2</code> gives <code>0</code>, <code>3 % 2</code> gives <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"&lt;"</code>, <code>"&#8656;"</code>, <code>"=="</code>, <code>"!="</code>, <code>"&gt;"</code>, <code>"&gt;="</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison between numbers and objects that implement <code>java.lang.Comparable</code>.
<code>==</code> is equivalent to calling <code>Object#equals(Object)</code> in Java.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 &lt; 2</code> gives <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is</code>, <code>isnt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison of reference equality.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a is b</code> gives <code>true</code> only if <code>a</code> and <code>b</code> reference the same object instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>and</code>, <code>or</code>, <code>not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean operators. <code>not</code> is of course a unary operator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true and true</code> gives <code>true</code>, <code>not(true)</code> gives <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oftype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks the type of an object instance, equivalent to the <code>instanceof</code> operator
in Java.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>("plop" oftype String.class)</code> gives <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>orIfNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates an expression and returns the value of another one if <code>null</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null orIfNull "a"</code> gives <code>"a"</code>. <code>foo() orIfNull 0</code> gives the value of calling <code>foo()</code>, or <code>0</code> if
<code>foo()</code> returns <code>null</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The algebraic operators can be used with any numeric type having a literal notation
(see <a href="#data-literals">the data literals table</a> ), including <code>java.math.BigInteger</code> and <code>java.math.BigDecimal</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operator precedence rules are as follows:</p>
</div>
<table id="operator-precedence" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Precedence</th>
<th class="tableblock halign-left valign-top">Operator</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strongest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:</code>, <code>?:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code>, <code>/</code>, <code>%</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code>, <code>&#8656;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>oftype</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code>, <code>!=</code>, <code>is</code>, <code>isnt</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>and</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>or</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lowest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>orIfNull</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This means that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">not foo: bar() orIfNull "yo"</code></pre>
</div>
</div>
<div class="paragraph">
<p>reads as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">(not (foo: bar())) orIfNull "yo"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_a_method">1.18. Calling a method</h3>
<div class="paragraph">
<p>Although we will discuss this in more details later on, you should already know that <code>:</code> is used to
invoke instance methods.</p>
</div>
<div class="paragraph">
<p>You could for instance call the <code>toString()</code> method that any Java object has, and print it out as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println(123: toString())
println(someObject: toString())</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_jvm_arrays">1.19. Java / JVM arrays</h3>
<div class="paragraph">
<p>As you probably know, arrays on the JVM are special objects. Golo deals with such arrays as being
instances of <code>Object[]</code> and does not provide a wrapper class like many languages do. A Java / JVM
array is just what it is supposed to be.</p>
</div>
<div class="paragraph">
<p>Golo adds some sugar to relieve the pain of working with arrays. Golo allows some special methods to
be invoked on arrays:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get(index)</code> returns the value at <code>index</code>,</p>
</li>
<li>
<p><code>set(index, value)</code> sets <code>value</code> at <code>index</code>,</p>
</li>
<li>
<p><code>length()</code> and <code>size()</code> return the array length,</p>
</li>
<li>
<p><code>iterator()</code> returns a <code>java.util.Iterator</code>,</p>
</li>
<li>
<p><code>toString()</code> delegates to <code>java.util.Arrays.toString(Object[])</code>,</p>
</li>
<li>
<p><code>asList()</code> delegates to <code>java.util.Arrays.asList(Object[])</code>,</p>
</li>
<li>
<p><code>equals(someArray)</code> delegates to <code>java.util.Arrays.equals(this, someArray)</code>,</p>
</li>
<li>
<p><code>getClass()</code> returns the array class,</p>
</li>
<li>
<p><code>head()</code> returns the first element of the array (or <code>null</code> if empty),</p>
</li>
<li>
<p><code>tail()</code> returns a copy of the array without its first element (or an empty
array if empty),</p>
</li>
<li>
<p><code>isEmpty()</code> checks if the array is empty,</p>
</li>
<li>
<p><code>contains(value)</code> checks if the array contains the given value,</p>
</li>
<li>
<p><code>indexOf(value)</code> returns the index of the value in the array, or -1 if not present.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given a reference <code>a</code> on some array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Gets the element at index 0
a: get(0)

# Replaces the element at index 1 with "a"
a: set(1, "a")

# Nice print
println(a: toString())

# Convert to a real collection
let list = a: asList()</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The methods above do <strong>not</strong> perform array bound checks.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, arrays can be created with the <code>Array</code> function, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a = Array(1, 2, 3, 4)
let b = Array("a", "b")</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can of course take advantage of the <code>array</code> collection literal, too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let a = array[1, 2, 3, 4]
let b = array["a", "b"]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_new_projects">2. Creating new project(s)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="./man/man1/golo-new.html"><code>golo new</code></a> command can create new Golo project(s):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo new Foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command creates a new Golo module named <code>Foo</code> in a <code>main.golo</code> file with a simple <em>function</em>
named <code>main</code> that takes an argument for the JVM program arguments.</p>
</div>
<div class="paragraph">
<p>By default we create a new free-form project but you can specify the type of project with the
<code>--type</code> command argument. Three types of projects are currently available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Free-form project,</p>
</li>
<li>
<p>Maven-driven project,</p>
</li>
<li>
<p>Gradle-driven project.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value of the <code>--type</code> parameter can be changed by setting the <code>golo.new.type</code> property.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example if you want to create a Maven-driven project, just add <code>--type maven</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo new Foo --type maven</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default we create the project directory where the <code>golo</code> command is run. If you need to create
your project directory elsewhere you can use the <code>--path</code> command argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo new Bar --path /opt/golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates the project directory named <code>Bar</code> in <code>/opt/golo</code>.</p>
</div>
<div class="sect2">
<h3 id="_free_form_project">2.1. Free-form project</h3>
<div class="paragraph">
<p>The structure of a free-form project is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ tree Foo
Foo
├── imports
├── jars
└── main.golo</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven_driven_project">2.2. Maven-driven project</h3>
<div class="paragraph">
<p>The structure of a Maven-driven project is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ tree Foo/
Foo/
├── pom.xml
├── README.md
└── src
    ├── main
    │   ├── golo
    │   │   └── main.golo
    │   └── resources
    └── test
        └── golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The project can be built and packaged with Maven using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now run the module <code>Foo</code> with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mvn</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ mvn exec:java</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ java -jar target/Foo-*-jar-with-dependencies.jar</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>golo</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ cd target/classes
$ golo run --module Foo</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gradle_driven_project">2.3. Gradle-driven project</h3>
<div class="paragraph">
<p>The structure of a Gradle-driven project is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ tree Foo/
Foo/
├── build.gradle
├── README.md
└── src
    ├── main
    │   ├── golo
    │   │   └── main.golo
    │   └── resources
    └── test
        └── golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The project can be built and packaged with Gradle using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ gradle build</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now run the module <code>Foo</code> with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gradle</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ gradle run</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>golo</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ cd build/classes/main
$ golo run --module Foo</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_control">2.4. Version control</h3>
<div class="paragraph">
<p>With the <code>--vcs</code> option, the command will create a <em>ignore</em> file and try to initialize the repository. Mercurial (<code>hg</code>) and Git (<code>git</code>) are currently supported. For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo new --vcs git --type gradle Foo
$ tree -a -L 1 Foo/
Foo/
├── build.gradle
├── .git
├── .gitignore
├── README.md
└── src
$ cat Foo/.gitignore
*.class
build/
.gradle/</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo new --vcs hg --type maven Foo
$ tree -a -L 1 Foo/
Foo/
├── .hg
├── .hgignore
├── pom.xml
├── README.md
└── src
$ cat Foo/.hgignore
syntax: glob
*.class
target/</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the option is not given, or if the value is <code>none</code>, no repository is initialized.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value of the <code>--vcs</code> parameter can be changed by setting the <code>golo.new.vcs</code> property.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_profile">2.5. Profile</h3>
<div class="paragraph">
<p>The <code>--profile</code> option defines the kind of project you want to create, and will influence the files and hierarchy generated. Two profiles are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>app</code> will create a application project;</p>
</li>
<li>
<p><code>lib</code> will create a library project.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functions">3. Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Functions are first-class citizen in Golo. Here is how to define and
call some.</p>
</div>
<div class="sect2">
<h3 id="_parameter_less_functions">3.1. Parameter-less functions</h3>
<div class="paragraph">
<p>Golo modules can define functions as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

function hello = {
  return "Hello!"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In turn, you may invoke a function with a familiar notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let str = hello()</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function needs to return a value using the <code>return</code> keyword. Some
languages state that the last statement is the return value, but Golo
does not follow that trend. We believe that <code>return</code> is more explicit,
and that a few keystrokes in favour of readability is still a good deal.</p>
</div>
<div class="paragraph">
<p>Still, you may omit <code>return</code> statements if your function does not return
a value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function printer = {
  println("Hey!")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do so, the function will actually return <code>null</code>, hence <code>result</code>
in the next statement is <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># result will be null
let result = printer()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functions_with_parameters">3.2. Functions with parameters</h3>
<div class="paragraph">
<p>Of course functions may take some parameters, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function addition = |a, b| {
  return a + b
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Parameters are constant references, hence they cannot be reassigned.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Invoking functions that take parameters is straightforward, too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let three = addition(1, 2)
let hello_world = addition("hello ", "world!")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_variable_arity_functions">3.3. Variable-arity functions</h3>
<div class="paragraph">
<p>Functions may take a varying number of parameters. To define one, just
add <code>&#8230;&#8203;</code> to the last parameter name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |a, b, c...| {
  # ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>c</code> catches the variable arguments in an array, just like it would
be the case with Java. You can thus treat <code>c</code> as being a Java object of
type <code>Object[]</code>.</p>
</div>
<div class="paragraph">
<p>Calling variable-arity functions does not require wrapping the last
arguments in an array. While invoking the <code>foo</code> function above, the
following examples are legit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># a=1, b=2, c=[]
foo(1, 2)

# a=1, b=2, c=[3]
foo(1, 2, 3)

# a=1, b=2, c=[3,4]
foo(1, 2, 3, 4)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the parameter that catches the last arguments is an array, you
may call array methods. Given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function elementAt = |index, args...| {
  return args: get(index)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># prints "2"
println(elementAt(1, 1, 2, 3))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_named_parameters">3.4. Named parameters</h3>
<div class="paragraph">
<p>When you invoke Golo functions, you can use the name of the parameters explicitly in the call like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function post = |title, body, promoted, tags...| {
  let data = map[
    ["title", title],
    ["body", body],
    ["promoted", promoted],
    ["tags", tags: asList()]
  ]
  return gololang.JSON.stringify(data)
}

post(
  tags = array["feature", "syntax"],
  body = "it rocks!"
  title = "Named parameters are alive",
  promoted = true
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Once you are using named parameters in your function call, the order doesn&#8217;t matter anymore.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To name varargs argument, you have be box the values into an <code>array[]</code> (just has it&#8217;s done with the <code>tags</code> argument in the above snippet)
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You must name either or none of the arguments. A compilation error will be raised, if you mix named an unamed arguments in a function invocation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_functions_from_other_modules_and_imports">3.5. Functions from other modules and imports</h3>
<div class="paragraph">
<p>Suppose that we have a module <code>foo.Bar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module foo.Bar

function f = {
  return "f()"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can invoke <code>f</code> from another module by prefixing it with its module
name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let r = foo.Bar.f()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, we may also take advantage of an <code>import</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Somewhere.Else

import foo.Bar

function plop = {
  return f()
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Imports in Golo do not work as in Java.
Golo is a dynamic language where symbols are being resolved at runtime. Module imports are
<strong>not</strong> checked at compilation time, and their sole purpose is to help in dynamic resolution. Back
to the previous example, <code>f</code> cannot be resolved from the current module, and the Golo runtime
subsequently tries to resolve <code>f</code> from each <code>import</code> statement. Also, note that the order of
<code>import</code> statements is important, as the resolution stops at the first module having the <code>f</code>
function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may prepend the <strong>last</strong> piece of the module name. The following invocations are
equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Somewhere.Else

import foo.Bar

function plop = {
  let result = f()
  let result_bis = Bar.f()
  let result_full = foo.Bar.f()
  return result
}</code></pre>
</div>
</div>
<div id="relative_import" class="paragraph">
<p>To help maintaining packages of several modules, and to avoid repeating the fully qualified name of the package when importing “local” modules,
<code>import</code> can also be made relative to the package of the importing module. For instance, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module foo.bar.Spam

import .baz.Egg</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module foo.bar.Spam

import foo.bar.baz.Egg</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that only modules in the same package or in a sub-package can be imported using relative name. In the previous example, to import the module <code>foo.Plop</code>, its full name must be specified.</p>
</div>
<div id="multi_import" class="paragraph">
<p>Moreover, it is possible to import several modules from the same package with a single <code>import</code> statement, as in;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import java.util.{Collections, Objects, stream.Collectors}</code></pre>
</div>
</div>
<div id="implicit_imports" class="paragraph">
<p>Golo modules have a set of implicit imports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gololang.Predefined</code>,</p>
</li>
<li>
<p><code>gololang.StandardAugmentations</code>,</p>
</li>
<li>
<p><code>gololang</code>,</p>
</li>
<li>
<p><code>java.lang</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These modules are imported <strong>after</strong> the module explicitly imported in the module, so that elements defined in these modules (e.g. predefined functions or <a href="#augment_order">augmentations</a>) can be redefined.</p>
</div>
<div id="warning-unavailable-class" class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When an imported module can&#8217;t be loaded, either because it is not in the classpath or because of a typo in its name, a warning can printed by setting the <code>golo.warnings.unavailable-class</code> system property to <code>true</code>.
This does not preclude the code to work correctly since the looked up function can be present in another imported module.
When the function is called prefixed with the module name, and the module can&#8217;t be loaded, the warning is also printed, but the code will fail with a <code>NoSuchMethodError</code>.
This option is mainly for debugging purpose and is not activated by default. Indeed, due to the way Golo load modules and lookup functions, many “false positives” can be reported. This can be changed in a future release.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_local_functions">3.6. Local functions</h3>
<div class="paragraph">
<p>By default, functions are visible outside of their module. You may
restrict the visibility of a function by using the <code>local</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Foo

local function a = {
  return 666
}

function b = {
  return a()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>b</code> is visible while <code>a</code> can only be invoked from within the <code>Foo</code>
module. Given another module called <code>Bogus</code>, the following would fail at
runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Bogus

function i_will_crash = {
  return Foo.a()
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recursive_tail_call_optimization">3.7. Recursive Tail Call Optimization</h3>
<div class="paragraph">
<p>Golo feature recursive <a href="https://en.wikipedia.org/wiki/Tail_call">tail call</a> optimization. If a function last action is to return the result of a recursive call, it is optimized to not stack a new call and is compiled in code equivalent to a loop. For instance, a function like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function fact = |acc, v| -&gt; match {
  when v == 0 then acc
  otherwise fact(acc * v, v - 1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is compiled into something roughly equivalent to :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function fact = |acc, v| {
  var acc_ = acc
  var v_ = v
  while v_ != 0 {
    acc_ = acc_ * v_
    v_ = v_ - 1
  }
  return acc_
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows to create recursive functions that will not throw a <code>StackOverflowError</code> even in the presence of a large number or recursive call.
The optimization can be disabled by setting the <code>golo.optimize.tce</code> system property to <code>false</code> (e.g. <code>export GOLO_OPTS='-Dgolo.optimize.tce=false</code>).</p>
</div>
<div class="paragraph">
<p>A call is tail recursive when the function returns the result of calling itself directly. Indeed, since no evaluation nor flow analysis is done, many effectively tail recursive calls can&#8217;t be identified as such, and thus are not optimized. It is recommended to rewrite the code to make the tail call more direct. For instance, the following two functions are not optimized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |a, v| {
  let r = ^foo
  if v == 0 {
    return a
  }
  return r(a + v, v - 1)
}

function bar = |a, v| {
  var r = null
  if v == 0 {
    r = a
  } else {
    r = bar(a + v, v - 1)
  }
  return r
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>while the following one is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function ref = |a, v| {
  if v == 0 {
    return a
  }
  return ref(a + v, v - 1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that returning a <code>match</code> expression that may evaluate to a tail call will be optimized, such that the function</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function baz = |a, v| -&gt; match {
  when v == 0 then a
  otherwise ref(a + v, v - 1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be strictly equivalent to the previous one. A consequence of this behavior is that mutual recursions are not optimized.</p>
</div>
<div class="sect3">
<h4 id="_on_augmentations">3.7.1. On augmentations</h4>
<div class="paragraph">
<p>Functions defined in augmentations can be optimized if written in a tail call style. For instance, in the following sample, the <code>reduce</code> function is not optimized since it is viewed as a method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">struct Cons = {head, tail}

augment Cons {
  function reduce = |this, f, z| -&gt; match {
    when this: isEmpty() then z
    otherwise this: tail(): reduce(f, f(this: head(), z))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand, the following one is optimized and works as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment Cons {
  function reduce = |this, f, z| -&gt; match {
    when this: isEmpty() then z
    otherwise reduce(this: tail(), f, f(this: head(), z))
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_limitations_on_decorators">3.7.2. Limitations on decorators</h4>
<div class="paragraph">
<p>Since the optimization is done at compile time, most of dynamic features are not available. For instance, <a href="#decorators">decorated functions</a>
can&#8217;t be optimized. Indeed, in that case, the decorator would not be applied on each call but only on the first one, which could lead to unexpected results.</p>
</div>
<div class="paragraph">
<p>For instance, the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function log = |f| -&gt; |a, v| {
  println("function called with " + a + ", " + v)
  return f(a, v)
}

@log
function fact = |acc, v| -&gt; match {
  when v == 0 then acc
  otherwise fact(acc * v, v - 1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>when optimised would print the message only for the first call. The tail call optimization is thus disabled for decorated functions. If the desired behavior is to optimize the function and apply the decorator only for the first call, one can create an undecorated version, and decorate explicitly direct calls or create a decorated wrapper, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function log = |f| -&gt; |a, v| {
  println("function called with " + a + ", " + v)
  return f(a, v)
}

function fact = |acc, v| -&gt; match {
  when v == 0 then acc
  otherwise fact(acc * v, v - 1)
}

@log
function decoratedFact = |acc, v| -&gt; fact(acc, v)

#(...)

let direclyDecorated = log(^fact)
directlyDecorated(1, 5)
log(^fact)(1, 5)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this approach is not as cumbersome, since most of the time, tail recursive functions introduce an “artificial” accumulator that is hidden by a function calling the recursive one with the default accumulator value.
For instance, in the factorial case, one would write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">local function fact = |acc, v| -&gt; match {
  when v == 0 then acc
  otherwise fact(acc * v, v - 1)
}

function fact = |v| -&gt; fact(1, v)</code></pre>
</div>
</div>
<div class="paragraph">
<p>or equivalently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function fact = |n| {
  let _fact = |acc, v| -&gt; match {
    when v == 0 then acc
    otherwise _fact(acc * v, v - 1)
  }
  return _fact(1, n)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the both the local <code>fact</code> and the <code>_fact</code> closure are optimized, while the public one can be decorated.</p>
</div>
<div class="paragraph">
<p>Similarly, variadic functions are not optimized, since we can&#8217;t know at compile-time if the last argument is already an array or a simple value that must be collected. The same kind of approach is recommended, by defining a (local) fixed arguments recursive version that is optimized and a variadic one that delegates on it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_level_state">3.8. Module-level state</h3>
<div class="paragraph">
<p>You can declare <code>let</code> and <code>var</code> references at the module level, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Sample

let a = 1

var b = truth()

local function truth = {
  return 42
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These references get initialized when the module is being loaded by the Java virtual machine. In
fact, module-level state is implemented using <code>private static</code> fields that get initialized in a
<code>&lt;clinit&gt;</code> method.</p>
</div>
<div class="paragraph">
<p>Module-level references are only visible from their module, although a function may provide
accessors to them.</p>
</div>
<div class="paragraph">
<p>It is important to note that such references get initialized in the order of declaration in the
source file. Having initialization dependencies between such references would be silly anyway, but
one should keep it in mind <em>just in case</em>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Global state is a bad thing in general. We strongly advise you to <strong>think twice</strong> before you
introduce module-level state. Beware of potential memory leaks, just like <code>static</code> class fields in
the Java programming language.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_interoperability">4. Java interoperability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo aims at providing a seamless 2-way interoperability with the Java programming language.</p>
</div>
<div class="sect2">
<h3 id="_main_function_java_compliance">4.1. Main function Java compliance</h3>
<div class="paragraph">
<p>If the Golo compiler find a unary function named <code>main</code>, it will be compiled to a <code>void(String[])</code> static method.
This <code>main</code> method can servers as a JVM entry point.</p>
</div>
<div class="paragraph">
<p>Suppose that we have the following Golo module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module mainEntryPoint


function main = |args| {
  println("-&gt; " + args: get(0))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once compiled, we may invoke it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo compile mainEntryPoint.golo
$ java -cp ".:golo.jar" mainEntryPoint GoloRocks
-&gt; GoloRocks
$</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_static_methods">4.2. Calling static methods</h3>
<div class="paragraph">
<p>Golo can invoke public Java static methods by treating them as functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

import java.util.Arrays

function oneTwoThree = {
  return asList(1, 2, 3)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>asList</code> is resolved from the <code>java.util.Arrays</code> import and called as a function.
Note that we could equivalently have written a qualified invocation as <code>Arrays.asList(1, 2, 3)</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calling_instance_methods">4.3. Calling instance methods</h3>
<div class="paragraph">
<p>When you have an object, you may invoke its methods using the <code>:</code> operator.</p>
</div>
<div class="paragraph">
<p>The following would call the <code>toString</code> method of any kind, then print it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println("&gt;&gt;&gt; " + someObject: toString())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you may chain calls as long as a method is not of a <code>void</code> return type. Golo converts
Java <code>void</code> methods by making them return <code>null</code>. This is neither a bug or a feature: the
<strong>invokedynamic</strong> support on the JVM simply does so.</p>
</div>
</div>
<div class="sect2">
<h3 id="_named_arguments">4.4. Named arguments</h3>
<div class="paragraph">
<p>If you compile your Java 8 source code with the <code>-parameters</code> option, then you will be able to invoke the functions
from Golo with named arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package io;

public class Printer {
 public static Object print(Object prefix, Object what) {
    System.out.println(prefix +  " " + what);
    return null;
 }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ javac -parameters Printer.java</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module bar
import io.Printer

let obj = DynamicObject()

function main = |args...| {
  print(what = obj, prefix = "&gt;")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Further documentation about <a href="https://docs.oracle.com/javase/tutorial/reflect/member/methodparameterreflection.html">Names Method Parameters with Java 8.</a></p>
</div>
<div id="warning-no-parameter-names" class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the java code was not compiled with named parameters, the named arguments syntax is still valid, but the names are simply ignored and  <em>no reordering</em> will be done. You can therefore use the argument names to improve readability and with the hope that the java library you use will later be compiled with the options, but keep them in the expected order, or you could have unexpected results.</p>
</div>
<div class="paragraph">
<p>A warning is displayed when named arguments are used with functions without named parameters. It can be disabled by setting the <code>golo.warnings.no-parameter-names</code> system property to <code>false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="warning-deprecate">4.5. Deprecated method</h3>
<div class="paragraph">
<p>When calling a deprecated method or function, a warning is displayed. It can be disabled by setting the <code>golo.warnings.deprecated</code> system property to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_null_safe_instance_method_invocations">4.6. <code>null</code>-safe instance method invocations</h3>
<div class="paragraph">
<p>Golo supports <strong><code>null</code>-safe</strong> methods invocations using the <strong>"Elvis"</strong> symbol: <code>?:</code>.</p>
</div>
<div class="paragraph">
<p>Suppose that we invoke the method <code>bar()</code> on some reference <code>foo</code>: <code>foo: bar()</code>. If <code>foo</code> is <code>null</code>,
then invoking <code>bar()</code> throws a <code>java.lang.NullPointerException</code>, just like you would expect in Java.</p>
</div>
<div class="paragraph">
<p>By contrast:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo?: bar()</code> simply returns <code>null</code>, and</p>
</li>
<li>
<p><code>null?: anything()</code> returns <code>null</code>, too.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is quite useful when querying data models where <code>null</code> values could be returned. This can be
elegantly combined with the <code>orIfNull</code> operator to return a default value, as illustrated by the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let person = dao: findByName("Mr Bean")
let city = person?: address()?: city() orIfNull "n/a"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is more elegant than, say:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let person = dao: findByName("Mr Bean")
var city = "n/a"
if person isnt null {
  let address = person: address()
  if address isnt null {
    city = address: city() ofIfNull "n/a"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The runtime implementation of <code>null</code>-safe method invocations is <strong>optimistic</strong> as it behaves
like a <code>try</code> block catching a <code>NullPointerException</code>. Performance is good unless most invocations
happen to be on <code>null</code>, in which case using <code>?:</code> is probably not a great idea.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_creating_objects">4.7. Creating objects</h3>
<div class="paragraph">
<p>Golo doesn&#8217;t have an instantiation operator like <code>new</code> in Java. Instead, creating an object and
calling its constructor is done as if it was just another function.</p>
</div>
<div class="paragraph">
<p>As an example, we may allocate a <code>java.util.LinkedList</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

import java.util

function aList = {
  return LinkedList()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example would be using a <code>java.lang.StringBuilder</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function str_build = {
  return java.lang.StringBuilder("h"):
    append("e"):
    append("l"):
    append("l"):
    append("o"):
    toString()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As one would expect, the <code>str_build</code> function above gives the <code>"hello"</code> string.</p>
</div>
</div>
<div class="sect2">
<h3 id="_static_fields">4.8. Static fields</h3>
<div class="paragraph">
<p>Golo treats public static fields as function, so one could get the maximum value for an <code>Integer</code> as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module samples.MaxInt

local function max_int = {
  return java.lang.Integer.MAX_VALUE()
}

function main = |args| {
  println(max_int())
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Given than most static fields are used as constants in Java, Golo does not provide support to
change their values. This may change in the future if compelling general-interest use-cases emerge.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_instance_fields">4.9. Instance fields</h3>
<div class="paragraph">
<p>Instance fields can be accessed as functions, both for reading and writing. Suppose that we have a
Java class that looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Foo {
  public String bar;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can access the <code>bar</code> field as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let foo = Foo()

# Write
foo: bar("baz")

# Read, prints "baz"
println(foo: bar())</code></pre>
</div>
</div>
<div class="paragraph">
<p>An interesting behavior when writing fields is that the <strong>"methods"</strong> return the object, which means
that you can chain invocations.</p>
</div>
<div class="paragraph">
<p>Suppose that we have a Java class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Foo {
  public String bar;
  public String baz;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can set all fields by chaining invocations as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let foo = Foo(): bar(1): baz(2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be noted that Golo won&#8217;t bypass the regular Java visibility access rules on fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">What happens if there is both a field and a method with the same names?</div>
<div class="paragraph">
<p>Back to the previous example, suppose that we have both a field and a method with the same name, as
in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Foo {
  public String bar;

  public String bar() {
    return bar;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Golo resolves methods first, fields last.</strong> Hence, the following Golo code will resolve the
<code>bar()</code> method, not the <code>bar</code> field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let foo = Foo()

# Write the field
foo: bar("baz")

# Calls the bar() method
println(foo: bar())</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_properties_support">4.10. Properties support</h3>
<div class="paragraph">
<p>Golo support property-style method calls.</p>
</div>
<div class="paragraph">
<p>Given a property <code>name()</code>, Golo will translate the method call to a <code>{get|is or set}Name</code> method call. Obviously, if a field
is not accessible (ie. <code>private</code>) and doesn&#8217;t have a getter or setter, the resolution will fail.
Finally, <em>write-only</em> properties can be chained (ie: return the current <code>this</code> instance), unless a return value is defined in the according setter method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The property resolution does not check if an according field exists. Basically all the <code>get|set|is|</code> methods are candidates to
a property-style method invocation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class Person {

  private String name;
  private boolean goloComitter;
  private String email;
  private int score;

  public String getName() {
  ...
  }

  public boolean isGoloComitter() {
  ...
  }

  public void setName(String name) {
    ...
  }

  public void setGoloCommitter(boolean goloCommitter) {
  ...
  }

  public int setScore(int score) {
    this.score = score;
    return score;
  }

  public boolean isRockStar() {
    return goloCommitter;
  }
}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let duke = Person()

try {
  duke: email("duke@golo-lang.org")
} catch (e) {
  require(e oftype java.lang.NoSuchMethodError.class, "the email field is private and no setter is defined")
}

require(duke: name("Duke"): goloCommiter(true) oftype Person.class, "the set mutators should be chained with fluent calls")
require(duke: name() is "Duke", "should find the getName() accessor.")
require(duke: goloCommitter() is true, "should invoke the isGoloCommitter accessor since the field it's a boolean")
require(print(duke: rockStar() is true, "even if the field rockstar doesn't exists, it should invoke the isRockStar accessor")
require(ducke: score(100) is 100, "setScore returns a value, the method isn't fluent")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inner_classes_and_enumerations">4.11. Inner classes and enumerations</h3>
<div class="paragraph">
<p>We will illustrate both how to deal with public static inner classes and enumerations at once.</p>
</div>
<div class="paragraph">
<p>The rules to deal with them in Golo are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inner classes are identified by their real name in the JVM, with nested classes being separated
by a <code>$</code> sign. Hence, <code>Thread.State</code> in Java is written <code>Thread$State</code> in Golo.</p>
</li>
<li>
<p>Enumerations are just normal objects. They expose each entry as a static field, and each entry is
an instance of the enumeration class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let us consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample.EnumsThreadState

import java.lang.Thread$State

function main = |args| {

  # Call the enum entry like a function
  let new = Thread$State.NEW()
  println("name=" + new: name() + ", ordinal=" + new: ordinal())
  println("-----------")

  # Walk through all enum entries
  foreach element in Thread$State.values() {
    println("name=" + element: name() + ", ordinal=" + element: ordinal())
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running it yields the following console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo golo --files samples/enums-thread-state.golo
name=NEW, ordinal=0
name=NEW, ordinal=0
name=RUNNABLE, ordinal=1
name=BLOCKED, ordinal=2
name=WAITING, ordinal=3
name=TIMED_WAITING, ordinal=4
name=TERMINATED, ordinal=5
$</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clashes_with_golo_operators_and_escaping">4.12. Clashes with Golo operators and escaping</h3>
<div class="paragraph">
<p>Because Golo provides a few named operators such as <code>is</code>, <code>and</code> or <code>not</code>, they are recognized as
operator tokens.</p>
</div>
<div class="paragraph">
<p>However, you may find yourself in a situation where you need to invoke a Java method whose name is
a Golo operator, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Function call
is()

# Method call
someObject: foo(): is(): not(): bar()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in a parsing error, as <code>is</code> and <code>not</code> will be matched as operators instead of method
identifiers.</p>
</div>
<div class="paragraph">
<p>The solution is to use <strong>escaping</strong>, by prefixing identifiers with a backtick, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Function call
`is()

# Method call
someObject: foo(): `is(): `not(): bar()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_golo_class_loader">4.13. Golo class loader</h3>
<div class="paragraph">
<p>Golo provides a class loader for directly loading and compiling Golo modules. You may use it as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.eclipse.golo.compiler.GoloClassLoader;

public class Foo {

  public static void main(String... args) throws Throwable {
    GoloClassLoader classLoader = new GoloClassLoader();
    Class&lt;?&gt; moduleClass = classLoader.load("foo.golo", new FileInputStream("/path/to/foo.golo"));
    Method bar = moduleClass.getMethod("bar", Object.class);
    bar.invoke(null, "golo golo");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would work with a Golo module defined as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module foo.Bar

function bar = |wat| -&gt; println(wat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, a Golo module is viewable as a Java class where each function is a static method.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>GoloClassLoader</code> is rather dumb at this stage, and you will get an exception if you try
to load two Golo source files with the same <code>module</code> name declaration. This is because it will
attempt to redefine an already defined class.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Later in the glorious and glamorous future, Golo will have objects and not just functions.
Be patient, it&#8217;s coming in!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_primitive_data_types">4.14. Primitive Data Types</h3>
<div class="paragraph">
<p><code>java.lang.Class</code> instances of primitive data types can be obtained as in Java way: <code>byte.class</code>, <code>short.class</code>, <code>int.class</code>, <code>long.class</code>, <code>float.class</code>, <code>double.class</code>, <code>boolean.class</code> and <code>char.class</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This could be useful for example to deal with primitive arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># ...
let buffer = newTypedArray(byte.class, 1024)
let read = inputstream: read(buffer)
# ...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_control_flow">5. Control flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Control flow in Golo is imperative and has the usual constructions found in upstream languages.</p>
</div>
<div class="sect2">
<h3 id="_conditional_branching">5.1. Conditional branching</h3>
<div class="paragraph">
<p>Golo supports the traditional <code>if</code> / <code>else</code> constructions, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">if goloIsGreat() {
  println("Golo Golo")
}

if (someCondition) {
  doThis()
} else if someOtherCondition {
  doThat()
} else {
  doThatThing()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The condition of an <code>if</code> statement does not need parenthesis. You may add some to clarify a more
elaborated expression, though.</p>
</div>
</div>
<div class="sect2">
<h3 id="_case_branching">5.2. <code>case</code> branching</h3>
<div class="paragraph">
<p>Golo offers a versatile <code>case</code> construction for conditional branching. It may be used in place of
multiple nested <code>if</code> / <code>else</code> statements, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function what = |obj| {
  case {
    when obj oftype String.class {
      return "String"
    }
    when obj oftype Integer.class {
      return "Integer"
    }
    otherwise {
      return "alien"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>case</code> statement requires at least 1 <code>when</code> clause and a mandatory <code>otherwise</code> clause. Each clause
is being associated with a block. It is semantically equivalent to the corresponding <code>if</code> / <code>else</code>
chain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function what = |obj| {
  if obj oftype String.class {
    return "String"
  } else if obj oftype Integer.class {
    return "Integer"
  } else {
    return "alien"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>when</code> clauses are being evaluated in the declaration order, and only the first satisfied
one is being executed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="match_expressions">5.3. <code>match</code> expressions</h3>
<div class="paragraph">
<p>The <code>match</code> expression is a convenient shortcut for cases where a <code>case</code> statement would be used to
match a value, and give back a result. While it may resemble <strong>pattern matching</strong> operators in some
other languages it is not fully equivalent, as Golo does not support full destructuring matching (but <code>with</code> can help here).</p>
</div>
<div class="paragraph">
<p><code>match</code> is a great addition to the Golo programmer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let item = "foo@bar.com"

let what_it_could_be = |it| -&gt; match {
  when it: contains("@") then "an email?"
  when it: startsWith("+33") then "a French phone number?"
  when it: startsWith("http://") then "a website URL?"
  otherwise "I have no clue, mate!"
}

require(what_it_could_be(item) == "an email?", "error")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The values to be returned are specified after a <code>then</code> keyword that follows a boolean expression to
be evaluated.</p>
</div>
<div class="paragraph">
<p>Like <code>case</code> statements, a <code>match</code> construct needs at least one <code>when</code> clause and one <code>otherwise</code>
clause.</p>
</div>
</div>
<div class="sect2">
<h3 id="_while_loops">5.4. <code>while</code> loops</h3>
<div class="paragraph">
<p>While loops in Golo are straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function times = |n| {
  var times = 0
  while (times &lt; n) { times = times + 1 }
  return times
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parenthesis in the <code>while</code> condition may be omitted like it is the case for <code>if</code> statements.</p>
</div>
</div>
<div class="sect2">
<h3 id="_for_loops">5.5. <code>for</code> loops</h3>
<div class="paragraph">
<p>This is the most versatile loop construction, as it features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a variable declaration and initialization (a Golo variable is always initialized anyway), and</p>
</li>
<li>
<p>a loop progress condition, and</p>
</li>
<li>
<p>a loop progress statement.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following function shows a <code>for</code> loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function fact = |value, n| {
  if n &lt; 0 { return null }
  var result = 1
  for (var i = 0, i &lt; n, i = i + 1) {
    result = result * value
  }
  return result
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, it is very much like a <code>for</code> loop in Java, except that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>for</code> loop elements are separated by <code>','</code> instead of <code>';'</code>, and</p>
</li>
<li>
<p>there cannot be multiple variables in the loop, and</p>
</li>
<li>
<p>there cannot be multiple loop progress statements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Again, this choice is dictated by the pursue of simplicity.</p>
</div>
</div>
<div class="sect2">
<h3 id="foreach_loops">5.6. <code>foreach</code> loops</h3>
<div class="paragraph">
<p>Golo provides a "for each" style of iteration over iterable elements. Any object that is an instance
of <code>java.lang.Iterable</code> can be used in <code>foreach</code> loops, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function concat_to_string = |iterable| {
  var result = ""
  foreach (item in iterable) {
    result = result + item
  }
  return result
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>item</code> is a variable within the <code>foreach</code> loop scope, and <code>iterable</code> is an object
that is expected to be iterable.</p>
</div>
<div class="paragraph">
<p>You may use parenthesis around a <code>foreach</code> expression, so <code>foreach (foo in bar)</code> is equivalent to
<code>foreach foo in bar</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although Java arrays (<code>Object[]</code>) are not real objects, they can be used with <code>foreach</code> loops.
Golo provides a <code>iterator()</code> method for them.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_foreach_loops_with_a_guard">5.7. <code>foreach</code> loops with a guard</h3>
<div class="paragraph">
<p>There is a variant of the <code>foreach</code> loop with a <code>when</code> guard.</p>
</div>
<div class="paragraph">
<p>The following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var result = ""
foreach item in iterable {
  if item &lt; 10 {
    result = result + item
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be simplified as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foreach_guarded = |iterable| {
  var result = ""
  foreach item in iterable when item &gt;= 10 {
    result = result + item
  }
  return result
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>when</code> guard can be any expression that evaluates to a boolean.</p>
</div>
</div>
<div class="sect2">
<h3 id="_break_and_continue">5.8. <code>break</code> and <code>continue</code></h3>
<div class="paragraph">
<p>Although not strictly necessary, the <code>break</code> and <code>continue</code> statements can be useful to simplify
some loops in imperative languages.</p>
</div>
<div class="paragraph">
<p>Like in Java and many other languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>break</code> exits the current inner-most loop, and</p>
</li>
<li>
<p><code>continue</code> skips to the next iteration of the current inner-most loop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider the following contrived example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var i = 0
let s = StringBuilder()
while true {
  i = i + 1
  if i &lt; 40 {
    continue
  } else {
    s: append(i): append(" ")
  }
  if i == 50 {
    break
  }
}
s: append("bye")
require(s: toString() == "40 41 42 43 44 45 46 47 48 49 50 bye", "err")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Golo does not support <code>break</code> statements to labels like Java does. In fact, this is a <code>goto</code>
statement in disguise.</p>
</div>
</div>
<div class="sect2">
<h3 id="_why_no_value_from_most_control_flow_constructions">5.9. Why no value from most control flow constructions?</h3>
<div class="paragraph">
<p>Some programming languages return values from selected control flow constructions, with the returned
value being the evaluation of the last statement in a block. This can be handy in some situations
such as the following code snippet in Scala:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="scala" class="language-scala hljs">println(if (4 % 2 == 0) "even" else "odd")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Golo original author recognizes and appreciates the expressiveness of such construct. However,
he often finds it harder to spot the returned values with such constructs, and he thought that
trading a few keystrokes for <strong>explicitness</strong> was better than shorter construct based in
<strong>implicitness</strong>.</p>
</div>
<div class="paragraph">
<p>Therefore, most Golo control flow constructions do not return values, and programmers are instead
required to extract a variable or provide an explicit <code>return</code> statement.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">6. Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Exception handling in Golo is simple. There is no distinction between <strong>checked</strong> and <strong>unchecked</strong>
exceptions.</p>
</div>
<div class="sect2">
<h3 id="_raising_exceptions">6.1. Raising exceptions</h3>
<div class="paragraph">
<p>Golo provides 2 predefined functions for raising exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>raise(message)</code> throws a <code>java.lang.RuntimeException</code> with a message given as a string, and</p>
</li>
<li>
<p><code>raise(message, cause)</code> does the same and specifies a cause which must be an instance of
<code>java.lang.Throwable</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Throwing an exception is thus as easy as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">if somethingIsWrong() {
  raise("Woops!")
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_raising_specialized_exceptions">6.2. Raising specialized exceptions</h3>
<div class="paragraph">
<p>Of course not every exception shall be an instance of <code>java.lang.RuntimeException</code>. When a more
specialized type is required, you may simply instantiate a Java exception and throw it using the
<code>throw</code> keyword as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module golotest.execution.Exceptions

import java.lang.RuntimeException

function runtimeException = {
  throw RuntimeException("w00t")
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exception_handling">6.3. Exception handling</h3>
<div class="paragraph">
<p>Exception handling uses the familiar <code>try / catch</code>, <code>try / catch / finally</code> and <code>try / finally</code>
constructions. Their semantics are the same as found in other languages such as Java, especially
regarding the handling of <code>finally</code> blocks.</p>
</div>
<div class="paragraph">
<p>The following snippets show each exception handling form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Good old try / catch
try {
  something()
} catch (e) {
  e: printStackTrace()
}

# A try / finally
try {
  doSomething()
} finally {
  cleanup()
}

# Full try / catch / finally construct
try {
  doSomething()
} catch (e) {
  e: printStackTrace()
  case {
    when e oftype IOException.class {
      println("Oh, an I/O exception that I was expecting!")
    }
    when e oftype SecurityException.class {
      println("Damn, I didn't expect a security problem...")
      throw e
    }
    otherwise {
      throw e
    }
  }
} finally {
  cleanup()
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Because Golo is a weakly typed dynamic language, you need to check for the exception type
with the <code>oftype</code> operator. In a statically typed language like Java, you would instead have several
<code>catch</code> clauses with the exception reference given a specific type. We suggest that you take
advantage of the <code>case</code> branching statement.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_closures">7. Closures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo supports <strong>closures</strong>, which means that functions can be treated as first-class citizen.</p>
</div>
<div class="sect2">
<h3 id="_defining_and_using_a_closure">7.1. Defining and using a closure</h3>
<div class="paragraph">
<p>Defining a closure is straightforward as it derives from the way a function can be defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let adder = |a, b| {
  return a + b
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At runtime, a closure is an instance of <code>gololang.FunctionReference</code>, which is essentially a boxing
of <code>java.lang.invoke.MethodHandle</code>. This means that you can do all the operations that method
handles support, such as invoking them or inserting arguments as illustrated in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let adder = |a, b| {
  return a + b
}
println(adder: invoke(1, 2))

let addToTen = adder: bindTo(10)
println(addToTen: invoke(2))</code></pre>
</div>
</div>
<div class="paragraph">
<p>As one would expect, this prints <code>3</code> and <code>12</code>.</p>
</div>
<div class="paragraph">
<p>In order to make closure&#8217;s invocations more <em>fluent</em> you can insert argument using the closure&#8217;s parameter names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let mul = |a, b| {
  return a * b
}

let tenTimes = mul: bindAt("a", 10)
# 20
println(tenTimes: invoke(2))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compact_closures">7.2. Compact closures</h3>
<div class="paragraph">
<p>Golo supports a compact form of closures for the cases where their body consists of a single
expression. The example above can be simplified as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let adder = |a, b| -&gt; a + b</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also use this compact form when defining regular functions, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Foo

local function sayHello = |who| -&gt; "Hello " + who + "!"

# Prints "Hello Julien!"
function main = |args| {
  println(sayHello("Julien"))
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_closures">7.3. Calling closures</h3>
<div class="paragraph">
<p>While you may call function references using <code>invoke</code>, there is a (much) better way.</p>
</div>
<div class="paragraph">
<p>When you have a reference to a closure, you may simply call it as a regular function. The previous
<code>adder</code> example can be equivalently rewritten as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let adder = |a, b| -&gt; a + b
println(adder(1, 2))

let addToTen = adder: bindTo(10)
println(addToTen(2))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_limitations">7.4. Limitations</h3>
<div class="paragraph">
<p>Closures have access to the lexical scope of their defining environment. Consider this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function plus_3 = {
  let foo = 3
  return |x| -&gt; x + foo
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>plus_3</code> function returns a closure that has access to the <code>foo</code> reference, just as you would
expect. The <code>foo</code> reference is said to have been <strong>captured</strong> and made available in the closure.</p>
</div>
<div class="paragraph">
<p>It is important to <strong>note that captured references are constants within the closure</strong>. Consider the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var a = 1
let f = {
  a = 2   # Compilation error!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compilation fails because although <code>a</code> is declared using <code>var</code> in its original scope, it is
actually passed as an argument to the <code>f</code> closure. Because function parameters are implicitly
constant references, this results in a compilation error.</p>
</div>
<div class="paragraph">
<p>That being said, a closure has a reference on the same object as its defining environment, so a
mutable object is a sensible way to pass data back from a closure as a side-effect, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let list = java.util.LinkedList()
let pump_it = {
  list: add("I heard you say")
  list: add("Hey!")
  list: add("Hey!")
}
pump_it()
println(list)</code></pre>
</div>
</div>
<div class="paragraph">
<p>which prints <code>[I heard you say, Hey!, Hey!]</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_closures_to_single_method_interfaces">7.5. Closures to single-method interfaces</h3>
<div class="paragraph">
<p>The Java SE APIs have plenty of interfaces with a single method: <code>java.util.concurrent.Callable</code>,
<code>java.lang.Runnable</code>, <code>javax.swing.ActionListener</code>, etc.</p>
</div>
<div class="paragraph">
<p>The predefined function <code>asInterfaceInstance</code> can be used to convert a method handle or Golo closure
to an instance of a specific interface.</p>
</div>
<div class="paragraph">
<p>Here is how one could pass an action listener to a <code>javax.swing.JButton</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let button = JButton("Click me!")
let handler = |event| -&gt; println("Clicked!")
button: addActionListener(asInterfaceInstance(ActionListener.class, handler))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <code>asInterfaceInstance</code> call consumes some readability budget, you may refactor it with a
local function as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">local function listener = |handler| -&gt; asInterfaceInstance(ActionListener.class, handler)

# (...)
let button = JButton("Click me!")
button: addActionListener(listener(|event| -&gt; println("Clicked!")))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is another example that uses the <code>java.util.concurrent</code> APIs to obtain an executor, pass it a
task, fetch the result with a <code>Future</code> object then shut it down:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function give_me_hey = {
  let executor = Executors.newSingleThreadExecutor()
  let future = executor: submit(asInterfaceInstance(Callable.class, -&gt; "hey!"))
  let result = future: get()
  executor: shutdown()
  return result
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closures_to_java_8_functional_interfaces">7.6. Closures to Java 8 functional interfaces</h3>
<div class="paragraph">
<p>Java 8 introduced support for the so-called <em>lambdas</em>.
The mechanism works through
<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html">functional interfaces</a>,
that is, interfaces with a single abstract method that are annotated with <code>@FunctionalInterface</code>.</p>
</div>
<div class="paragraph">
<p>Golo provides a <code>asFunctionalInterface</code> pre-defined function to convert closures and that works like
the <code>asInterfaceInstance</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let always_true = asFunctionalInterface(java.lang.function.Predicate.class, |obj| -&gt; true)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_direct_closure_passing_works">7.7. Direct closure passing works</h3>
<div class="paragraph">
<p>When a function or method parameter of a Java API expects a single method interface type or a
functional interface, you can pass a closure directly, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Swing action listeners, a classic!
let button = JButton("Click me!")
button: addActionListener(|event| -&gt; println("Clicked!"))

# Java 8 streams / lambdas interop
let result = list[1, 2, 3, 4, 5]:
  stream():
  map(|n| -&gt; n * 10):
  reduce(0, |acc, next| -&gt; acc + next)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this causes the creation of a method handle proxy object for each function or method
invocation. For performance-sensitive contexts, we suggest that you use either
<code>asInterfaceInstance</code>, the <code>to</code> conversion method described hereafter, or <code>asFunctionalInterface</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conversion_to_single_method_interfaces">7.8. Conversion to single-method interfaces</h3>
<div class="paragraph">
<p>Instead of using <code>asInterfaceInstance</code>, you may use a <strong>class augmentation</strong> which is described later in this
documentation. In short, it allows you to call a <code>to</code> method on instances of <code>MethodHandle</code>, which
in turn calls <code>asInterfaceInstance</code>. Back to the previous examples, the next 2 lines are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Calling asInterfaceInstance
future = executor: submit(asInterfaceInstance(Callable.class, -&gt; "hey!"))

# Using a class augmentation
future = executor: submit((-&gt; "hey!"): to(Callable.class))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getting_a_reference_to_a_closure_golo_function">7.9. Getting a reference to a closure / Golo function</h3>
<div class="paragraph">
<p>You may also take advantage of the predefined <code>fun</code> function to obtain a reference to a closure, as
in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import golotest.Closures

local function local_fun = |x| -&gt; x + 1

function call_local_fun = {

  # local_fun, with a parameter
  var f = fun("local_fun", golotest.Closures.module, 1)

  # ...or just like this if there is only 1 local_fun definition
  f = fun("local_fun", golotest.Closures.module)

  return f(1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last but not least, we have an even shorter notation if function are not overridden:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import golotest.Closures

local function local_fun = |x| -&gt; x + 1

function call_local_fun = {

  # In the current module
  var f = ^local_fun

  # ...or with a full module name
  f = ^golotest.Closures::local_fun

  return f(1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the function is overridden, that is several functions exist with the same name but different arities,
you <strong>must</strong> specify the arity with the notation <code>^moduleName::functionName\arity</code>. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">local function foo = |a, b| -&gt; a * b

local function foo = |x| -&gt; x + 1

function call_foo = {
  return ^foo\2(^foo\1(20), 2)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, one can even specify if a varargs function is needed or not (since arity alone can be ambiguous) using final <code>&#8230;&#8203;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">local function foo = |a| -&gt; "unary"
local function foo = |a...| -&gt; "variable"

^foo\1(null) # unary
^foo\1...()  # variable</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can in the same way get a reference to a Java static method. For
instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">list["Foo", null, 42]: filter(^java.util.Objects::nonNull)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also get a reference to a non-static method. In this case, the function
will accept an instance of the class as first argument, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">list["Foo", "Bar", "Hello", "Goodbye"]: map(^String::length)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_binding_and_composing">7.10. Binding and composing</h3>
<div class="paragraph">
<p>You can bind a function first argument using the <code>bindTo(value)</code> method. If you need to bind an
argument at another position than 0, you may take advantage of <code>bindAt(position, value)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let diff = |a, b| -&gt; a - b
let minus10 = diff: bindAt(1, 10)

# 10
println(minus10(20))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may compose functions using the <code>andThen</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let f = (|x| -&gt; x + 1): andThen(|x| -&gt; x - 10): andThen(|x| -&gt; x * 100)

# -500
println(f(4))</code></pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |x| -&gt; x + 1
function bar = |x| -&gt; 2 * x

function main = |args| {
  let newFunction = ^foo: andThen(^bar)

  # 8
  println(newFunction(3))
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_functions_that_return_functions">7.11. Calling functions that return functions</h3>
<div class="paragraph">
<p>Given that functions are first-class objects in Golo, you may define functions (or closures) that
return functions, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let f = |x| -&gt; |y| -&gt; |z| -&gt; x + y + z</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could use intermediate references to use the <code>f</code> function above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let f1 = f(1)
let f2 = f1(2)
let f3 = f2(3)

# Prints '6'
println(f3())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Golo supports a nicer syntax if you don&#8217;t need intermediate references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Prints '6'
println(f(1)(2)(3)())</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_predefined_functions">8. Predefined functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every Golo module definition comes with <code>gololang.Predefined</code> as a default import. It provides
useful functions.</p>
</div>
<div class="sect2">
<h3 id="_console_output">8.1. Console output</h3>
<div class="paragraph">
<p><code>print</code> and <code>println</code> do just what you would expect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">print("Hey")
println()

println("Hey")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_console_input">8.2. Console input</h3>
<div class="paragraph">
<p><code>readln()</code> or <code>readln(strMessage)</code> reads a single line of text from the console. It always returns a
string.</p>
</div>
<div class="paragraph">
<p><code>readPassword()</code> or <code>readPassword(strPassword)</code> reads a password from the console with echoing
disabled. It always returns a string.  There are also <code>secureReadPassword()</code> and
<code>secureReadPassword(strPassword)</code> variants that return a <code>char[]</code> array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let name = readln("what's your name? ")
let value = readln()
let pwd = readPassword("type your password:")</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of Golo 3.3, these functions are in the <code>gololang.IO</code> module, and those in <code>gololang.Predefined</code> are deprecated. They will be removed in Golo 4.0.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_file_io">8.3. File I/O</h3>
<div class="paragraph">
<p>Sometimes it is very desirable to read the content of a text file. The <code>fileToText</code> function does just that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let text = fileToText("/some/file.txt", "UTF-8")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first parameter is either a <code>java.lang.String</code>, a <code>java.io.File</code> or a <code>java.nio.file.Path</code>. The second parameter
represents the encoding charset, either as a <code>java.lang.String</code> or a <code>java.nio.charset.Charset</code>.</p>
</div>
<div class="paragraph">
<p>We can write some text to a file, too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">textToFile("Hello, world!", "/foo/bar.txt")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>textToFile</code> function overwrites existing files, and creates new ones if needed.</p>
</div>
<div class="paragraph">
<p>These functions are provided for convenience, so if you need more fine-grained control over reading and writing text
then we suggest that you look into the <code>java.nio.file</code> package.</p>
</div>
<div class="paragraph">
<p>In addition, if you need to verify that a file exists, you can use the <code>fileExists</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">if fileExists("/foo/bar.txt") {
  println("file found!")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the other File I/O methods, the parameter is either a <code>java.lang.String</code>, a <code>java.io.File</code> or a <code>java.nio.file.Path</code>.
The <code>fileExists</code> function will return true if the file exists, false if it doesn&#8217;t.</p>
</div>
<div class="paragraph">
<p>If you need the current path of execution, you can use the <code>currentDir</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println(currentDir())</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of Golo 3.3, these functions are in the <code>gololang.IO</code> module, and those in <code>gololang.Predefined</code> are deprecated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_number_type_conversions">8.4. Number type conversions</h3>
<div class="paragraph">
<p>The following functions convert any number of string value to another number type:
<code>intValue(n)</code>, <code>longValue(n)</code>, <code>charValue(n)</code>, <code>doubleValue(n)</code> and <code>floatValue(n)</code>.</p>
</div>
<div class="paragraph">
<p>The usual Java type narrowing or widening conventions apply.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let i = intValue("666")   # 666 (string to integer)
let j = intValue(1.234)   # 1 (double to integer)
let k = intValue(666_L)   # 666 (long to integer)
# etc</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions_2">8.5. Exceptions</h3>
<div class="paragraph">
<p><code>raise</code> can be used to throw a <code>java.lang.RuntimeException</code>. It comes in two forms: one with a
message as a string, and one with a message and a cause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">try {
  ...
  raise("Somehow something is wrong")
} catch (e) {
  ...
  raise("Something was wrong, and here is the cause", e)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_preconditions">8.6. Preconditions</h3>
<div class="paragraph">
<p>Preconditions are useful, especially in a dynamically-typed language.</p>
</div>
<div class="paragraph">
<p><code>require</code> can check for a boolean expression along with an error message. In case of error, it
throws an <code>AssertionError</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |a| {
  require(a oftype String.class, "a must be a String")
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also use <code>requireNotNull</code> that&#8230;&#8203; well&#8230;&#8203; checks that its argument is not <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |a| {
  requireNotNull(a)
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arrays">8.7. Arrays</h3>
<div class="paragraph">
<p>Golo arrays can be created using the <code>array[&#8230;&#8203;]</code> literal syntax. Such arrays are of JVM type <code>Object[]</code>.</p>
</div>
<div class="paragraph">
<p>There are cases where one needs typed arrays rather than <code>Object[]</code> arrays, especially when dealing with existing Java
libraries.</p>
</div>
<div class="paragraph">
<p>The <code>newTypedArray</code> predefined function can help:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let data = newTypedArray(java.lang.String.class, 3)
data: set(0, "A")
data: set(1, "B")
data: set(2, "C")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ranges">8.8. Ranges</h3>
<div class="paragraph">
<p>The <code>range</code> function yields an iterable range over either <code>Integer</code>, <code>Long</code> or
<code>Character</code> bounds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Prints 1 2 (...) 100
foreach i in range(1, 101) {
  print(i + " ")
}

# Prints a b c d
foreach c in range('a', 'e') {
  print(c + " ")
}

let r = range(0, 6): incrementBy(2)
println("Start: " + r: from())
println("End: " + r: to())
foreach i in r {
  println(i)
}

println("Increment: " + r: increment())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lower bound is inclusive, the upper bound is exclusive.</p>
</div>
<div class="paragraph">
<p>A <code>range</code> with a lower bound greater than its upper bound will be empty, except
if the increment is explicitly negative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Prints nothing
foreach i in range(3, 0) {
  print(i + " ")
}

# Prints 3 2 1
foreach i in range(3, 0): incrementBy(-1) {
  print(i + " ")
}

# Prints 0 -2 -4
foreach i in range(0, -6):decrementBy(2) {
  print(i + " ")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>reversedRange</code> function is an alias for <code>range</code> with an increment of -1,
such that <code>reversedRange(5, 1)</code> is the same as <code>range(5, 1): decrementBy(1)</code>.</p>
</div>
<div class="paragraph">
<p>When <code>range</code> is called with only one value, it is used as the upper bound, the
lower one being a default value (0 for numbers, 'A' for chars). For example,
<code>range(5) == range(0, 5)</code> and <code>range('Z') == range('A', 'Z')</code>. In the same way,
<code>reversedRange(5) == reversedRange(5, 0)</code>.</p>
</div>
<div class="paragraph">
<p>Two ranges are equals if they have the same bounds and increment.</p>
</div>
<div class="paragraph">
<p>A range can also be defined with the literal notation <code>[begin..end]</code>, which is
equivalent to <code>range(begin, end)</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_closures_2">8.9. Closures</h3>
<div class="paragraph">
<p>Given a function reference, one can convert it to an instance of an interface with a single method
declaration, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">local function listener = |handler| -&gt; asInterfaceInstance(ActionListener.class, handler)

# (...)
let button = JButton("Click me!")
button: addActionListener(listener(|event| -&gt; println("Clicked!")))</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to test if an object is a closure or not with the <code>isClosure</code> function. This is
useful to support values and delayed evaluation, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">if isClosure(value) {
  map: put(key, value())
} else {
  map: put(key, value)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can get a reference to a closure using the predefined <code>fun</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import golotest.Closures

local function local_fun = |x| -&gt; x + 1

function call_local_fun = {
  let f = fun("local_fun", golotest.Closures.module)
  return f(1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because functions may be overloaded, there is a form that accepts an extra parameter for specifying
the number of parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import golotest.Closures

local function local_fun = |x| -&gt; x + 1

function call_local_fun = {
  let f = fun("local_fun", golotest.Closures.module, 1)
  return f(1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While <code>asInterfaceInstance</code> works for single-method interfaces, Java 8 introduced default methods
and functional interfaces to support the so-called <em>lambda</em> expressions.</p>
</div>
<div class="paragraph">
<p>The <code>asFunctionalInterface</code> function is similar to <code>asInterfaceInstance</code> and supports these types of
adaptations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let always_true = asFunctionalInterface(java.lang.function.Predicate.class, |obj| -&gt; true)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_array_types">8.10. Array types</h3>
<div class="paragraph">
<p>Golo does not provide a literal syntax for array types, such as <code>Object[].class</code> in Java.</p>
</div>
<div class="paragraph">
<p>Instead, we provide 3 helper functions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isArray(object)</code>: returns a boolean if <code>object</code> is an array.</p>
</li>
<li>
<p><code>objectArrayType()</code>: returns <code>Object[].class</code>.</p>
</li>
<li>
<p><code>arrayTypeOf(type)</code>: given <code>type</code> as a <code>java.lang.Class</code>, returns <code>type[].class</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_misc">8.11. Misc.</h3>
<div class="paragraph">
<p><code>mapEntry</code> gives instances of <code>java.util.AbstractMap.SimpleEntry</code>, and is used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let e = mapEntry("foo", "bar")

# prints "foo =&gt; bar"
println(e: key() + " =&gt; " + e: value())</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>box</code> gives instances of <code>java.util.concurrent.atomic.AtomicReference</code>, and can
be used to create a mutable reference where not possible otherwise, e.g. in
closures, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function counter = |init, stepFun| {
  let current = box(init)
  return -&gt; current: getAndUpdate(stepFun)
}
#...
let c2 = counter(3, |x| -&gt; x * 2)
c() # -&gt; 3
c() # -&gt; 6
c() # -&gt; 12</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_class_augmentations">9. Class augmentations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many dynamic languages support the ability to extend existing classes by adding new methods to them.
You may think of categories in Objective-C and Groovy, or <strong>open classes</strong> in Ruby.</p>
</div>
<div class="paragraph">
<p>This is generally implemented by providing <strong>meta-classes</strong>. When some piece of code adds a method
<code>foo</code> to, say, <code>SomeClass</code>, then all instances of <code>SomeClass</code> get that new <code>foo</code> method. While very
convenient, such an open system may lead to well-known conflicts between the added methods.</p>
</div>
<div class="paragraph">
<p>Golo provides a more limited but explicit way to add methods to existing classes in the form of
<strong>class augmentations</strong>.</p>
</div>
<div class="sect2">
<h3 id="_wrapping_a_string_with_a_function">9.1. Wrapping a string with a function</h3>
<div class="paragraph">
<p>Let us motivate the value of <strong>augmentations</strong> by starting with the following example. Suppose that we would
like a function to wrap a string with a left and right string. We could do that in Golo as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function wrap = |left, str, right| -&gt; left + str + right

# (...)
let str = wrap("(", "foo", ")")
println(str) # prints "(abc)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defining functions for such tasks makes perfect sense, but what if we could just add the <code>wrap</code>
method to all instances of <code>java.lang.String</code> instead?</p>
</div>
</div>
<div class="sect2">
<h3 id="_augmenting_classes">9.2. Augmenting classes</h3>
<div class="paragraph">
<p>Defining an augmentation is a matter of adding a <code>augment</code> block in a module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module foo

augment java.lang.String {
  function wrap = |this, left, right| -&gt; left + this + right
}

function wrapped = -&gt; "abc": wrap("(", ")")</code></pre>
</div>
</div>
<div class="paragraph">
<p>More specifically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a <code>augment</code> definition is made on a fully-qualified class name, and</p>
</li>
<li>
<p>an augmentation function takes the receiver object as its first argument, followed by optional
arguments, and</p>
</li>
<li>
<p>there can be as many augmentation functions as you want, and</p>
</li>
<li>
<p>there can be as many augmentations as you want.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is a good convention to name the receiver <code>this</code>, but you are free to call it differently.</p>
</div>
<div class="paragraph">
<p>Also, augmentation functions can take variable-arity arguments, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment java.lang.String {

  function concatWith = |this, args...| {
    var result = this
    foreach(arg in args) {
      result = result + arg
    }
    return result
  }
}

# (...)
function varargs = -&gt; "a": concatWith("b", "c", "d")</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be noted that augmentations work with class hierarchies too. The following example adds an
augmentation to <code>java.util.Collection</code>, which also adds it to concrete subclasses such as <code>java.util.LinkedList</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment java.util.Collection {
  function plop = |this| -&gt; "plop!"
}

# (...)
function plop_in_a_list = -&gt; java.util.LinkedList(): plop()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_augmentation_scopes_reusable_augmentations">9.3. Augmentation scopes, reusable augmentations</h3>
<div class="paragraph">
<p>By default, an augmentation is only visible from its defining module.</p>
</div>
<div class="paragraph">
<p><strong>Augmentations are clear and explicit as they
only affect the instances from which you have decided to make them visible.</strong></p>
</div>
<div class="paragraph">
<p>It is advised to place reusable augmentations in separate module definitions. Then, a module that needs such
augmentations can make them available through imports.</p>
</div>
<div class="paragraph">
<p>Suppose that you want to define augmentations for dealing with URLs from strings. You could define a
<code>string-url-augmentations.golo</code> module source as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module my.StringUrlAugmentations

import java.net

augment java.lang.String {

  function toURL = |this| -&gt; URL(this)

  function httpGet = |this| {
    # Open the URL, get a connection, grab the body as a string, etc
    # (...)
  }

  # (...)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, a module willing to take advantage of those augmentations can simply import their defining module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module my.App

import my.StringUrlAugmentations

function googPageBody = -&gt; "http://www.google.com/": httpGet()</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As a matter of style, we suggest that your module names end with <code>Augmentations</code>. Because importing a
module imports <strong>all</strong> of its augmentation definitions, we suggest that you modularize them with <strong>fine
taste</strong> (for what it means).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To allow building libraries of functions leveraging augmentations, the callstack is also looked up in order to find if a complying augmentation was applied to the function arguments. It is thus possible to create a function like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module MyLib

function sayPlop = |o| {
  println(o: plop())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>that can be applied on any object having a <code>plop</code> method, provided this is a native method or it is defined in an augmentation imported in the calling module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_named_augmentations">9.4. Named augmentations</h3>
<div class="paragraph">
<p>It is possible for augmentations to have a name.
A named augmentation is a set of functions that can be applied to some
classes or structures.</p>
</div>
<div class="paragraph">
<p>This can be seen as a kind of lightweight
<a href="http://en.wikipedia.org/wiki/Trait_%28computer_programming%29">trait</a>,
or <a href="http://en.wikipedia.org/wiki/Mixin">mixin</a>,
as found in Rust, Groovy or Scala.</p>
</div>
<div class="paragraph">
<p>Named augmentations are defined with the <code>augmentation</code> keyword.</p>
</div>
<div class="paragraph">
<p>As an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augmentation FooBar = {
  function foo = |this| -&gt; "foo"
  function bar = |this, a| -&gt; this: length() + a
}

augmentation Spamable = {
  function spam = |this| -&gt; "spam"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A named augmentation is applied using the <code>augment &#8230;&#8203; with</code> construct, as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment java.util.Collection with FooBar

augment MyStruct with Spamable

augment java.lang.String with FooBar, Spamable</code></pre>
</div>
</div>
<div class="paragraph">
<p>When applying several named augmentations, they are used in the application
order. For instance, if <code>AugmentA</code> and <code>AugmentB</code> define both the method
<code>meth</code>, and we augment <code>augment java.lang.String with AugmentA, AugmentB</code>, then
calling <code>"": meth()</code> will call <code>AugmentA::meth</code>.</p>
</div>
<div class="paragraph">
<p>Augmentation rules about scopes and reusability apply.
So, if we create a module</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module MyAugmentations

augmentation Searchable = {
  function search = |this, value| -&gt; ...
}

augment java.util.Collection with Searchable</code></pre>
</div>
</div>
<div class="paragraph">
<p>and import it, we can use the applied augmentation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import MyAugmentations

#...
list[1, 2, 3, 4]: search(2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The augmentations defined in an other module can also be applied, provided they
are fully qualified or the module is imported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment java.lang.String with MyAugmentations.Searchable</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import MyAugmentations

augment java.lang.String with Searchable</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If several imported modules define augmentations with the same name, the
<strong>first</strong> imported one will be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The validity of the application is not checked at compile time. Thus augmenting
without importing the coresponding module, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment java.lang.String with Searchable</code></pre>
</div>
</div>
<div class="paragraph">
<p>will not raise an error, but trying to call <code>search</code> on a <code>String</code> will throw a
<code>java.lang.NoSuchMethodError: class java.lang.String::search</code> at <strong>runtime</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As for every augmentation, no checks are made that the augmentation
can be applied to the augmented class. For instance, augmenting <code>java.lang.Number</code>
with the previous <code>FooBar</code> augmentation will raise
<code>java.lang.NoSuchMethodError: class java.lang.Integer::length</code>
at <strong>runtime</strong> when trying to call <code>1:bar(1)</code>. Calling <code>1:foo()</code> will be OK however.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="augment_order">9.5. Augmentations Resolution Order</h3>
<div class="paragraph">
<p>The augmentations resolution order is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>native java method (i.e. an augmentation can&#8217;t override a native java method),</p>
</li>
<li>
<p>locally applied augmentations:</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>simple augmentations: <code>augment MyType { &#8230;&#8203; }</code>,</p>
</li>
<li>
<p>named augmentations: <code>augmentation Foo = { &#8230;&#8203; }</code>
and <code>augment MyType with Foo</code> in the current module. Multiple
applications are searched in the application order,</p>
</li>
<li>
<p>externally defined named augmentations with fully qualified
name: <code>augmentation Foo = { &#8230;&#8203; }</code> in module <code>Augmentations</code>, and
<code>augment MyType with Augmentations.Foo</code> in the current module,</p>
</li>
<li>
<p>named augmentation defined in an imported module:
<code>augmentation Foo = { &#8230;&#8203; }</code> in module <code>Augmentations</code>, and
<code>augment MyType with Foo</code> in the current module that <code>import Augmentations</code>
(imported module are searched in the importation order),</p>
</li>
</ol>
</div>
</li>
<li>
<p>augmentations applied in imported modules:
using the same order than locally applied ones, in the importation order.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first matching method found is used. It is thus possible to “override” an
augmentation with a more higher priority one (in the sens of the previous order).
<a href="#implicit_imports">Implicit modules</a> are imported after explicit ones to allow to redefine standard augmentations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Since importing a module imports all the applied augmentations, and given
the somewhat complex resolution order when involving simple and named
augmentations, being local, external or imported, and involving class
hierarchies, knowing which method will be applied on a given type can be difficult.
A good modularisation and a careful application are recommended.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_defining_a_fallback_behavior">9.6. Defining a fallback behavior</h3>
<div class="paragraph">
<p>Users can augment a class with a <code>fallback</code> behavior to give a very last chance to a failed
method dispacth.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment java.lang.String {
  function fallback = |this, name, args...| {
    return "Dispatch failed for method: " + name + " on instance " + this + ", with args: " + args: asList(): join(" ")
  }
}

println("golo": notExistingMethod(1,2))
# Prints "Dispatch failed for method: notExistingMethod on instance golo, with args: [1, 2]"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_standard_augmentations">9.7. Standard augmentations</h3>
<div class="paragraph">
<p>Golo comes with a set of pre-defined augmentations over collections, strings, closures and more.</p>
</div>
<div class="paragraph">
<p>These augmentation do not require a special import, and they are defined in the
<a href="./golodoc/gololang/StandardAugmentations.html"><code>gololang.StandardAugmentations</code></a> module.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let odd = [1, 2, 3, 4, 5]: filter(|n| -&gt; (n % 2) == 0)

let m = map[]
println(m: getOrElse("foo", -&gt; "bar"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full set of standard augmentations is documented in the generated <strong>golodoc</strong> (hint: look for
<code>doc/golodoc</code> in the Golo distribution).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="structs">10. Structs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo allows the definition of simple structures using the <code>struct</code> keyword. They resemble structures
in procedural languages such as C <code>struct</code> or Pascal <strong>records</strong>. They are useful to store data when
the set of named entries is fixed.</p>
</div>
<div class="sect2">
<h3 id="_definition">10.1. Definition</h3>
<div class="paragraph">
<p>Structures are defined at the module-level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

struct Person = { name, age, email }

function main = |args| {
  let p1 = Person("Mr Bean", 54, "bean@gmail.com")
  println(p1: name())
  let p2 = Person(): name("John"): age(32): email("john@b-root.com")
  println(p2: age())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When declaring a structure, it also defines two factory functions: one with no argument, and one
with all arguments in their order of declaration in the <code>struct</code> statement. When not initialized,
member values are <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Each member yields a <strong>getter</strong> and a <strong>setter</strong> method: given a member <code>a</code>, the getter is method <code>a()</code>
while the setter is method <code>a(newValue)</code>. It should be noted that setter methods return the
structure instance which makes it possible to chain calls as illustrated in the previous example
while building <code>p2</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jvm_existence">10.2. JVM existence</h3>
<div class="paragraph">
<p>Each <code>struct</code> is compiled to a self-contained JVM class.</p>
</div>
<div class="paragraph">
<p>Given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

struct Point = { x, y }</code></pre>
</div>
</div>
<div class="paragraph">
<p>a class <code>sample.types.Point</code> is being generated.</p>
</div>
<div class="paragraph">
<p>It is important to note that:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>each <code>struct</code> class is <code>final</code>,</p>
</li>
<li>
<p>each <code>struct</code> class inherits from <code>gololang.GoloStruct</code>,</p>
</li>
<li>
<p>proper definitions of <code>toString()</code>, <code>hashCode()</code> and <code>equals()</code> are being provided.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_tostring_behavior">10.3. <code>toString()</code> behavior</h3>
<div class="paragraph">
<p>The <code>toString()</code> method is being overridden to provide a meaningful description of a structure
content.</p>
</div>
<div class="paragraph">
<p>Given the following program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module test

struct Point = { x, y }

function main = |args| {
  println(Point(1, 2))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>running it prints the following console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct Point{x=1, y=2}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_immutable_structs">10.4. Immutable structs</h3>
<div class="paragraph">
<p>Structure instances are mutable by default. Golo generates a factory function with the <code>Immutable</code>
prefix to directly build immutable instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module test

struct Point = { x, y }

function main = |args| {

  let p = ImmutablePoint(1, 2)
  println(p)

  try {
    # Fails! (p is immutable)
    p: x(100)
  } catch (expected) {
    println(expected: getMessage())
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="struct-custom-factories">10.5. Custom factories</h3>
<div class="paragraph">
<p>Golo generates two factories for structures. One for the initial values of each member and
a second one with no parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module test

struct Point = { x, y }

function main = |args| {
  println(Point(1, 2))
  println(Point())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>running it prints the following console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct Point{x=1, y=2}
struct Point{x=null, y=null}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default the no-argument factory sets every member to <code>null</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Factories generated by Golo can be overloaded by custom ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module test

struct Point = { x, y }

function Point = -&gt; test.types.Point(0,0)

function main = |args| {
  println(Point(1, 2))
  println(Point())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>running it prints the following console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct Point{x=1, y=2}
struct Point{x=0, y=0}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Immutable factories can be easily overloaded by returning a forzen copy.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module test

struct Point = { x, y }

function ImmutablePoint = |a,b| -&gt; test.types.Point(a,b): frozenCopy()

function main = |args| {
  println(ImmutablePoint(1, 2): isFrozen()) # prints true
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copying">10.6. Copying</h3>
<div class="paragraph">
<p>Instances of a structure provide copying methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>copy()</code> returns a <strong>shallow</strong> copy of the structure instance, and</p>
</li>
<li>
<p><code>frozenCopy()</code> returns a read-only <strong>shallow</strong> copy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Trying to invoke any setter methods on an instance obtained through <code>frozenCopy()</code> raises a
<code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The result of calling <code>copy()</code> on a frozen instance <strong>is a mutable</strong> copy, not a frozen
copy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_equals_and_hashcode_semantics">10.7. <code>equals()</code> and <code>hashCode()</code> semantics</h3>
<div class="paragraph">
<p>Golo structures honor the contract of Java objects regarding equality and hash codes.</p>
</div>
<div class="paragraph">
<p>By default, <code>equals()</code> and <code>hashCode()</code> are the ones of <code>java.lang.Object</code>. Indeed, structure
members can be changed, so they cannot be used to compute stable values.</p>
</div>
<div class="paragraph">
<p>Nevertheless, structure instances returned by <code>frozenCopy()</code> have stable members, and members are
being used.</p>
</div>
<div class="paragraph">
<p>Consider the following program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module StructDemo

struct Point = { x, y }

function main = |args| {

  let p1 = Point(1, 2)
  let p2 = Point(): x(1): y(2)
  let p3 = p1: frozenCopy()
  let p4 = p1: frozenCopy()

  println("p1 == p2 " + (p1 == p2))
  println("p1 == p3 " + (p1 == p3))
  println("p3 == p4 " + (p3 == p4))

  println("#p1 " + p1: hashCode())
  println("#p2 " + p2: hashCode())
  println("#p3 " + p3: hashCode())
  println("#p4 " + p4: hashCode())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the console output is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>p1 == p2 false
p1 == p3 false
p3 == p4 true
#p1 1555845260
#p2 104739310
#p3 994
#p4 994</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is recommended that you use <code>Immutable&lt;name of struct&gt;(&#8230;&#8203;)</code> or <code>frozenCopy()</code> when you can,
especially when storing values into collections.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_comparison_semantics">10.8. Comparison semantics</h3>
<div class="paragraph">
<p>Golo structures are comparable with structures of the same type, provided that their members are comparable pairwise. Two structure are compared by comparing their members lexicographically, that is pairwise in the order they are defined.</p>
</div>
<div class="paragraph">
<p>For instance, the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module test

struct Triplet = {x, y, z}

struct Other = {x, y, z}

function main = |args| {

  let t1 = Triplet(1, 2, 3)
  let t2 = Triplet(1, 3, 2)
  let o = Other(1, 2, 4)

  println(t1 &lt; t2)
  println(t1: values() &lt; o: values())
  println(t1 &lt; o)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>true
true
Exception in thread "main" java.lang.IllegalArgumentException: struct Triplet{x=1, y=2, z=3} and struct Other{x=1, y=2, z=4} can't be compared</pre>
</div>
</div>
<div class="paragraph">
<p>even if <code>Triplet</code> and <code>Other</code> have the same members.</p>
</div>
</div>
<div class="sect2">
<h3 id="_helper_methods">10.9. Helper methods</h3>
<div class="paragraph">
<p>A number of helper methods are being generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>members()</code> returns a tuple of the member names,</p>
</li>
<li>
<p><code>values()</code> returns a tuple with the current member values,</p>
</li>
<li>
<p><code>isFrozen()</code> returns a boolean to check for frozen structure instances,</p>
</li>
<li>
<p><code>iterator()</code> provides an iterator over a structure where each element is a tuple <code>[member, value]</code>,</p>
</li>
<li>
<p><code>get(name)</code> returns the value of a member by its name,</p>
</li>
<li>
<p><code>set(name, value)</code> updates the value of a member by its name, and returns the same structure.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_private_members">10.10. Private members</h3>
<div class="paragraph">
<p>By default, all members in a struct can be accessed. It is possible to make some elements private by
prefixing them with <code>_</code>, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">struct Foo = { a, _b, c }

# (...)

let foo = Foo(1, 2, 3)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>_b</code> is a private struct member. This means that <code>foo: _b()</code> and <code>foo: _b(666)</code> are
valid calls only if made from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a function from the declaring module, or</p>
</li>
<li>
<p>an augmentation defined in the declaring module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any call to, say, <code>foo: _b()</code> from another module will yield a <code>NoSuchMethodError</code> exception.</p>
</div>
<div class="paragraph">
<p>Private struct members also have the following impact:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they do not appear in <code>members()</code> and <code>values()</code> calls, and</p>
</li>
<li>
<p>they are not iterated through <code>iterator()</code>-provided iterators, and</p>
</li>
<li>
<p>they are being used like other members in <code>equals()</code> and <code>hashCode()</code>, and</p>
</li>
<li>
<p>they do not appear in <code>toString()</code> representations.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="struct-augmentation">10.11. Augmenting structs</h3>
<div class="paragraph">
<p>Structs provide a simple data model, especially with private members for encapsulation.</p>
</div>
<div class="paragraph">
<p>Augmenting structs is encouraged, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Plop

struct Point = { _id, x, y }

augment Plop.types.Point {

  function str = |this| -&gt; "{id=" + this: _id() + ",x=" + this: x() + ",y=" + this: y() + "}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an augmentation on a struct is defined <strong>within the same module</strong>, then you can omit the full
type name of the struct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Plop

struct Point = { _id, x, y }

augment Point {

  function str = |this| -&gt; "{id=" + this: _id() + ",x=" + this: x() + ",y=" + this: y() + "}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, it is important to note that augmentations can only access private struct members when they
originate from the same module.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Don&#8217;t do this at home</div>
<div class="paragraph">
<p>Of course doing the following is a bad idea, with the concise augmentation taking over the
fully-qualified one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Foo

struct Value = { v }

augment Foo.types.Value {

  function a = |this| -&gt; "a"
}

# This will discard the previous augmentation...
augment Value {

  function b = |this| -&gt; "a"
}

function check = {
  let v = Value(666)

  # Ok
  v: b()

  # Fails, the concise augmentation overrides the fully-qualifed one
  v: a()
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unions">11. Unions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo allows the definition of sum algebraic data types, also known as
<a href="http://en.wikipedia.org/wiki/Tagged_union">tagged union</a>,
as present in many functional languages: OCaml, Haskell, Rust, Scala to
name a few.
The dual algebraic data type, the product type is provided by <code>struct</code> and <code>tuple</code>.</p>
</div>
<div class="sect2">
<h3 id="_definition_2">11.1. Definition</h3>
<div class="paragraph">
<p>Unions are defined at the module-level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

union Option = {
 Some = { value }
 None
}

function main = |args| {
  let aString = Option.Some("Hello")
  println(aString: value())

  let noString = Option.None()
  println(noString)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usage_example">11.2. Usage example</h3>
<div class="paragraph">
<p>Some well known usages of sum types are the following.</p>
</div>
<div class="sect3">
<h4 id="_enumerations">11.2.1. Enumerations</h4>
<div class="paragraph">
<p>The plain old list of predefined values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">union Color = {
  RED
  GREEN
  BLUE
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This use is similar to Java <code>enum</code>, with the same power since Golo <code>union</code> can be extended through augmentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_option_type">11.2.2. Option type</h4>
<div class="paragraph">
<p>The monadic type as found for instance in OCaml (<code>Option</code>), Haskell (<code>Maybe</code>)
and many other languages (Rust, Scala, etc.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">union Option = {
  Some = {value}
  None
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As illustrated here, and contrary to Java <code>enum</code>, each alternative value can
have different fields. A <code>union</code> alternative type is in this respect similar to immutable <code>struct</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recursive_data_structures">11.2.3. Recursive data structures</h4>
<div class="paragraph">
<p>The usual functional representation of linked lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">union ConsList = {
  List = { head, tail }
  Empty
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Binary trees:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">union Tree = {
  Empty
  Leaf = { value }
  Node = { left, right }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jvm_existence_2">11.3. JVM existence</h3>
<div class="paragraph">
<p>A <code>union</code> type is compiled to an abstract JVM class. Each alternative value
type is itself compiled to a final immutable JVM class extending the abstract class.
The value classes are member classes of the abstract one.</p>
</div>
<div class="paragraph">
<p>Given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

union Option = {
  Some = { value }
  None
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>three classes are generated:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>an abstract class <code>sample.types.Option</code>,</p>
</li>
<li>
<p>a concrete final immutable inner class <code>sample.types.Option$Some</code> extending the first
one,</p>
</li>
<li>
<p>a similar class <code>sample.types.Option$None</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For your convenience, the abstract class provides factories static methods for each of the possible
values, and you can&#8217;t instantiate values directly, since values without fields
are actually singletons.</p>
</div>
<div class="paragraph">
<p>Note that proper definitions of <code>toString()</code>, <code>hashCode()</code> and <code>equals()</code> are
provided. These definitions are similar to the ones defined for frozen <code>struct</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>union</code> values with fields are similar to frozen <code>struct</code>, that is
are immutable, have getters for fields and are compared by values. However,
these types does not feature the same helper methods, and can&#8217;t have private
members.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_special_testing_methods">11.4. Special testing methods</h3>
<div class="paragraph">
<p>Unions feature special methods to test for the exact type of a value, as well
as members values if applicable. This allows to write readable tests, more
specially using the <code>match</code> clause, to look like destructuring match in
languages like OCaml, Haskell or Scala.</p>
</div>
<div class="paragraph">
<p>For instance, given a union defining a binary tree:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">union Tree = {
  Node = {left, right}
  Leaf = {value}
  Empty
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>one can match a <code>elt</code> value using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">match {
  when elt: isEmpty() then // we have an empty value
  when elt: isLeaf(0) then // we have a leaf containing 0
  when elt: isLeaf()  then // we have a leaf (whatever the value)
  when elt: isNode(Empty(), Empty()) then // we have a node with empty children
  when elt: isNode(Leaf(42), Leaf(42)) then // we have a node whose both children contain 42
  when elt: isNode() then // we have a node, whatever the values
  otherwise // default case...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More precisely, each possible union value provides parameterless methods
testing its exact type, named <code>is&lt;TypeName&gt;</code>. In the tree example, three
methods are defined: <code>isEmpty()</code>, <code>isLeaf()</code> and <code>isNode()</code>.
In addition to these methods, a method with parameters is defined for every
alternative with members, here <code>isLeaf(value)</code> and <code>isNode(left, right)</code>. The arguments
are compared for equality to the members of the union value.
For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">Leaf(0): isLeaf(0) # true
Leaf(42): isLeaf(0) # false</code></pre>
</div>
</div>
<div class="paragraph">
<p>allowing readable test and match clauses.</p>
</div>
<div class="paragraph">
<p>A special singleton value is available to make these clauses even more
readable: the <code>Unknown</code> value. This special singleton is considered equal to
any other object (except <code>null</code>), and thus can be used in the parametrized test
methods to ignore some members. For instance, to match a <code>Node</code> with only one
child, one can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let _ = Unknown.get()

function dealWithTree = |elt| -&gt; match {
  when elt: isNode(Empty(), _) or elt: isNode(_, Empty()) then ...
    // one of the children is Empty, whatever the other one
  otherwise ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_augmenting_unions">11.5. Augmenting unions</h3>
<div class="paragraph">
<p>Since the <code>union</code> itself is a abstract class, and each possible value is a
concrete class extending it, it is possible to augment the whole <code>union</code>, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment Option {
  function map = |this, func| -&gt; match {
    when this: isNone() then this
    otherwise Option.Some(func(this: value()))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or just a value, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">augment ConsList$Empty {
  function size = |this| -&gt; 0
  function head = |this| -&gt; null
  function tail = |this| -&gt; this
}

augment ConsList$List {
  function size = |this| -&gt; 1 + this: tail(): size()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_objects">12. Dynamic objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dynamic objects can have values and methods being added and removed dynamically at runtime. You can
think of it as an enhancement over using hash maps and putting closures in them.</p>
</div>
<div class="sect2">
<h3 id="_creating_dynamic_objects">12.1. Creating dynamic objects</h3>
<div class="paragraph">
<p>Creating a dynamic object is as simple as calling the <code>DynamicObject</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let foo = DynamicObject()</code></pre>
</div>
</div>
<div class="paragraph">
<p>A dynamic object can also be tagged using an arbitrary value as its kind. To create a tagged dynamic object, simply use a value in the constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let bar = DynamicObject("Bar")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dynamic objects have the following <strong>reserved</strong> methods, that is, methods that you cannot override:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>define(name, value)</code> allows to define an object property, which can be either a value or a
closure, and</p>
</li>
<li>
<p><code>get(name)</code> gives the value or closure for a property name, or <code>null</code> if there is none, and</p>
</li>
<li>
<p><code>undefine(name)</code> removes a property from the object, and</p>
</li>
<li>
<p><code>mixin(dynobj)</code> mixes in all the properties of the dynamic object <code>dynobj</code>, and</p>
</li>
<li>
<p><code>copy()</code> gives a copy of a dynamic object, and</p>
</li>
<li>
<p><code>freeze()</code> locks an object, and calling <code>define</code> will raise an <code>IllegalStateException</code>, and</p>
</li>
<li>
<p><code>isFrozen()</code> checks whether a dynamic object is frozen or not, and</p>
</li>
<li>
<p><code>properties()</code> gives the set of entries in the dynamic object, and</p>
</li>
<li>
<p><code>hasMethod(name)</code> checks if a method is defined or not in the dynamic object, and</p>
</li>
<li>
<p><code>invoker(name, type)</code> which is mostly used by the Golo runtime internals, and</p>
</li>
<li>
<p><code>hasKind(value)</code> tests if the dynamic object is tagged with this value, and</p>
</li>
<li>
<p><code>sameKind(other)</code> tests if two dynamic objects have the same kind, and</p>
</li>
<li>
<p><code>fallback(handler)</code> defines a fallback behavior for property invocation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Moreover, a suitable <code>toString</code> method is provided, but you can override it by defining a <code>toString</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_values">12.2. Defining values</h3>
<div class="paragraph">
<p>Defining values also defines getter and setter methods, as illustrated by the next example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let person = DynamicObject():
  define("name", "MrBean"):
  define("email", "mrbean@gmail.com")

# prints "Mr Bean"
println(person: name())

# prints "Mr Beanz"
person: name("Mr Beanz")
println(person: name())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling a setter method for a non-existent property defines it, hence the previous example can be
rewritten as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let person = DynamicObject(): name("MrBean"): email("mrbean@gmail.com")

# prints "Mr Bean"
println(person: name())

# prints "Mr Beanz"
person: name("Mr Beanz")
println(person: name())</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_methods">12.3. Defining methods</h3>
<div class="paragraph">
<p>Dynamic object methods are simply defined as closures. They must take the dynamic object object as
their first argument, and we suggest that you call it <code>this</code>. You can then define as many parameters
as you want.</p>
</div>
<div class="paragraph">
<p>Here is an example where we define a <code>toString</code>-style of method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">local function mrbean = -&gt; DynamicObject():
  name("Mr Bean"):
  email("mrbean@gmail.com"):
  define("toString", |this| -&gt; this: name() + " &lt;" + this: email() + "&gt;")

function main = |args| {

  let bean = mrbean()
  println(bean: toString())

  bean: email("mrbean@outlook.com")
  println(bean: toString())
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You cannot overload methods, that is, providing methods with the same name but different
signatures.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is strongly recommended that you use <code>define</code> to create and update methods.
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let obj = DynamicObject():
  plop(|this| -&gt; "Plop!")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any call such as <code>obj: plop()</code> properly calls <code>plop()</code>. Because the dynamic object is fresh and new,
the first call to <code>plop</code> creates a property since it is currently missing.</p>
</div>
<div class="paragraph">
<p>That being said, the following would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">obj: plop(|this| -&gt; "Plop it up!")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, when the value of a dynamic object property is a function, it is understood to be a method,
hence calling <code>plop</code> like it would be a setter method fails because there already exists a property
that is a function, and it has a different signature. It needs to be updated as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">obj: define('plop', |this| -&gt; "Plop it up!")</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>As a rule of thumb, prefer named setters for values and <code>define</code> for methods. It is acceptable
to have named definitions for methods if and only if a call happens after the object creation and
before any call to <code>mixin</code> (remember that it injects properties from other objects, including
methods).</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_querying_the_properties">12.4. Querying the properties</h3>
<div class="paragraph">
<p>The <code>properties()</code> method returns a set of entries, as instances of <code>java.util.Map.Entry</code>. You can
thus write code such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function dump = |obj| {
  foreach prop in obj: properties() {
    println(prop: key() + " -&gt; " + prop: value())
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because dynamic object entries mix both values and function references, do not forget that the predefined
<code>isClosure(obj)</code> function can be useful to distinguish them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_a_fallback_behavior_2">12.5. Defining a fallback behavior</h3>
<div class="paragraph">
<p>The <code>fallback(handler)</code> method let&#8217;s the user define a method that is invoked whenever the initial method dispatch fails.
Here is an example of how to define a fallback.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Calling a setter method for a non-existent property defines it, thus the fallback is not applicable for setters.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let dynob = DynamicObject():
  fallback(|this, method, args...| {
    return "Dispatch failed for method: " + method + ", with args: " + args: asList(): join(" ")
  })

println(dynob: casperGetter())
println(dynob: casperMethod("foo", "bar"))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">Dispatch failed for method: casperGetter, with args:
Dispatch failed for method: casperMethod, with args: foo bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>delegate</code> function is available to ease defining a fallback function that delegates on another dynamic object. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let t = DynamicObject("deleguee")
  : name("Zaphod")
  : define("sayHello", |this| -&gt; "Hello, I'm " + this: name())

let s = DynamicObject("withFallback")
  : fallback(DynamicObject.delegate(t))

require(s: sayHello() == "Hello, I'm Zaphod", "error")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kind_of_dynamic_objects">12.6. Kind of dynamic objects</h3>
<div class="paragraph">
<p>The kind of a dynamic object can be any value. The more typical values are strings and unions (enumerations). This value is used by the <code>toString()</code>  method to display a more specific representation of the object, and defaults to the string <code>"DynamicObject"</code>. By using the two predefined methods <code>hasKind(value)</code> and <code>sameKind(other)</code>, it is possible to test for the kind of a dynamic object. Note that the kind of a created object can&#8217;t be changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function Person = |name, age| -&gt; DynamicObject("Person")
    : name(name)
    : age(age)
    : define("marry", |this, other| {
      require(this: sameKind(other), "Can only marry a person")
      this: spouse(other)
      other: spouse(this)
    })

function printAge = |obj| {
  if (obj: hasKind("Person")) {
    println(obj: age())
  } else {
    println("I have no age")
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adapters">13. Adapters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is already much you can do while in Golo land using functions, closures, structs,
augmentations and dynamic objects.</p>
</div>
<div class="paragraph">
<p>Yet, the JVM is a wider ecosystem and you will soon be tempted to integrate existing Java libraries
into your code. Calling Java libraries from Golo is quite easy, but what happens when you need to
subclass classes or provide objects that implement specific interfaces?</p>
</div>
<div class="paragraph">
<p>As you can easily guess, this is all what adapters are about: they allow the definition of objects
at runtime that can extend and inherit Java types.</p>
</div>
<div class="sect2">
<h3 id="_a_simple_example">13.1. A simple example</h3>
<div class="paragraph">
<p>Let us get started with a simple example of a web application based on the nice Spark micro-framework
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Spark requires route handlers to extend an abstract base class called <code>spark.Route</code>. The following
code snippet does just that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sparky

import spark
import spark.Spark

function main = |args| {
  let conf = map[   <i class="conum" data-value="1"></i><b>(1)</b>
    ["extends", "spark.Route"],   <i class="conum" data-value="2"></i><b>(2)</b>
    ["implements", map[   <i class="conum" data-value="3"></i><b>(3)</b>
      ["handle", |this, request, response| {  <i class="conum" data-value="4"></i><b>(4)</b>
        return "Golo, world!"
      }]
    ]]
  ]
  let fabric = AdapterFabric()  <i class="conum" data-value="5"></i><b>(5)</b>
  let routeMaker = fabric: maker(conf)  <i class="conum" data-value="6"></i><b>(6)</b>
  let route = routeMaker: newInstance("/hello")   <i class="conum" data-value="7"></i><b>(7)</b>
  get(route)  <i class="conum" data-value="8"></i><b>(8)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An adapter configuration is provided by a map object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>extends</code> key allows specifying the name of the parent class (<code>java.lang.Object</code> by
default).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>implements</code> provides a map of method implementations.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The implementation is given by a closure whose signature matches the parent class definition,
and where the first argument is the receiver object that is going to be the adapter instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>An adapter fabric provides context for creating adapters. It manages its own class loader.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>An adapter maker creates instances based on a configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The <code>newInstance()</code> method calls the right constructor based on the parent class constructors
and provided argument types.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The <code>spark.Spark.get()</code> static is method is happy as we feed it a subclass of <code>spark.Route</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Adapter objects implement the <code>gololang.GoloAdapter</code> marker interface, so you can do type
checks on them a in: <code>(foo oftype gololang.GoloAdapter.class)</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_interfaces">13.2. Implementing interfaces</h3>
<div class="paragraph">
<p>This is as easy as providing a <code>java.lang.Iterable</code> as part of the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let result = array[1, 2, 3]
let conf = map[
  ["interfaces", ["java.io.Serializable", "java.lang.Runnable"]],
  ["implements", map[
    ["run", |this| {
      for (var i = 0, i &lt; result: length(), i = i + 1) {
        result: set(i, result: get(i) + 10)
      }
    }]
  ]]
]
let runner = AdapterFabric(): maker(conf): newInstance()
runner: run() <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>As you may guess, this changes the <code>result</code> array values to <code>[11, 12, 13]</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_overrides">13.3. Overrides</h3>
<div class="paragraph">
<p>Implementations are great, but what happens if you need to call the parent class implementation of a
method? In Java, you would use a <code>super</code> reference, but Golo does not provide that.</p>
</div>
<div class="paragraph">
<p>Instead, you can override methods, and have the parent class implementation given to you as a
method handle parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let conf = map[
  ["overrides", map[
    ["toString", |super, this| -&gt; "&gt;&gt;&gt; " + super(this)]
  ]]
]
let val = AdapterFabric(): maker(conf): newInstance()
println(val: toString()) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This prints something like: <code>&gt;&gt;&gt; $Golo$Adapter$0@12fc7ceb</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can mix both implementations and overrides in an adapter configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_star_implementations_and_overrides">13.4. Star implementations and overrides</h3>
<div class="paragraph">
<p>You can pass <code>*</code> as a name for implementations or overrides. In such cases, the provided closure
become the dispatch targets for all methods that do not have an implementation or override. Note
that providing both a star implementation and a star override is an error.</p>
</div>
<div class="paragraph">
<p>Let us see a concrete example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">  let carbonCopy = list[]                               <i class="conum" data-value="1"></i><b>(1)</b>
  let conf = map[
    ["extends", "java.util.ArrayList"],
    ["overrides", map[
      ["*", |super, name, args| {                       <i class="conum" data-value="2"></i><b>(2)</b>
        if name == "add" {
          if args: length() == 2 {
            carbonCopy: add(args: get(1))               <i class="conum" data-value="3"></i><b>(3)</b>
          } else {
            carbonCopy: add(args: get(1), args: get(2)) <i class="conum" data-value="4"></i><b>(4)</b>
          }
        }
        return super: spread(args)                      <i class="conum" data-value="5"></i><b>(5)</b>
      }
    ]]
  ]]
  let list = AdapterFabric(): maker(conf): newInstance()
  list: add("bar")
  list: add(0, "foo")
  list: add("baz")                                      <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create an empty list, more on that later.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A star override takes 3 parameters: the parent class implementation, the method name and the
arguments into an array (the element at index 0 is the receiver).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We copy into <code>carbonCopy</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Same here, but we dispatch to a different method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We just call the parent class implementation of whatever method it is. Note that <code>spread</code> allows
to dispatch a closure call with an array of arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>At this point <code>carbonCopy</code> contains <code>["foo", "bar", "baz"]</code> (and so does <code>list</code>, too).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The case of star implementation is similar, except that the closure takes only 2 parameters:
<code>|name, args|</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_misc_2">13.5. Misc.</h3>
<div class="paragraph">
<p>The <code>AdapterFabric</code> constructor can also take a class loader as a parameter. When none is provided,
the current thread context class loader is being used as a parent for an <code>AdapterFabric</code>-internal
classloader. There is also a static method <code>withParentClassLoader(classloader)</code> to obtain a fabric
whose class loader is based on a provided parent.</p>
</div>
<div class="paragraph">
<p>As it is often the case for dynamic languages on the JVM, overloaded methods with the same name but
different methods are painful. In such cases, we suggest that you take advantage of
star-implementations or star-overrides as illustrated above on a <code>ArrayList</code> subclass where the 2
<code>add(obj)</code> and <code>add(index, obj)</code> methods are being intercepted.</p>
</div>
<div class="paragraph">
<p>Finally we do not encourage you to use adapters as part of Golo code outside of providing bridges to
third-party APIs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adapters_helper">13.6. Adapters helper</h3>
<div class="paragraph">
<p>This is another way to use the adapters. You can see that as a kind of DSL for the Golo adapters. Let&#8217;s see how to re-write the examples in the previous paragraph</p>
</div>
<div class="sect3">
<h4 id="_a_simple_example_2">13.6.1. A simple example</h4>
<div class="paragraph">
<p>Let us get started (again) with a simple example of a web application based on the Spark micro-framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sparky

import gololang.Adapters
import spark
import spark.Spark

function main = |args| {
  let sparkRouteAdapter = Adapter()   <i class="conum" data-value="1"></i><b>(1)</b>
    : extends("spark.Route")   <i class="conum" data-value="2"></i><b>(2)</b>
    : implements("handle", |this, request, response| {   <i class="conum" data-value="3"></i><b>(3)</b>
        return "Golo, world!"
      })
  let route = sparkRouteAdapter: newInstance("/hello")  <i class="conum" data-value="4"></i><b>(4)</b>
  get(route)  <i class="conum" data-value="5"></i><b>(5)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An adapter factory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>extends</code> method specifies the name of the parent class (<code>java.lang.Object</code> by
default).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>implements</code> method specifies the method implementations.
The implementation is given by a closure whose signature matches the parent class definition,
and where the first argument is the receiver object that is going to be the adapter instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>newInstance()</code> method calls the right constructor based on the parent class constructors
and provided argument types.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>spark.Spark.get()</code> static is method is happy as we feed it a subclass of <code>spark.Route</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_interfaces_2">13.6.2. Implementing interfaces</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let result = array[1, 2, 3]
let conf = Adapter(): interfaces(["java.io.Serializable", "java.lang.Runnable"])
  : implements("run", |this| {
      for (var i = 0, i &lt; result: length(), i = i + 1) {
        result: set(i, result: get(i) + 10)
      }
  })
let runner = conf: newInstance()
runner: run() <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>As you may guess, this changes the <code>result</code> array values to <code>[11, 12, 13]</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_overrides_2">13.6.3. Overrides</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let conf = Adapter(): overrides("toString", |super, this| -&gt; "&gt;&gt;&gt; " + super(this))
let val = conf: newInstance()
println(val) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This prints something like: <code>&gt;&gt;&gt; $Golo$Adapter$0@12fc7ceb</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_star_implementations_and_overrides_2">13.6.4. Star implementations and overrides</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let carbonCopy = list[]
let conf = Adapter(): extends("java.util.ArrayList")
  : overrides("*", |super, name, args| {
      if name == "add" {
        if args: length() == 2 {
          carbonCopy: add(args: get(1))
        } else {
          carbonCopy: add(args: get(1), args: get(2))
        }
      }
      return super: invoke(args)
  })
let list = conf: newInstance()
list: add("bar")
list: add(0, "foo")
list: add("baz")    <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>At this point <code>carbonCopy</code> contains <code>["foo", "bar", "baz"]</code> (and so does <code>list</code>, too).</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="decorators">14. Decorators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo features Python-like decorators.</p>
</div>
<div class="sect2">
<h3 id="_presentation">14.1. Presentation</h3>
<div class="paragraph">
<p>Decorators are similar in syntax and purpose to Java annotations.
However, the concepts behind them are very different. Indeed, whereas Java
annotations are compiler or VM directives, decorators are actually plain
functions, more precisely higher order functions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Higher order functions (HOF) are functions that process functions, i.e. that take
a function as parameter, and may return a new function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A decorator is thus a function that take the function to decorate as parameter,
and return a new function, generally a wrapper that do some stuffs before or
after calling the original function.</p>
</div>
<div class="paragraph">
<p>The name can remind the well known
<a href="http://en.wikipedia.org/wiki/Decorator_pattern">GoF Pattern</a>, with good reason.
This pattern describe a design that allow an object to be augmented by wrapping
it in an other object with the same interface, delegating operations to the
wrapped object. This is exactly what a decorator does here, the interface
being “function” (more precisely a <a href="./javadoc/gololang/FunctionReference"><code>gololang.FunctionReference</code></a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="deco_principles">14.2. Principles and syntax</h3>
<div class="paragraph">
<p>As in Python, and similarly to Java annotations, a decorator is used with a
<code>@</code> prefix before the function definition. As an example, the decorator
<code>deco1</code> only prints its name before returning the result unchanged</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function deco1 = |fun| {
  return |args...| {
    return "deco1 + " + fun: invoke(args)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be used as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@deco1
function foo = |a| {
  return "foo: " + a
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, calling <code>println(foo(1))</code> will print <code>deco1 + foo: 1</code>.</p>
</div>
<div class="paragraph">
<p>To be the most generic, the function created by a decorator should be a
variable arity function, and thus call the decorated function with
<code>invoke</code>, such that it can be applied to any function, regardless
of its arity, as in the previous example.</p>
</div>
<div class="paragraph">
<p>Indeed, suppose you what to a decorator <code>dec</code> (that does nothing) used like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@dec
function add = |a,b| -&gt; a + b</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such a decorator can be implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function dec = |func| -&gt; |a, b| -&gt; func(a, b)</code></pre>
</div>
</div>
<div class="paragraph">
<p>But in that case, it will be applicable to two parameters functions only.
On the other hand, you cannot do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function dec = |func| -&gt; |args...| -&gt; func(args)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, this will throw an exception because <code>func</code> is not a variable arity
function (just a reference on <code>add</code> function) and thus cannot take an array
as parameter. In this case, the decorator have to invoke the original function
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function dec = |func| -&gt; |args...| -&gt; func(args: get(0), args: get(1))</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is equivalent to the first form, but is not generic. The more generic
decorator is thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function dec = |func| -&gt; |args...| -&gt; func: invoke(args)</code></pre>
</div>
</div>
<div class="paragraph">
<p>which can deal with any function.</p>
</div>
<div class="paragraph">
<p>As illustrated, the decorator is just a wrapper (closure) around the decorated
function. The <code>@</code> syntax is just syntactic sugar. Indeed, it can also be used
as such:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function bar = |a| -&gt; "bar: " + a

function main = |args| {
  println(deco1(^bar)(1))

  let decobar = deco1(^bar)
  println(decobar(1))

  println(deco1(|a| -&gt; "bar: "+a)(1))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>prints all <code>deco1 + bar: 1</code>.</p>
</div>
<div class="paragraph">
<p>Decorators can also be stacked. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function deco2 = |fun| {
  return |args...| {
    return "deco2 + " + fun: invoke(args)
  }
}

@deco2
@deco1
function baz = |a| -&gt; "baz: " + a</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>println(baz(1))</code> will print <code>deco2 + deco1 + baz: 1</code></p>
</div>
<div class="paragraph">
<p>This result can also be achieved by composing decorators, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let deco3 = ^deco1: andThen(^deco2)

@deco3
function spam = |a| -&gt; "spam: " + a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, <code>println(spam(1))</code> will print <code>deco2 + deco1 + spam: 1</code></p>
</div>
<div class="paragraph">
<p>Moreover, since decorator are just higher order functions, they can be closure
on a first argument, i.e. parametrized decorators, as illustrated in the
following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module tests.LogDeco

function log = |msg| -&gt; |fun| -&gt; |args...| {
  println(msg)
  return fun: invoke(args)
}

@log("calling foo")
function foo = |a| {
  println("foo got a " + a)
}

@log("I'am a bar")
function bar = |a| -&gt; 2*a

function main = |args| {
  foo("bar")
  println(bar(21))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will print</p>
</div>
<div class="listingblock">
<div class="content">
<pre>calling foo
foo got a bar
I'am a bar
42</pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>log</code> create a closure on the message, and return the decorator function.
Thus, <code>log("hello")</code> is a function that take a function as parameter, and
return a new function printing the message (<code>hello</code>) before delegating to the
inner function.</p>
</div>
<div class="paragraph">
<p>Again, since all of this are just functions, you can create shortcuts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let sayHello = log("Hello")

@sayHello
function baz = -&gt; "Goodbye"</code></pre>
</div>
</div>
<div class="paragraph">
<p>A call to <code>println(baz())</code> will print</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello
Goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>The only requirement is that the effective decorator (the expression following
the <code>@</code>) is eventually a HOF returning a closure on the decorated function. As
an example, it can be as elaborated as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function log = |msgBefore| -&gt; |msgAfter| -&gt; |func| -&gt; |args...| {
  println(msgBefore)
  let res = func: invoke(args)
  println(msgAfter)
  return res
}

@log("enter foo")("exit foo")
function foo = |a| {
  println("foo: " + a)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where a call <code>foo("bar")</code> will print</p>
</div>
<div class="listingblock">
<div class="content">
<pre>enter foo
foo: bar
exit foo</pre>
</div>
</div>
<div class="paragraph">
<p>and with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function logEnterExit = |name| -&gt; log("# enter " + name)("# exit " + name)

@logEnterExit("bar")
function bar = { println("doing something...") }</code></pre>
</div>
</div>
<div class="paragraph">
<p>calling <code>bar()</code> will print</p>
</div>
<div class="listingblock">
<div class="content">
<pre># enter bar
doing something...
# exit bar</pre>
</div>
</div>
<div class="paragraph">
<p>or even, without decorator syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function main = |args| {
  let strange_use = log("hello")("goodbye")({println(":p")})
  strange_use()

  log("another")("use")(|a|{println(a)})("strange")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A last thing (but not the least), the function returned by the decorator can
have a different arity than the original one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function curry = |f| -&gt; |a| -&gt; |b| -&gt; f(a, b)

@curry
function add = |a,b| -&gt; a + b

function main = |args| {
  add(12)(30)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@curry</code> decorator transform the <code>add</code> function that takes two arguments,
into a function that takes only one argument and returns a function that takes
the second argument and finally return the result of the addition.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A more refined version of this <code>curry</code> decorator is available in the <a href="./golodoc/gololang/Functions#curry_1"><code>gololang.Functions</code></a> standard module
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A decorator is applied only if the decorated function is called from Golo
code. For example if you try to call a decorated Golo function from Java code
it will not be the decorated function that will be called but the original one.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is possible to create decorator and decorated functions in pure Java:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package decorators;

import gololang.annotations.DecoratedBy;
import gololang.FunctionReference;

public class Decorators {

  public static Object decorator(Object original) {
    FunctionReference reference = (FunctionReference) original;
    // do some transformations
    System.out.println("decorator!");
    return reference;
  }

  @DecoratedBy("decorator")
  public static int add(int a, int b) {
    return a + b;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s call this from Golo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import decorators.Decorators

function main = |args| {
  println(add(10,32))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>decorator!
42</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now illustrate with some use cases and examples, with a presentation of
some decorators of the standard module
<a href="./golodoc/gololang/Decorators.html"><code>gololang.Decorators</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_cases_and_examples">14.3. Use cases and examples</h3>
<div class="paragraph">
<p>Use cases are at least the same as
<a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">aspect oriented programming</a>
(AOP) and the
<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator design pattern</a>,
but your imagination is your limit.
Some are presented here for illustration.</p>
</div>
<div class="sect3">
<h4 id="_logging">14.3.1. Logging</h4>
<div class="paragraph">
<p>Logging is a classical example use case of AOP. See the
<a href="#deco_principles">Principles and syntax</a> section for an example.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prepost_conditions_checking">14.3.2. Pre/post conditions checking</h4>
<div class="paragraph">
<p>Decorators can be used to check pre-conditions, that is conditions that must
hold for arguments, and post-conditions, that is conditions that must hold for
returned values, of a function.</p>
</div>
<div class="paragraph">
<p>Indeed, a decorated can execute code before delegating to the decorated
function, of after the delegation.</p>
</div>
<div class="paragraph">
<p>The module <a href="./golodoc/gololang/Decorators.html"><code>gololang.Decorators</code></a> provides two
decorators and several utility functions to check pre and post conditions.</p>
</div>
<div class="paragraph">
<p><code>checkResult</code> is a parametrized decorator taking a checker as parameter. It
checks that the result of the decorated function is valid.</p>
</div>
<div class="paragraph">
<p><code>checkArguments</code> is a variable arity function, taking as much checkers as the
decorated function arguments. It checks that the arguments of the decorated
function are valid according to the corresponding checker (1st argument checked
by 1st checker, and so on).</p>
</div>
<div class="paragraph">
<p>A checker is a function that raises an exception if its argument is not valid
(e.g. using <code>require</code>) or returns it unchanged, allowing checkers to be chained
using the <code>andThen</code> method.</p>
</div>
<div class="paragraph">
<p>As an example, one can check that the arguments and result of a function are
integers with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let isInteger = |v| {
  require(v oftype Integer.class, v + "is not an Integer")
  return v
}

@checkResult(isInteger)
@checkArguments(isInteger, isInteger)
function add = |a, b| -&gt; a + b</code></pre>
</div>
</div>
<div class="paragraph">
<p>or that the argument is a positive integer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let isPositive = |v| {
  require(v &gt; 0, v + "is not &gt; 0")
  return v
}

@checkArguments(isInteger: andThen(isPositive))
function inv = |v| -&gt; 1.0 / v</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, again, you can take shortcuts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let isPositiveInt = isInteger: andThen(isPositive)

@checkResult(isPositiveInt)
@checkArguments(isPositiveInt)
function double = |v| -&gt; 2 * v</code></pre>
</div>
</div>
<div class="paragraph">
<p>or even</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let myCheck = checkArguments(isInteger: andThen(isPositive))

@myCheck
function inv = |v| -&gt; 1.0 / v

@myCheck
function mul = |v| -&gt; 10 * v</code></pre>
</div>
</div>
<div class="paragraph">
<p>Several factory functions are available in
<a href="./golodoc/gololang/Decorators.html"><code>gololang.Decorators</code></a> to ease the creation
of checkers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>any</code> is a void checker that does nothing. It can used when you need to check
only some arguments of a n-ary function.</p>
</li>
<li>
<p><code>asChecker</code> is a factory that takes a boolean function and an error message
and returns the corresponding checker. For instance:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let isPositive = asChecker(|v| -&gt; v &gt; 0, "is not positive")</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isOfType</code> is a factory function that returns a function checking types,
e.g.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let isInteger = isOfType(Integer.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full set of standard checkers is documented in the
<a href="./golodoc/gololang/Decorators">generated <em>golodoc</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_locking">14.3.3. Locking</h4>
<div class="paragraph">
<p>As seen, decorator can be used to wrap a function call between checking
operation, but also between a lock/unlock in a concurrent context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import java.util.concurrent.locks

function withLock = |lock| -&gt; |fun| -&gt; |args...| {
  lock: lock()
  try {
    return fun: invoke(args)
  } finally {
    lock: unlock()
  }
}

let myLock = ReentrantLock()

@withLock(myLock)
function foo = |a, b| {
  return a + b
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_memoization">14.3.4. Memoization</h4>
<div class="paragraph">
<p>Memoization is the optimization technique that stores the results of a expensive
computation to return them directly on subsequent calls. It is quite easy,
using decorators, to transform a function into a memoized one. The decorator
creates a closure on a hashmap, and check the existence of the results before
delegating to the decorated function, and storing the result in the hashmap if
needed.</p>
</div>
<div class="paragraph">
<p>Such a decorator is provided in the
<a href="./golodoc/gololang/Decorators.html"><code>gololang.Decorators</code></a> module, presented
here as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function memoizer = {
  var cache = map[]
  return |fun| {
    return |args...| {
      let key = [fun: hashCode(), Tuple(args)]
      if (not cache: containsKey(key)) {
        cache: add(key, fun: invoke(args))
      }
      return cache: get(key)
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cache key is the decorated function
and its call arguments, thus the decorator can be used for every module
functions. It must however be put in a module-level state, since in the current
implementation, the decoration is invoked at each call. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let memo = memoizer()

@memo
function fib = |n| {
  if n &lt;= 1 {
    return n
  } else {
    return fib(n - 1) + fib(n - 2)
  }
}

@memo
function fact = |n| {
  if n == 0 {
    return 1
  } else {
    return n * fact(n - 1)
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generic_context">14.3.5. Generic context</h4>
<div class="paragraph">
<p>Decorators can be used to define a generic wrapper around a function, that
extends the previous example (and can be used to implement most of them).
This functionality is provided by the
<a href="./golodoc/gololang/Decorators.html#withContext_1"><code>gololang.Decorators::withContext</code></a>
standard decorator. This decorator take a context, such as the one returned by
<a href="./golodoc/gololang/Decorators.html#defaultContext_0"><code>gololang.Decorators::defaultContext</code></a>
function.</p>
</div>
<div class="paragraph">
<p>A context is an object with 4 defined methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>entry</code>, that takes and returns the function arguments.
This method can be used to check arguments or apply transformation to them;</p>
</li>
<li>
<p><code>exit</code>, that takes and returns the result of the function.
This method can be used to check conditions or transform the result;</p>
</li>
<li>
<p><code>catcher</code>, that deal with exceptions that occurs during function execution. It
takes the exception as parameter;</p>
</li>
<li>
<p><code>finallizer</code>, that is called in a <code>finally</code> clause after function execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The context returned by <a href="./golodoc/gololang/Decorators#defaultContext_0"><code>gololang.Decorators::defaultContext</code></a> is a void one, that
is <code>entry</code> and <code>exit</code> return their parameters unchanged,
<code>catcher</code> rethrow the exception and <code>finallizer</code> does nothing.</p>
</div>
<div class="paragraph">
<p>The workflow of this decorator is as follow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the context <code>entry</code> method is called on the function arguments;</p>
</li>
<li>
<p>the decorated function is called with arguments returned by <code>entry</code>;</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>if an exception is raised, <code>catcher</code> is called with it as parameter;</p>
</li>
<li>
<p>else the result is passed to <code>exit</code> and the returned value is returned</p>
</li>
</ol>
</div>
</li>
<li>
<p>the <code>finallizer</code> method is called.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Any of theses methods can modify the context internal state.</p>
</div>
<div class="paragraph">
<p>Here is an usage example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module samples.ContextDecorator

import gololang.Decorators

let myContext = defaultContext():
  count(0):
  define("entry", |this, args| {
    this: count(this: count() + 1)
    println("hello:" + this: count())
    return args
  }):
  define("exit", |this, result| {
    require(result &gt;= 3, "wrong value")
    println("goobye")
    return result
  }):
  define("catcher", |this, e| {
    println("Caught " + e)
    throw e
  }):
  define("finallizer", |this| {println("do some cleanup")})


@withContext(myContext)
function foo = |a, b| {
  println("Hard computation")
  return a + b
}

function main = |args| {
  println(foo(1,2))
  println("====")
  println(withContext(myContext)(|a| -&gt; 2*a)(3))
  println("====")
  try {
    println(foo(1, 1))
  } catch (e) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which prints</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hello:1
Hard computation
goobye
do some cleanup
3
====
hello:2
goobye
do some cleanup
6
====
hello:3
Hard computation
Caught java.lang.AssertionError: wrong value
do some cleanup</pre>
</div>
</div>
<div class="paragraph">
<p>Since the context is here shared between decorations, the <code>count</code> attribute is
incremented by each call to every decorated function, thus the output.</p>
</div>
<div class="paragraph">
<p>This generic decorator can be used to easily implement condition checking,
logging, locking, and so on. It can be more interesting if you want to provide
several functionalities, instead of stacking more specific decorators, since
stacking, or decorator composition, adds indirection levels and deepen the call
stack.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_banged_function_call">15. Banged function call</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo uses invokedynamic
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>
<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>
to dynamically link at runtime an invocation instruction to the target code that will be effectively executed.</p>
</div>
<div class="paragraph">
<p>An invocation is done in three steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, a computation is executed to find the target code,</p>
</li>
<li>
<p>then, the call site of the invocation is plugged to this target,</p>
</li>
<li>
<p>finally the target code is executed as if it had been linked at load time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two phases are mostly executed once for a call site, according there&#8217;s no need to re-link the call site to his target code.</p>
</div>
<div class="paragraph">
<p>A function call marked with bang (<code>!</code>) is directly linked to the result returned by the target execution.</p>
</div>
<div class="paragraph">
<p>A banged invocation is executed like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, a computation is executed to find the target code,</p>
</li>
<li>
<p>then the target code is executed,</p>
</li>
<li>
<p>finally, the call site of the invocation is plugged to a constant MethodHandle
<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>
which returns the target computation result as a constant value.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_principles_and_syntax">15.1. Principles and syntax</h3>
<div class="paragraph">
<p>A function call marked with bang (<code>!</code>) will be called only once,
the result is stored as a constant and will be directly returned for every subsequent call.</p>
</div>
<div class="paragraph">
<p>A function call can be marked with a bang like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

function take_a_while  = {
  # ... complex computation
  return 42
}


function main = |args| {

  foreach i in range(0, 100) {
   take_a_while!()
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <code>take_a_while</code> is computed only once at the first call, and then this function returns directly the previously computed result as a constant for every subsequent call.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>!</code> notation can only be used on regular function calls. Indeed, since methods are context
dependant (the object itself), it is not allowed to “bang” them. As a consequence, a function
invocation using <code>invoke</code> of a function reference can&#8217;t use this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bang function call is a kind of memoization but regardless of the given parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

function hello = |name| {
  return "Hello " + name + "!"
}


function main = |args| {
  foreach name in ["Peter", "John", "James"] {
    println( hello!(name) # will always print 'Hello Peter!'
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <code>hello</code> is executed at the first call with the parameter
<code>"Peter"</code>, then always returns <code>"Hello Peter!"</code>, even when called with other
values.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Functions having side effects <strong>should</strong> not be marked, since the computation
is not done for subsequent calls, and thus the side effect can&#8217;t happen. In the
same way, function that depends on an outside context are risky. Indeed, a
change in the context won&#8217;t imply a change in the result any more. In other
words, only <em>pure</em> functions should be marked with a <code>!</code>. No check is done by
the language, use it at your own risk.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The result of a banged function call is constant within the same call place,
but different for each call instructions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

function hello = |name| {
  return "Hello " + name + "!"
}

function main = |args| {
  println( hello!("Foo") ) # will print 'Hello Foo!'
  println( hello!("Bar") ) # will print 'Hello Bar!'
  foreach name in ["Peter", "John", "James"] {
   println( hello!(name) # will always print 'Hello Peter!'
  }
  foreach name in ["Peter", "John", "James"] {
   println( hello(name) # will print 'Hello Peter!', 'Hello John!', 'Hello James!'
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous listing, the <code>hello!(name)</code> in the loop is considered the same
call, and thus evaluated only on the first iteration. On the other hand, the
previous calls with <code>"Foo"</code> and <code>"Bar"</code> are distinct, and therefore prints
different results.</p>
</div>
<div class="paragraph">
<p>Anonymous function call and object constructor call can be banged too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module sample

function closure = |x| {
  return |y| {
    return x * y
  }
}

function singleton = -&gt; java.lang.Object!()

function main = |args| {

  foreach i in range(0, 100) {
    println( closure(i)!(i) ) # will always print 0
  }

  require(
    singleton(): hashCode() == singleton(): hashCode(),
    "Houston, ..."
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <code>closure(i)!(i)</code> always return <code>0</code> because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>closure(i)</code> returns a closure (<code>|y| &#8594; x * y</code>) with <code>x</code> as enclosed variable</p>
</li>
<li>
<p><code>closure(i)</code> is computed for each value of <code>i</code></p>
</li>
<li>
<p>the closure returned by <code>closure(i)</code> is called at the first iteration with <code>0</code> for <code>x</code> and <code>y</code></p>
</li>
<li>
<p>for every subsequent call <code>closure(i)</code> is still computed but ignored because the anonymous call is replaced by the return of a constant value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>singleton</code> function return a new java Object but the <code>java.lang.Object</code> is created with a banged constructor call, then the returned reference is constant.</p>
</div>
</div>
<div class="sect2">
<h3 id="_banged_decorators">15.2. Banged decorators</h3>
<div class="paragraph">
<p>As explained in the <a href="#decorators">decorators part</a> the following <code>identity</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function decorator =  |func| -&gt; |x| -&gt; func(x)

@decorator
function identity = |x| -&gt; x</code></pre>
</div>
</div>
<div class="paragraph">
<p>is expanded to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function decorator =  |func| -&gt; |x| -&gt; func(x)

function identity = |x| -&gt; decorator(|x| -&gt; x)(x)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A banged decorator declared with the <code>@!</code> syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function decorator =  |func| -&gt; |x| -&gt; func(x)

@!decorator
function identity = |x| -&gt; x</code></pre>
</div>
</div>
<div class="paragraph">
<p>is expanded to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function decorator =  |func| -&gt; |x| -&gt; func(x)

function identity = |x| -&gt; decorator!(|x| -&gt; x)(x)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen previously, the <code>decorator</code> function is called only the first time.
For every subsequent call, the function reference returned by the decorator is not re-computed but directly used as a constant.</p>
</div>
<div class="paragraph">
<p>Parametrized decorators can be banged too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function decorator =  |arg| -&gt; |func| -&gt; |x| -&gt; func(x)

@!decorator(42)
function identity = |x| -&gt; x</code></pre>
</div>
</div>
<div class="paragraph">
<p>is expanded to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function decorator =  |arg| -&gt; |func| -&gt; |x| -&gt; func(x)

function identity = |x| -&gt; decorator(42)!(|x| -&gt; x)(x)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Considering the return of a banged call is constant, a common pitfall
is to think that differents calls share the same <em>"context"</em> regardless where the call is located into the code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, consider two functions decorated with the same parametrized decorator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@!deco("a")
function foo = |a| -&gt; a

@!deco("b")
function bar = |b| -&gt; b</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions are expanded to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |a| -&gt; deco("a")!(|a| -&gt; a)(a)

function bar = |b| -&gt; deco("b")!(|b| -&gt; b)(b)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>deco("a")!(|a| &#8594; a)</code> return a function that we can name for the example <code>func_a</code>,
and <code>deco("b")!(|b| &#8594; b)</code> return another function that we can name <code>func_b</code>.</p>
</div>
<div class="paragraph">
<p>Then, for every subsequent call of <code>foo</code> and <code>bar</code>, the executed code is
somehow equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |a| -&gt; func_a(a)

function bar = |b| -&gt; func_b(b)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>func_a</code> and <code>func_b</code> are now constant but different because they are not from the same <em>"banged call instruction"</em>.</p>
</div>
<div class="paragraph">
<p>Performances can considerably increase with banged decorators, since the
decorator function is no more called for each decorated function call.
On the other hand, the decorator function has to be pure (without side-effects) and his parameters stable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_code_evaluation">16. Dynamic code evaluation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo provides facilities for dynamically evaluating code from strings in the form of the
<code>gololang.EvaluationEnvironment</code> class. It provides an API that is useful both when used from Golo
code, or when used from a polyglot JVM application that embeds Golo.</p>
</div>
<div class="sect2">
<h3 id="_loading_a_module">16.1. Loading a module</h3>
<div class="paragraph">
<p>The code of a complete module can be evaluated by the <code>asModule</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = gololang.EvaluationEnvironment()
  let code =
"""
module foo

function a = -&gt; "a!"
function b = -&gt; "b!"
"""
  let mod = env: asModule(code)
  let a = fun("a", mod)
  let b = fun("b", mod)
  println("&gt;&gt;&gt; asModule()")
  println(a())
  println(b())</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that an <code>EvaluationEnvironment</code> instance has a <code>GoloClassloader</code>, and that
attempting to evaluate module code with the same <code>module</code> declaration will cause an error. Indeed, a
class loader cannot load classes with the same name twice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_anonymous_modules">16.2. Anonymous modules</h3>
<div class="paragraph">
<p>The <code>anonymousModule</code> method is similar to <code>asModule</code>, except that the code to evaluate is free of
<code>module</code> declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = gololang.EvaluationEnvironment()
  let code =
"""
function a = -&gt; "a."
function b = -&gt; "b."
"""
  let mod = env: anonymousModule(code)
  let a = fun("a", mod)
  let b = fun("b", mod)
  println("&gt;&gt;&gt; anonymousModule()")
  println(a())
  println(b())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modules that get evaluated through <code>anonymousModule</code> have unique names, hence this method is
suitable in cases where the same code is to be re-evaluated several times.</p>
</div>
</div>
<div class="sect2">
<h3 id="_functions_2">16.3. Functions</h3>
<div class="paragraph">
<p>The <code>asFunction</code> and <code>def</code> methods evaluate function code. Here is how <code>asFunction</code> can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = gololang.EvaluationEnvironment()
let code = "return (a + b) * 2"
let f = env: asFunction(code, "a", "b")
println("&gt;&gt;&gt; asFunction")
println(f(10, 20))</code></pre>
</div>
</div>
<div class="paragraph">
<p>It evaluates straight code as the body of a function. Note that <code>imports</code> can be used to specify
<code>import</code> statements to be available while evaluation the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">env:
  imports("java.util.LinkedList", "java.util.HashMap"):
  asFunction("""let l = LinkedList()
let m = HashMap()""")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>def</code> method is similar, except that it has the parameters definition in the code to evaluate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = gololang.EvaluationEnvironment()
let code = "|a, b| -&gt; (a + b) * 2"
let f = env: def(code)
println("&gt;&gt;&gt; def")
println(f(10, 20))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_code">16.4. Running code</h3>
<div class="paragraph">
<p>The first form of <code>run</code> method works as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = gololang.EvaluationEnvironment()
let code = """println("&gt;&gt;&gt; run")
foreach (i in range(0, 3)) {
  println("w00t")
}
return 666"""
println(env: run(code)) # =&gt; "w00t"x3 and "666"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second form allows passing parameter values in a map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = gololang.EvaluationEnvironment()
let code = """println("&gt;&gt;&gt; run_map")
println(a)
println(b)
"""
let values = java.util.TreeMap(): add("a", 1): add("b", 2)
env: run(code, values)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important not to abuse <code>run</code>, as each invocation triggers the generation of a one-shot
class. If the same code is to be run several times, we suggest that you take advantage of either
<code>def</code> or <code>asFunction</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concurrency_with_workers">17. Concurrency with workers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Concurrency is <strong>hard</strong>. Fortunately for us the <code>java.util.concurrent</code> packages bring useful
abstractions, data types and execution mechanisms to get concurrency <strong>"a little bit better"</strong>.</p>
</div>
<div class="paragraph">
<p>Golo doesn&#8217;t provide a equivalent to the <code>synchronized</code> keyword of Java. This is on-purpose: when
facing concurrency, we advise you to just use whatever is in <code>java.util.concurrent</code>.</p>
</div>
<div class="paragraph">
<p>That being said we provide a simple abstraction for concurrent executions in the form of <strong>workers</strong>.
They pretty much resemble JavaScript web workers or <strong>isolates</strong> in Dart, albeit they do not really
isolate the workers data space.</p>
</div>
<div class="sect2">
<h3 id="_the_big_picture">17.1. The big picture</h3>
<div class="paragraph">
<p>A <strong>worker</strong> is simply a Golo function that can be executed concurrently. You can pass <strong>messages</strong> to a
worker, and they are eventually received and handled by their target worker. In other words, workers
react to messages in an asynchronous fashion.</p>
</div>
<div class="paragraph">
<p>Communications between a worker and some client code happens through <strong>ports</strong>. A <strong>port</strong> is simply an
object that is responsible for dispatching a message to its worker.</p>
</div>
<div class="paragraph">
<p>Ports are obtained by <strong>spawning</strong> a worker function from a <strong>worker environment</strong>. Internally, a worker
environment manages a <code>java.util.concurrent</code> executor, which means that you do not have to deal with
thread management.</p>
</div>
</div>
<div class="sect2">
<h3 id="_worker_environments">17.2. Worker environments</h3>
<div class="paragraph">
<p>Worker environments are defined in the <code>gololang.concurrent.workers.WorkerEnvironment</code> class /
module.</p>
</div>
<div class="paragraph">
<p>You can directly pass an instance of <code>java.util.concurrent.ExecutorService</code> to its constructor, or
you may go through its builder object and call either of the following static methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>withCachedThreadPool()</code> uses a cached thread pool,</p>
</li>
<li>
<p><code>withFixedThreadPool(size)</code> uses a fixed number of threads in a pool,</p>
</li>
<li>
<p><code>withFixedThreadPool()</code> uses a pool with 1 thread per processor core,</p>
</li>
<li>
<p><code>withSingleThreadExecutor()</code> uses a single executor thread.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most scenarios <code>withCachedThreadPool()</code> is a safe choice, but as usual, your mileage varies. If
you have many concurrent tasks to perform and they are not IO-bound, then <code>withFixedThreadPool()</code> is
probably a better option. You should always measure, and remember that you can always pass a
fine-tuned executor to the <code>WorkerEnvironment()</code> constructor.</p>
</div>
<div class="paragraph">
<p>Worker environments also provide delegate methods to their internal executor. It is important to
call <code>shutdown()</code> to close the workers environment and release the threads pool. You can also call
the <code>awaitTermination</code>, <code>isShutdown</code> and <code>isTerminated</code> methods whose semantics are exactly those of
<code>java.util.concurrent.ExecutorService</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_spawning_a_worker_and_passing_messages">17.3. Spawning a worker and passing messages</h3>
<div class="paragraph">
<p>Worker functions take a single parameter which is the message to be received. To obtain a port, you
need to call the <code>spawn(target)</code> function of a worker environment, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let env = WorkerEnvironment.builder(): withFixedThreadPool()
let port = env: spawn(|message| -&gt; println("&gt;&gt;&gt; " + message))</code></pre>
</div>
</div>
<div class="paragraph">
<p>A port provides a <code>send(message)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">port: send("hello"): send("world")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Messages are being put in a queue, and eventually dispatched to the function that we spawned.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_complete_and_useless_example">17.4. A complete and useless example</h3>
<div class="paragraph">
<p>To better understand how workers can be used, here is a (fairly useless) example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module SampleWithWorkers

import java.lang.Thread
import java.util.concurrent
import gololang.concurrent.workers.WorkerEnvironment

local function pusher = |queue, message| -&gt; queue: offer(message) <i class="conum" data-value="3"></i><b>(3)</b>

local function generator = |port, message| { <i class="conum" data-value="1"></i><b>(1)</b>
  foreach i in range(0, 100) {
    port: send(message)                      <i class="conum" data-value="2"></i><b>(2)</b>
  }
}

function main = |args| {

  let env = WorkerEnvironment.builder(): withFixedThreadPool()
  let queue = ConcurrentLinkedQueue()

  let pusherPort = env: spawn(^pusher: bindTo(queue))
  let generatorPort = env: spawn(^generator: bindTo(pusherPort))

  let finishPort = env: spawn(|any| -&gt; env: shutdown()) <i class="conum" data-value="5"></i><b>(5)</b>

  foreach i in range(0, 10) {
    generatorPort: send("[" + i + "]")
  }
  Thread.sleep(2000_L)
  finishPort: send("Die!") <i class="conum" data-value="4"></i><b>(4)</b>

  env: awaitTermination(2000)
  println(queue: reduce("", |acc, next| -&gt; acc + " " + next))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we spawn 3 workers:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the first repeats a message 100 times,</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203;forwarding them to another one,</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>&#8230;&#8203;that ultimately pushes them to a concurrent queue.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A message is sent to a final worker,</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203;that shuts the workers environment down.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an aside, the example illustrates that worker functions may take further dependencies as
arguments. The <code>pusher</code> function takes a queue target and <code>generator</code> needs a port.</p>
</div>
<div class="paragraph">
<p>You can satisfy dependencies by pre-binding function arguments, all you need is to make sure that
each function passed to <code>spawn</code> only expects a single message as its argument, as in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>^pusher: bindTo(queue)</code>, and</p>
</li>
<li>
<p><code>^generator: bindTo(pusherPort)</code>, and</p>
</li>
<li>
<p><code>env: spawn(|any| &#8594; env: shutdown())</code> where the worker function is defined as a closure, and
implicitly captures its <code>env</code> dependency from the surrounding context.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_golo_template_engine">18. Golo template engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo comes with a built-in template engine that is reminiscent of Java Server Pages or Ruby ERB. It
compiles template text into Golo functions.</p>
</div>
<div class="sect2">
<h3 id="_example">18.1. Example</h3>
<div class="paragraph">
<p>Consider the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">  let template = """
&lt;%@params posts %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Golo Chat&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;form action="/" method="post"&gt;
    &lt;input type="text" name="msg"&gt;
    &lt;input type="submit" value="Send"&gt;
  &lt;/form&gt;
  &lt;div&gt;
    &lt;h3&gt;Last posts&lt;/h3&gt;
    &lt;% foreach post in posts { %&gt;
      &lt;div&gt;
        &lt;%= post %&gt;
      &lt;/div&gt;
    &lt;% } %&gt;
  &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>This multi-line string has a Golo template. It can be compiled into a function as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tpl = gololang.TemplateEngine(): compile(template)
println(tpl(someDataModel: posts()))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directives">18.2. Directives</h3>
<div class="paragraph">
<p>As you may have guess from the previous example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Golo code snippets are placed in <code>&lt;% %&gt;</code> blocks, and</p>
</li>
<li>
<p>expressions can output values using <code>&lt;%= %&gt;</code>, and</p>
</li>
<li>
<p><code>&lt;%@import foo.bar.Baz %&gt;</code> causes <code>foo.bar.Baz</code> to be imported, and</p>
</li>
<li>
<p><code>&lt;%@params foo, bar, baz %&gt;</code> causes the template function to have 3 parameters, i.e., it is a
<code>|foo, bar, baz| { &#8230;&#8203; }</code> function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When no <code>&lt;%@params &#8230;&#8203; %&gt;</code> exists, the function is assumed to have a single <code>params</code> parameter.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The template engine is a simple one and makes <strong>no</strong> verification either on the templates
or the resulting Golo source code. The <code>compile</code> method may throw a <code>GoloCompilation</code> exception
though, and you can query the exception <code>getSourceCode()</code> and <code>getProblems()</code> methods to obtain
more details.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_macros">19. Macros</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golo&#8217;s macro system gives the developer access to some language internals.
This allows to extend the language and reduce boilerplate code relatively easily.</p>
</div>
<div class="sect2">
<h3 id="macros-principle">19.1. Principle</h3>
<div class="paragraph">
<p>First, let&#8217;s remind some basis of the compilation process.
Here is a simplified view of the way Golo compiles a program:</p>
</div>
<div id="compilation-steps" class="olist arabic">
<ol class="arabic">
<li>
<p>read the source code text and parse it (creates an AST),</p>
</li>
<li>
<p>generate an intermediate representation tree (IR) that reflects the code structure,</p>
</li>
<li>
<p>do some checks and magic on the IR (syntactic sugar, closed values in lambda, etc.)</p>
</li>
<li>
<p>generate JVM bytecode from the final IR.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The IR tree is a logical representation of the program structure, independently of the text (and even the concrete syntax).
A representation of this tree can be seen using the <a href="./man/man1/golo-diagnose.html"><code>golo diagnose</code></a> command.</p>
</div>
<div class="paragraph">
<p>As an example, the following Golo code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module hello.World

function main = |args| {
  println("Hello world!")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>gives the following (simplified) IR:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hello.World
#   Function main = |args|
#     Block
#        - LocalReference{kind=CONSTANT, name='args', index=0}
#       Function call: println
#         Constant = Hello world!
#       Return
#         Constant = null</pre>
</div>
</div>
<div class="paragraph">
<p>Golo macros are functions that manipulate this IR tree at compile time, between the steps 2 and 3 above.
They are similar to C preprocessing macros, but much more powerful and robust.</p>
</div>
<div class="paragraph">
<p>Using macros, one can generate functions and types and inject them in the program, create alternative control structures that will be transformed into regular ones, or create instructions computed at compile time instead of runtime (e.g. display debug messages if a environment variable is set).</p>
</div>
<div class="paragraph">
<p>More generally, macros can be seen as a way to trade dynamic runtime dependencies for static compile time ones.
Indeed, many dynamic Golo features, like module imports or named augmentations, can be made static by using macros instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_macros">19.2. Creating macros</h3>
<div class="paragraph">
<p>Macros are regular functions (or Java static methods) whose parameters are IR nodes, and that return an IR node.</p>
</div>
<div class="paragraph">
<p>In order to identify macro calls in the IR and to provide some checks, macros need to be identified as such.
A Java static method intended to be used as a macro must be annotated with the <a href="./javadoc/org/eclipse/golo/compiler/macro/Macro.html"><code>org.eclipse.golo.compiler.macro.Macro</code></a> annotation.
In the same way, a Golo function that is actually a macro is declared using the <code>macro</code> keyword instead of <code>function</code>.
It is otherwise a regular function.</p>
</div>
<div class="paragraph">
<p>Most macros work by returning a new node that will replace the macro call in the final IR tree (see <a href="#substituting_macros">Substituting macros</a>).
It is thus necessary to create a subtree representing the Golo code that will be compiled.
To ease this creation, a fluent API over the IR tree elements is provided.</p>
</div>
<div class="sect3">
<h4 id="_ir_api">19.2.1. IR API</h4>
<div class="paragraph">
<p>The package <a href="./javadoc/gololang/ir/package-summary.html"><code>gololang.ir</code></a> contains the classes used to represent elements of the Golo language, and thus nodes in the IR tree.
These classes provide a fluent API to configure their instances.
The <a href="./golodoc/gololang/ir/DSL.html"><code>gololang.ir.DSL</code></a> module contains factory functions and augmentations to ease the creation of these nodes.</p>
</div>
<div class="paragraph">
<p>For instance, a subtree representing the Golo code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">obj: foo(42)</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be created by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">invoke("foo"): withArgs(42): on(refLookup("obj"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the subtree of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = {
  let f = |a, b| -&gt; a + b
  return f("answer ", 42)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be created by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">`function("foo"): body(
  define("f"): as(
    lambda("a", "b"): returns(plus(refLookup("a"), refLookup("b")))),
  returns(call("f"): withArgs(constant("answer "), constant(42)))
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="./golodoc/gololang/ir/DSL.html">golodoc</a> for a full description of this API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_quoting">19.2.2. Quoting</h4>
<div class="paragraph">
<p>An other way to create IR nodes is to use the <code>quote</code> macro from the <a href="./golodoc/gololang/ir/Quote.html"><code>gololang.ir.Quote</code></a> module.
This macro convert its argument node into calls to the builder functions and IR API.
For instance, the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let f = &amp;quote(|a, b| -&gt; a + b)</code></pre>
</div>
</div>
<div class="paragraph">
<p>is expanded into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let f = gololang.ir.lambda("a", "b"): block(
  gololang.ir.Block.of(gololang.ir.ReturnStatement.of(
    gololang.ir.BinaryOperation.create(gololang.ir.OperatorType.PLUS(),
      gololang.ir.ReferenceLookup.of("a"),
      gololang.ir.ReferenceLookup.of("b")))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>where all calls are fully qualified ones, so there is no need to import the <code>gololang.ir</code> modules.</p>
</div>
<div class="paragraph">
<p>See the corresponding <a href="./golodoc/gololang/ir/Quote.html">golodoc</a> for a full documentation of this module.</p>
</div>
</div>
<div class="sect3">
<h4 id="special_macros">19.2.3. Special macros</h4>
<div class="paragraph">
<p>Special macros are macros that can interact with the expansion visitor itself.
They allow to tune the way macros are expanded in the current module.
The predefined special macros are currently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>use</code>: adds a module to lookup macros into;</p>
</li>
<li>
<p><code>dontExpandRegularCalls</code>: don&#8217;t try to expand regular calls as macros; all macro calls must therefore be prefixed with <code>&amp;</code>;</p>
</li>
<li>
<p><code>dontRecurse</code>: don&#8217;t expand the result of a macro (can be useful for debugging);</p>
</li>
<li>
<p><code>recursionLimit</code>: define the nesting limit of macro calls.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Special macros can be created in Java by using the <a href="./javadoc/org/eclipse/golo/compiler/macro/SpecialMacro.html"><code>org.eclipse.golo.compiler.macro.SpecialMacro</code></a> annotation and accepting a <a href="./javadoc/org/eclipse/golo/compiler/macro/MacroExpansionIrVisitor.html"><code>org.eclipse.golo.compiler.macro.MacroExpansionIrVisitor</code></a> as first parameter.
In golo, the <code>@special</code> decorator macro can be used to specify that a macro is a special one, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@special
macro mySpecialMacro = |visitor, arg| { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_macros">19.3. Using macros</h3>
<div class="sect3">
<h4 id="_execution_model">19.3.1. Execution model</h4>
<div class="paragraph">
<p>When the IR tree is created by the parser, it is fed to the macro expansion process.
A visitor walk the tree to search for macro invocations and try to expand them.</p>
</div>
<div class="paragraph">
<p>Syntactically, macros can be called as regular functions.
However, to be explicit, the call can optionally use the <code>&amp;</code> prefix to be identified as a macro invocation.
Since macros can be called where function calls are not allowed (e.g. at the root of the module), these calls must also be explicitly prefixed with <code>&amp;</code>.</p>
</div>
<div class="paragraph">
<p>To expand a macro, the compiler tries to find the corresponding macro function (or static method annotated with <code>@Macro</code>) that matches the callsite.
This search is much simpler than regular function calls, since it does not involve the full golo resolution engine.
As such, some features are not available for macro, such as banged call or named arguments <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup>.</p>
</div>
<div id="macro-dont-expand-regular" class="paragraph">
<p>Since the compiler tries to expand every function call in the tree, this step can be time consuming.
This strategy can be turned off with the <code>&amp;dontExpandRegularCalls()</code> <a href="#special_macros">special macro</a>.
In that case, every macro invocation <em>must</em> be prefixed with <code>&amp;</code>.</p>
</div>
<div class="paragraph">
<p>For the compiler to find the macro, you must either use a fully qualified name, as in <code>&amp;my.module.theMacro(arguments)</code>, or import the module, as it is the case for regular functions.</p>
</div>
<div class="paragraph">
<p>An additional way is to use the <a href="./golodoc/gololang/macros.html#use_3v"><code>&amp;use</code></a> <a href="#special_macros">special macro</a>.
This macro adds the given module into the macro lookup process, just like <code>import</code>.
However, unlike <code>import</code>, the module will not be used to resolve regular function calls at runtime.
Moreover, if the used module has a macro named <code>init</code>, the call to <code>&amp;use</code> is expanded to the result of calling the <code>init</code> macro with the remaining arguments.
For instance: <code>&amp;use("module.with.macro", "foo", 42)</code> with be expanded into the macro call <code>&amp;module.with.macro.init("foo", 42)</code> which will be expanded itself.
This allows to "automatically" inject some code into the <em>using</em> module.</p>
</div>
<div class="paragraph">
<p>Whether you must use one or the other depends on how the module is used.
If your code only depends on macros from the module, <code>&amp;use</code> will be cleaner.
If your code has runtime dependencies on regular functions from the given module, then it must obviously be imported.
See also <a href="#creating_function_calls">Creating function calls</a> for concerns about the resolution of functions in macro modules.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using macros creates a <strong>compile-time</strong> dependency.
Therefore, the module containing the used macros <em>must</em> be compiled <em>before</em> the module using it.
The order of files in the command line (
<a href="./man/man1/golo-compile.html"><code>golo compile</code></a> or
<a href="{man]/golo-golo.html"><code>golo golo</code></a>) is therefore relevant: modules containing macros <em>must</em> appear before other modules.</p>
</div>
<div class="paragraph">
<p>For instance, given a module defining macros in <code>my-macros.golo</code>, and a module using them in <code>app.golo</code>, the following commands will both fail with a compilation error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo compile app.golo my-macros.golo
$ golo golo --files app.golo my-macros.golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, the macro call in <code>app.golo</code> can&#8217;t be resolved, since the macro itself is not yet compiled.
Switching files on the command line works in both cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo compile my-macros.golo app.golo
$ golo golo --files my-macros.golo app.golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>compile or execute the code correctly.
Obviously, the macros can also be compiled in a separate step, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo compile my-macros.golo
$ golo golo --files app.golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a consequence, a macro can&#8217;t be used in the module that defines it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="substituting_macros">19.3.2. Substituting macros</h4>
<div class="paragraph">
<p>The simplest and more natural macros are <em>substituting macros</em>.
Such macros are pure functions returning a new IR node, that will replace the macro call in the tree.</p>
</div>
<div class="paragraph">
<p>For instance, given a macro that returns a constant value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro answer = -&gt; constant(42)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any calls to that macro will be replaced by the constant value. Code such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println(answer())</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println(42)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the macro can generate any code, such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro sayHellos = |lst, names...| -&gt; block(array[
  invoke("add"): withArgs(plus(constant("Hello "), name)): on(lst)
  foreach name in names
])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This macros take a reference to a variable (<code>lst</code>) and a list of nodes representing expressions.
It then create a block, that is a sequence of statements, and adds invocation of the <code>add</code> method on the <code>lst</code> reference.
The newly created node is returned.
The document tree and the argument nodes are left unchanged; this is a pure function.</p>
</div>
<div class="paragraph">
<p>The following invocation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[]
sayHellos(l, "foo", answer(), plop(42))</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be expanded into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[]
l: add("Hello " + "foo")
l: add("Hello " + 42)
l: add("Hello " + plop(42))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The IR node representing the call to the <code>sayHellos</code> macro is replaced by the node returned by the macro, that is a block containing a sequence of <code>:add</code> invocations.
The expansion of the macro, i.e. the substitution of the macro call by the created block, is done by the compiler in the expansion process, not by the macro itself.</p>
</div>
<div class="paragraph">
<p>As you can see, all macros are expanded, thus the second value added is the <code>42</code> constant, but function calls <em>are not</em> evaluated, since the value will be computed at runtime.
Here, the <code>answer</code> macro call is expanded <em>before</em> the <code>sayHellos</code> one (arguments are visited before calls).
After being inserted in the IR tree to replace the macro call, the result of the macro is visited again to expand the macro calls that it might contain.</p>
</div>
<div id="macro-recursion-limit" class="paragraph">
<p>To avoid infinite expansion if a macro returns a (maybe indirect) call to itself, or even deeply nested macro calls (which are indeed code smells), a nesting limit is defined.
The compilation process stops with an error if the limit is exceeded.
The default limit is 42, but can be changed globally using the <code>golo.macros.recursion-limit</code> system property, or locally to a module using the <a href="./golodoc/gololang/macros.html#recursionLimit_2"><code>gololang.macros.recursionLimit</code></a> special macro.</p>
</div>
<div class="paragraph">
<p>Finally, macros that return <code>null</code> are replaced by a “no-op” node, ignored by the latter compilation stages. Note that this kind of node can only be used where <em>statements</em> are expected.
This feature can be used to switch on or off some code at compile time, as presented in the <a href="#conditional_inclusion">examples section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="macro_side_effect">19.3.3. Macros with side-effects</h4>
<div class="paragraph">
<p>It is possible for the macro to act with side-effects.
As usual, it is recommended to avoid side-effects as much as possible, since this tends to create code that is harder to maintain, and usually coupled to the code structure, which reduce macro reuse.</p>
</div>
<div class="paragraph">
<p>However, here is a contrived example of such side-effect macro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro sideeffect = |c| {
  require(c oftype ConstantStatement.class,
    "The `sideeffect` macro must be called with a constant statement")
  let operation = c?: parent()?: parent()
  require(operation oftype BinaryOperation.class,
    "The `sideeffect` macro must be called inside a binary operation")
  operation: left()?: replaceInParentBy(constant(40))
  c: value(c: value() + 1)
  return c
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This macro must be applied on the right-hand side of a binary operation expression, which must be an integer constant.
It increments this constant, and replaces the left-hand side of the expression by the constant value <code>40</code>.
Thus, code such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">  let v = foo() + &amp;sideeffect(1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be expanded to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let v = 40 + 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the macro itself is tied to the structure (must be called on the right expression of a binary operation).
Navigation methods of the IR API (<code>ancestor</code>, <code>next</code>, etc.) can help to retrieve a node regardless the tree structure.
However, as a general rule, it is wiser for a macro to only affect its arguments, and return a new node to be replaced by.</p>
</div>
<div class="paragraph">
<p>As a side note, the previous example will works whatever the left expression.
For instance, since function calls are resolved runtime and macros expanded compile time, the fact that the <code>foo</code> function does not even exists is not a problem, since the expression is replaced by the macro.</p>
</div>
<div class="paragraph">
<p>Most of the time, even macros with side effects should return a node, even if it&#8217;s its unchanged argument (see for instance <a href="#top_level_macros">macros on top-level elements</a>)</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If, using a side effect such as presented here, you add a macro call into a node that had already been expanded, or is currently expanding, the node will not be visited again and thus the macro will no be expanded.</p>
</div>
<div class="paragraph">
<p>For instance, consider a macro such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro someMacro = |v| {
  #...
}

macro bad = |val| {
  val: ancestor(`oftype(Block.class))
     ?: previous(`oftype(Block.class))
     ?: add(macroCall("someMacro"): withArgs(val))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The aim is to add a macro call to <code>someMacro</code> in the block just before the current one.
However, the injected macro call will not be expanded, since the expansion process does not revisit nodes.
Calling this macro will thus lead to a compiling error.
The same purpose can be achieved by creating a regular function (say <code>someMacroInternals</code>) doing the <code>someMacro</code> work, and call it instead of injecting a call to the macro (assuming that this function does not generate a macro call itself), as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro someMacro = |v| -&gt; someMacroInternals(v)

local function someMacroInternals = |v| {
  #...
}

macro better = |val| {
  val: ancestor(`oftype(Block.class))
      ?: previous(`oftype(Block.class))
      ?: add(someMacroInternals(val))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is however possible to inject macro calls in not-yet-visited nodes, or in the node returned by the macro.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous example, we accessed to the ancestor of the macro call node as an ancestor of its argument.
When no arguments are present, we can create a macro that has access to the current tree in the form of a more robust <em>contextual macro</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="contextual_macros">19.3.4. Contextual macros</h4>
<div class="paragraph">
<p>Contextual macros are called with the macro call itself as implicit first argument.
They are defined just like regular macros, but must be decorated with the <code>@contextual</code> macro.
To create a contextual macro in Java, use the <a href="./javadoc/org/eclipse/golo/compiler/macro/ContextualMacro.html"><code>org.eclipse.golo.compiler.macro.ContextualMacro</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>Suppose you want to add several element to a module. You can use a contextual macro, invoked as top-level.
For instance, a macro defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@contextual
macro imports = |self, package, classes...| {
  let prefix = package: value() + "."
  let mod = self: enclosingModule()
  foreach cls in classes {
    mod?: addImport(moduleImport(prefix + cls: value()))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and called like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">&amp;imports("my.super.package", "Foo", "Bar", "Baz")</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import my.supper.package.Foo
import my.supper.package.Bar
import my.supper.package.Baz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Contextual macros are a way to access the IR node of the macro call itself.
This can be used to check the context of the macro (where it is called), mutate other nodes of the tree, and so on.
As stated <a href="#macro_side_effect">previously</a>, it is however advised to avoid direct IR tree mutation, and use <a href="#substituting_macros">substitution</a> instead.</p>
</div>
<div class="paragraph">
<p>A similar example that does not use side effects is given in the <a href="#injecting_imports">injecting imports</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_calling_macros_with_a_block">19.3.5. Calling macros with a block</h4>
<div class="paragraph">
<p>An other special call syntax, for which the <code>&amp;</code> prefix is mandatory, is when a macro last parameter is a block.
In that case, the block can be provided inside curly braces but <strong>outside</strong> the calling parenthesis.
The last macro argument will therefore be a <code>gololang.ir.Block</code>.</p>
</div>
<div class="paragraph">
<p>For instance, given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module calling.macro.with.block

&amp;use("gololang.ir.Quote")

macro mymacro = |value, block| -&gt; &amp;quote {
  if args: get(0) == $(value) {
    $(block)
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module using.macro.with.block

&amp;use("calling.macro.with.block")

function main = |args| {

  &amp;mymacro(42) {
    println("hello")
    doSomething()
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>value</code> argument is a <code>gololang.ir.ConstantStatement</code> representing <code>42</code> and the <code>block</code> argument is a <code>gololang.ir.Block</code> containing two nodes for the <code>println("hello")</code> statement and the <code>doSomething()</code> call.
This call will be expanded as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function main = |args| {
  if args: get(0) == 42 {
    println("hello")
    doSomething()
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#sample_do_while"><code>do &#8230;&#8203; while</code></a> example below for an example of a macro using a block.</p>
</div>
</div>
<div class="sect3">
<h4 id="top_level_macros">19.3.6. Macros on top-level and decorator-like syntax</h4>
<div class="paragraph">
<p>A similar syntax can be used to apply a macro on a top-level element, where the classical argument syntax is not valid.</p>
</div>
<div class="paragraph">
<p>For instance, a macro taking an integer and a function declaration as arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro example = |intConstant, funDeclaration| {
  if intConstant: value() &gt; 40 {
    funDeclaration: getBlock(): prependStatement(call("println"): withArgs(intConstant))
  }
  return funDeclaration
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be called as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">&amp;example(42) {
function add = |a, b| -&gt; a + b
}

&amp;example(1) {
function double = |a| -&gt; 2 * a
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the macro arguments will be a <code>gololang.ir.ConstantStatement</code> with <code>42</code> and <code>1</code> as values respectively, and a <code>gololang.ir.GoloFunction</code> representing <code>add</code> and <code>double</code> functions respectively.
The previous code will be expanded as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function add = |a, b| {
  println(42)
  return a + b
}

function double = |a| -&gt; 2 * a</code></pre>
</div>
</div>
<div class="paragraph">
<p>A macro can also be applied to several top-level elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro mymacro = |toplevel...| {
  foreach elt in toplevel {
    sideEffect(elt)
  }
}

&amp;mymacro {
function mult = |a, b| -&gt; a * b

struct Point = {x, y}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the block contains only a single declaration, the decorator syntax can be used.
Thus the previous example could have been written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@example(42)
function add = |a, b| -&gt; a + b

@mymacro
function mult = |a, b| -&gt; a * b

@mymacro
struct Point = {x, y}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Keep in mind that macros, even when using the decorator-like syntax, are expanded compile-time, even if the function is not used, while regular decorators are computed at runtime, for each call (unless banged). When mixing regular runtime decorators and top-level macros on functions, the macros are thus always applied <em>first</em>. See for instance the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module AMacros

import gololang.ir

macro deco = |f| {
  f: getBlock(): prependStatement(
    call("println"): withArgs("deco"))
  return f
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module ATest

&amp;use("AMacros")

function regular = |f| -&gt; {
  println("regular")
  return f()
}

@deco
function say1 = {
  println(1)
}

@regular
function say2 = {
  println(2)
}

@deco
@regular
function say3 = {
  println(3)
}

@regular
@deco
function say4 = {
  println(4)
}

function main = |args| {
  say1()
  println("--")
  say2()
  println("--")
  say3()
  println("--")
  say4()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this program will give:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ golo golo --files a-macros.golo a.golo
deco
1
--
regular
2
--
regular
deco
3
--
regular
deco
4</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The decorator syntax allows to apply a macro on the module itself. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@moduleMacro
module Foo

#...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A macro applied to a module using the decorator syntax will always be the last macro applied, after the module had been visited and all other macros expanded.
Moreover, since there is no parent in which to replace the macro call by its result, such a macro <em>must</em> work by side effect, and can&#8217;t be a substituting macro.</p>
</div>
<div class="paragraph">
<p>Macros applied on top-level elements may often return a <a href="./javadoc/gololang/ir/ToplevelElements.html"><code>ToplevelElements</code></a> to inject several top-level elements into the module, without using side effects.
When stacking such macros, for instance with the decorator notation, each macro must be prepared to receive a <code>ToplevelElements</code> containing various kinds of elements, instead of the decorated one, and deal with it accordingly.
A good practice is to check the received parameter for its type and ignore unexpected elements.
If the received node is a <code>ToplevelElements</code>, the macro should be applied to all its elements and return another <code>ToplevelElements</code> (i.e. <em>map</em> itself).
The decorator <a href="./golodoc/gololang/macros/Utils.html#toplevel_1"><code>gololang.macros.Utils::toplevel</code></a> helps to create such macros.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_some_macro_pitfalls">19.4. Some macro pitfalls</h3>
<div class="sect3">
<h4 id="_hygiene">19.4.1. Hygiene</h4>
<div class="paragraph">
<p>When a macro defines local variables, naming them can be critical, since it can introduce clashes with variables existing in the scope of the macro call site, and these variables can leak outside the scope of the macro <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>For instance, suppose that one creates a macro to swap the values of two variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro swap = |a, b| -&gt; block(
  define("tmp"): as(a),
  assign(b): to(a),
  assign(refLookup("tmp")): to(b))</code></pre>
</div>
</div>
<div class="paragraph">
<p>which can be used as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var first = 42
var second = 69
swap(first, second)</code></pre>
</div>
</div>
<div class="paragraph">
<p>and will expand to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var first = 42
var second = 69
let tmp = first
first = second
second = tmp</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far, so good.
But if the macro is called is a scope where the <code>tmp</code> variable is already defined, or if it&#8217;s called twice in the same scope, we will have a name clash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tmp = "foo"
var first = 42
var second = 69
swap(first, second)</code></pre>
</div>
</div>
<div class="paragraph">
<p>expands to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tmp = "foo"
var first = 42
var second = 69
let tmp = first
first = second
second = tmp</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a well known issue of macro systems without hygiene, such as the C preprocessor.
The approach used here is to generate a unique name at expansion time.
In order to generate unique names, the builder function <a href="./golodoc/gololang/ir.html#localRef_0"><code>gololang.ir.localRef</code></a>, when called with no argument, will create a reference with a mangled unique name.
If full control on the name generation is needed, a <a href="./javadoc/org/eclipse/golo/compiler/SymbolGenerator.html"><code>SymbolGenerator</code></a> can be used.
The <a href="./golodoc/gololang/macros/Utils.html#gensym_0"><code>gensym</code></a> and <a href="./golodoc/gololang/macros/Utils.html#mangle_1"><code>mangle</code></a> functions in the <a href="./golodoc/gololang/macros/Utils.html"><code>gololang.macros.Utils</code></a> module can also be useful.</p>
</div>
<div class="paragraph">
<p>Applied to the <code>swap</code> example, this gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro swap = |a, b| -&gt; block(
  `var(tmp, b),
  assign(b, a),
  assign(a, tmp)) with {
    tmp = localRef()
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tmp = "foo"
var first = 42
var second = 69
swap(first, second)
first = first + 1
swap(first, second)</code></pre>
</div>
</div>
<div class="paragraph">
<p>will expand to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let tmp = "foo"
var first = 42
var second = 69
let __$$_ref_1 = first
first = second
second = __$$_ref_1
first = first + 1
let __$$_ref_2 = first
first = second
second = __$$_ref_2</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be more precise, the actual IR generated by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var first = 42
var second = 69
swap(first, second)</code></pre>
</div>
</div>
<div class="paragraph">
<p>is</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Assignment: LocalReference{kind=VARIABLE, name='first', index=1} (declaring)
#   Constant = 42
# Assignment: LocalReference{kind=VARIABLE, name='second', index=2} (declaring)
#   Constant = 69
# Block
#   Assignment: LocalReference{kind=CONSTANT, name='__$$_ref_1', index=3} (declaring)
#     Reference lookup: first
#   Assignment: LocalReference{kind=CONSTANT, name='first', index=1}
#     Reference lookup: second
#   Assignment: LocalReference{kind=CONSTANT, name='second', index=2}
#     Reference lookup: __$$_ref_1</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, since the macro generated a <code>Block</code>, the temporary variable scope is limited, and the variable can&#8217;t leak outside the macro.
Have we tried to <code>println(__$$_ref_1)</code> after the swap, we would have get an undeclared reference error.</p>
</div>
<div class="paragraph">
<p>Using generated symbol names and restricting scopes allows to create robust macros.
It is however the responsibility of the developer to use these features.
For instance, the first naive implementation of swap would work as expected, until used in a scope where the <code>tmp</code> variable exists.</p>
</div>
</div>
<div class="sect3">
<h4 id="injecting_functions">19.4.2. Injecting functions</h4>
<div class="paragraph">
<p>The use of unique names prevents clashes when creating local variables.
However, a generated name is not always desirable.
One main case is a macro injecting a function into the calling module.
Indeed, if one wants to use the said function, the name must be known.
However, using a hard coded name can lead to the same kind of name clashes.</p>
</div>
<div class="paragraph">
<p>For instance, consider a macro injecting a <code>foo</code> function in its module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro createFoo = -&gt; `function("foo"): withParameters("a"): returns(plus(refLookup("a"), constant(42)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>used as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Test

&amp;createFoo()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and expanding into</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Test

function foo = |a| -&gt; a + 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the calling module already contains a <code>foo</code> function with the same arity, the one created by the macro will not be added, since a module can&#8217;t contain two function with the same signature.</p>
</div>
<div class="paragraph">
<p>It is thus advised to not hard-code the name of generated functions into the macro, but to derive it from its arguments. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro createFoo = |funName| -&gt; `function("foo" + funName: name()): withParameters("a")
  : returns(plus(refLookup("a"), constant(42)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Called as <code>&amp;createFoo(bar)</code>, this will generate a <code>foobar</code> function.</p>
</div>
<div class="paragraph">
<p>Note that injecting types (<code>struct</code>, <code>union</code>) and module states have the same issue.</p>
</div>
</div>
<div class="sect3">
<h4 id="injecting_imports">19.4.3. Injecting imports</h4>
<div class="paragraph">
<p>Using macros, one can inject <code>import</code> statements in a module.
For instance, one can create a macro to import a bunch of classical modules as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let USUAL_IMPORTS = array[
  "java.util",
  "java.nio.file",
  "java.io",
  "java.util.function",
  "java.util.stream"
]

macro importUsualModules = -&gt; toplevels(array[
  moduleImport(name) foreach name in USUAL_IMPORTS
])</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this behavior must be well documented since it can lead to unexpected results.
Indeed, if the calling module defines some functions with the same name and arity as imported ones, or import other modules defining such functions, name clashes or shadowing can appear.
The code generated by the macro, if it rely on the imported modules, or the code in the module itself can thus call the wrong function.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating_function_calls">19.4.4. Creating function calls</h4>
<div class="paragraph">
<p>When a macro generate a function call, some care must be taken concerning its resolution.
Indeed, the called function must be available in the <em>module applying the macro</em>.
For instance, suppose you have a module <code>some.Module</code> containing a function <code>foo</code>, and a macro creating a call to this function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module some.Module

function foo = |x| -&gt; x

macro myMacro = -&gt; call("foo"): withArgs(42)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this macro as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Test

&amp;use("some.Module")

function main = |args| {
  println(myMacro())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be expanded as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Test

function main = |args| {
  println(foo(42))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will fail since <code>some.Module</code> is not imported in the <code>Test</code> module, and thus the function <code>foo</code> can&#8217;t be found.</p>
</div>
<div class="paragraph">
<p>Depending on the desired behavior, several solution can be considered:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use a fully qualified name, i.e. <code>call("some.Module.foo"): withArgs(42)</code>;</p>
</li>
<li>
<p>let the user import the required module, which provides a kind of polymorphism, since the <code>foo</code> function called will be defined by the imported module and not the macro itself;</p>
</li>
<li>
<p>inject the import in the calling module. Note that it can require the macro to be a contextual one. For instance:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>@contextual
macro myMacro = |self| {
  self: enclosingModule()?: addImport("some.Module"))
  return call("foo"): withArgs(42)
}</pre>
</div>
</div>
<div class="paragraph">
<p>The macro will thus be expanded as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module Test

import some.Module

function main = |args| {
  println(foo(42))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this can fail to produce the desired behavior (see <a href="#injecting_imports">the previous section</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_and_debugging_macros">19.5. Testing and debugging macros</h3>
<div class="paragraph">
<p>Since macros are expanded at compile time, they can be difficult to test and debug.
Here are some advices.</p>
</div>
<div class="paragraph">
<p>As already said, the <a href="./man/man1/golo-diagnose.html"><code>diagnose</code></a> command displays the internal representation of the parsed code.
Its <code>--stage</code> option can configure which <a href="#compilation-steps">compilation step</a> is dumped:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>raw</code>: the IR representation in stage 2, which reflect the code as written in the source;</p>
</li>
<li>
<p><code>expanded</code>: the IR after macro expansion, when all macro calls are replaced by their result;</p>
</li>
<li>
<p><code>refined</code>: the final IR, right before the bytecode generation (step 3).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are useful to inspect the result of expanding macros, for debugging purpose for instance.
The <code>golo.macros.recursion-limit</code> system property can be used to tweek the nested macros expansion, to dump intermediary expansion steps.</p>
</div>
<div class="paragraph">
<p>As an alternative, it is possible to dump the same representation of any IR node using its <a href="./golodoc/gololang/ir.html#augment.gololang.ir.GoloElement.dump_1"><code>dump</code></a> method.
This can be used to inspect the arguments of a macro, or the produced node, when debugging a macro.
It is moreover possible to manually expand the macros in a node by using the <a href="./javadoc/org/eclipse/golo/compiler/GoloCompiler.html#expand-gololang.ir.GoloModule-"><code>expand</code></a> and <a href="./javadoc/org/eclipse/golo/compiler/GoloCompiler.html#expandOnce-gololang.ir.GoloModule-"><code>expandOnce</code></a> methods of the compiler (which can be accessed using <code>gololang.Runtime.classLoader(): compiler()</code>).</p>
</div>
<div class="paragraph">
<p>To debug macros, the expansion process can be tuned using some predefined special macros that configure the <a href="#macro-recursion-limit">recursion limit</a>, <a href="#macro-dont-expand-regular">regular call expansion</a>, and so on (see the <a href="./golodoc/gololang/macros.html"><code>gololang.macros</code></a> module).</p>
</div>
<div class="paragraph">
<p>The <code>golo.debug.macros</code> system property can be set to <code>true</code> to allow the expansion process to be <em>really</em> verbose about its work.</p>
</div>
<div class="paragraph">
<p>To ease the tests and debugging of macro functions, as well as improve code reuse, it is strongly recommended to define regular functions that create IR nodes, and call these functions from macros.
Indeed, it is easier to call such a function in a test suite to inspect its result.
In anyway, a macro can be called as a regular function (i.e. at runtime) either by using the <code>dontExpandRegularCalls</code> special macro and calling the macro without the <code>&amp;</code> prefix (e.g. in a test module) or by using a function reference (e.g. <code>^module::macro()</code>).
Calling a special or contextual macro as a regular function is however tricky since the implicit arguments (the macro call and the expansion engine resp.) are not injected and must therefore be supplied explicitly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_of_macros">19.6. Examples of macros</h3>
<div class="paragraph">
<p>Here are some example of macros, to whet your appetite.</p>
</div>
<div class="sect3">
<h4 id="conditional_inclusion">19.6.1. Conditional inclusion</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro debug = |message| {
  if Runtime.debugMode() {
    return invoke("println"): withArgs(message): on(call("System.err"))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This macro will expand to <code>System.err(): println(message)</code> if in <a href="./javadoc/gololang/Runtime.html#debugMode--">debug mode</a>, and to a no-op otherwise.
Thus, running the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function main = |args| {
  debug("debug test")
  println("ok")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo golo --files macro.golo test.golo
ok
$ GOLO_DEBUG=true golo golo --files macro.golo test.golo
debug test
ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, one can write a regular function with the same behavior, but since it&#8217;s a macro, the test to the environment variable and the print statement are not event present in the bytecode of the first run.
Compare</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo compile macro.golo test.golo
$ javap -v Test.class
...
public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=1, args_size=1
         0: ldc           #25                 // String ok
         2: invokedynamic #37,  0             // InvokeDynamic #0:println:(Ljava/lang/Object;)Ljava/lang/Object;
         7: pop
         8: aconst_null
         9: return
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ GOLO_DEBUG=true golo compile macro.golo test.golo
$ javap -v Test.class
...
  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=1, args_size=1
         0: invokedynamic #35,  0             // InvokeDynamic #0:"System#err":()Ljava/lang/Object;
         5: ldc           #37                 // String debug test
         7: invokedynamic #45,  0             // InvokeDynamic #1:println:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
        12: pop
        13: ldc           #47                 // String ok
        15: invokedynamic #50,  0             // InvokeDynamic #0:println:(Ljava/lang/Object;)Ljava/lang/Object;
        20: pop
        21: aconst_null
        22: return
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, the message can be generated by a function call, that will only happen in debug mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">debug(foo())</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we used a regular function, the <code>foo()</code> call would have happen even if not in debug mode, since parameters evaluation is strict, and thus we would have to use lazy evaluation trick like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function debug = |msgClosure| {
  if Runtime.debugMode() {
    System.err(): println(msgClosure())
  }
}

debug(-&gt; foo())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if the module is compiled in debug mode and run in normal mode, the debug message is still printed, since the macro is expanded at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ GOLO_DEBUG=true golo compile macro.golo test.golo
$ golo run --module Test
debug test
ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative <code>debug</code> implementation could return the test to debug mode itself, avoiding boilerplate code but not the runtime cost.</p>
</div>
<div class="paragraph">
<p>A similar approach can be used to create a <code>assert</code> macro that is removed from production code. The asserted expression can even be used to generate an error message. Given the following macro</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro assert = |expr| {
  if Boolean.getBoolean("gololang.with-assert") {
    require(expr oftype BinaryOperation.class,
            "assert argument must be a binary expression")

    let message = invoke("format")
      : withArgs(expr: left(), expr: right())
      : on(constant(
            "Should have %%s %s %%s at %s %s": format(
              expr: type(),
              expr: enclosingModule()?: sourceFile(),
              expr: positionInSourceCode())))
    return call("require"): withArgs(expr, message)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>used as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function main = |args| {
  let a = 41
  assert(a &gt; 42)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When used in normal mode, nothing happens, since the macro returns <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ golo golo --files assert.golo test-assert.golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>but setting the property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ GOLO_OPTS='-Dgololang.with-assert=true' golo golo --files assert.golo test-assert.golo
Exception in thread "main" java.lang.AssertionError: Should have 41 &gt; 42 at test-assert.golo {line=7, column=12}</code></pre>
</div>
</div>
<div class="paragraph">
<p>since the code is expanded into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function main = |args| {
  let a = 41
  require(a &gt; 42,
      "Should have %s &gt; %s at test-assert.golo {line=7, column=12}"
      : format(a, 42))
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sample_do_while">19.6.2. <code>do &#8230;&#8203; while</code></h4>
<div class="paragraph">
<p>Golo does not provide a <code>do &#8230;&#8203; while</code> construct. Here is a sample macro implementing this feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">macro doWhile = |condition, body| -&gt; block(
  body,
  `while(condition): block(body)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This macro can be called like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">  let l = list[]
  var i = 0
  &amp;doWhile(i &gt; 0) {
    l: add(i)
    i = i - 1
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is expanded into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = list[]
var i = 0
l: add(i)
i = i - 1
while i &gt; 0 {
  l: add(i)
  i = i - 1
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documenting_golo_code">20. Documenting Golo code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Of course you can document your code using comments (<code>#</code>), but who reads source code?</p>
</div>
<div class="sect2">
<h3 id="_documentation_blocks">20.1. Documentation blocks</h3>
<div class="paragraph">
<p>Golo provides a support for documentation blocks on modules, functions, augmentations, structs and unions, as well as fields.
Blocks are delimited by <code>----</code> and contain free-form Markdown
<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>
text.</p>
</div>
<div class="paragraph">
<p>Here is a quick example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">----
This is a *nice* module that does a bunch of useless things.

See more at [our website](http://www.typeunsafe.org).
----
module Hello

----
Adds 2 elements, which is quite surprising given the name.

* `x` is the first argument,
* `y` is the second argument.

The following snipped prints `3`:

    let result = adder(1, 2)
    println(result)

Impressive!
----
function adder = |x, y| -&gt; x + y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sections can be added in the documentation using the normal markdown syntax. The level of the titles is adapted to the generated documentation.
For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">----
Encode a *linked list* as cons cells.

# Examples

A list is constructed from cons

    let myList = Cons(1, Cons(2, Cons(3, Empty())))

----
union List = {
  ----
  The empty list
  ----
  Empty

  ----
  A *cell* in the list
  ----
  Cons = {
    ----
    The *head* of the list
    ----
    head,

    ----
    The *tail* of the list
    ----
    tail
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first sentence of a module documentation is displayed in module indexes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_package_documentation">20.2. Package documentation</h3>
<div class="paragraph">
<p>Packages does not exists per se in Golo, but are represented in the form of module qualified names. However, it is common practice to group the modules of the same namespace into a common directory. There exists several ways to document such packages. The first is to create an empty golo module named after the package, containing the documentation. This file can have any name and be in any directory. For instance, given several modules <code>pkg.MyModule</code> and <code>pkg.OtherModule</code>, one can document the <code>pkg</code> package by creating a module containing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">----
Here goes the package documentation
----
module pkg</code></pre>
</div>
</div>
<div class="paragraph">
<p>No class will be compiled from this module, only a documentation page.</p>
</div>
<div class="paragraph">
<p>The other way to document the <code>pkg</code> package, assuming that both modules are in <code>src/pkg/MyModule.golo</code> and <code>src/pkg/OtherModule.golo</code> respectively, is to create pure markdown file, containing the documentation for the package. This file <strong>must</strong> be named either <code>src/pkg/README.md</code>, <code>src/pkg/package.md</code> or <code>src/pkg.md</code>. If a golo file corresponding to the package exists, these files are ignored.</p>
</div>
<div id="warning-multiple-package-desc" class="paragraph">
<p>If several candidates are found, only the <strong>first one</strong> is used, and a warning is printed. It can be disabled by setting the <code>golo.warnings.doc.multiple-package-desc</code> system property to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rendering_documentation">20.3. Rendering documentation</h3>
<div class="paragraph">
<p>The <a href="./man/man1/golo-doc.html"><code>golo doc</code></a> command can render documentation in <code>html</code> (the default) or <code>markdown</code> format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">$ golo doc --output target/documentation src/**/*.golo</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, <a href="./man/man1/golo-doc.html"><code>golo doc</code></a> can also produce ctags <code>tags</code> file, to be used by
editors such as Vim or emacs. In this mode, the special output target <code>-</code> can
be used to print the tags on standard output, which is needed by some editors
or extensions.</p>
</div>
<div class="paragraph">
<p>Please consult <code>golo --usage doc</code> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alignment">20.4. Alignment</h3>
<div class="paragraph">
<p>It is sometimes necessary to indent documentation blocks to match the surrounding code format.
Documentation blocks erase indentation based on the indentation level of the opening block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">----
The most useful augmentation *ever*.
----
augment java.lang.String {

  ----
  Creates a URL from a string, as in: `let url = "http://foo.bar/plop": toURL()`.
  ----
  function toURL = |this| -&gt; java.net.URL(this)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When generating documentation from the code above, the documentation block of the <code>toURL</code> function
is unindented of 2 spaces.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc_modules">21. Misc. modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Not everything fits into the main documentation. We encourage you to also look at the
<a href="./javadoc/"><em>javadocs</em></a> and <a href="./golodoc/"><em>golodocs</em></a>.</p>
</div>
<div class="paragraph">
<p>The next subsections provide summaries of misc. modules found as part of Golo.</p>
</div>
<div class="sect2">
<h3 id="_standard_augmentations_gololang_standardaugmentations">21.1. Standard augmentations (<code>gololang.StandardAugmentations</code>)</h3>
<div class="paragraph">
<p>This <a href="./golodoc/gololang/StandardAugmentations">Golo module</a> provides standard augmentations for various classes of the Java standard classes
and Golo types. It does not have to be imported explicitely.</p>
</div>
<div class="paragraph">
<p>Here are a few examples.</p>
</div>
<div class="paragraph">
<p>Java collections can be have functional methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">println(list[1, 2, 3, 4]: filter(|n| -&gt; (n % 2) == 0))
println(list[1, 2, 3]: map(|n| -&gt; n * 10))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Insert a map entry only if the key is not present, and get a default value if an entry is missing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">map: putIfAbsent(key, -&gt; expensiveOperation())
map: getOrElse(key, "n/a")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat an operation many times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">3: times(-&gt; println("Hey!")
3: times(|i| -&gt; println(i))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json_support_gololang_json">21.2. JSON support (<code>gololang.JSON</code>)</h3>
<div class="paragraph">
<p>Golo includes the <a href="https://code.google.com/p/json-simple/">JSON Simple</a> library to provide JSON
support.</p>
</div>
<div class="paragraph">
<p>While <code>json-simple</code> only supports encoding from lists and maps, this <a href="./golodoc/gololang.JSON">API</a> brings support for sets,
arrays, Golo tuples, dynamic objects and structs.</p>
</div>
<div class="paragraph">
<p>Given a simple data structure, we can obtain a JSON representation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let data = map[
  ["name", "Somebody"],
  ["age", 69],
  ["friends", list[
    "Mr Bean", "John B", "Larry"
  ]]
]
let asText = JSON.stringify(data)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given some JSON as text, we can get back a data structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let data = JSON.parse(text)
println(data: get("name"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>gololang.JSON</code> module also provides helpers for JSON serialization and deserialization
with both dynamic objects and structs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scala_like_dynamic_variable_gololang_dynamicvariable">21.3. Scala-like dynamic variable (<code>gololang.DynamicVariable</code>)</h3>
<div class="paragraph">
<p>Golo has a <a href="./golodoc/gololang/DynamicVariable"><code>DynamicVariable</code></a> type that mimics the eponymous class from the Scala standard library.</p>
</div>
<div class="paragraph">
<p>A dynamic variable has inheritable thread-local semantics: updates to its value are confined to the
current thread and its future child threads.</p>
</div>
<div class="paragraph">
<p>Given the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let dyn = DynamicVariable("Foo")
println(dyn: value())

let t1 = Thread({
  dyn: withValue(666, {
    println(dyn: value())
  })
})

let t2 = Thread({
  dyn: withValue(69, {
    println(dyn: value())
  })
})

t1: start()
t2: start()
t1: join()
t2: join()
println(dyn: value())</code></pre>
</div>
</div>
<div class="paragraph">
<p>one gets an output similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Foo
69
666
Foo</pre>
</div>
</div>
<div class="paragraph">
<p>with the <code>69</code> and <code>666</code> swapping order over runs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_observable_references_gololang_observable">21.4. Observable references (<code>gololang.Observable</code>)</h3>
<div class="paragraph">
<p>An <a href="./golodoc/gololang/Observable">observable</a> value notifies observers of updates in a thread-safe manner. An observable can also be
constructed from another observable using the <code>map</code> and <code>filter</code> combinators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let foo = Observable("Foo")
foo: onChange(|v| -&gt; println("foo = " + v))

let mapped = foo: map(|v| -&gt; v + "!")
mapped: onChange(|v| -&gt; println("mapped = " + v))

foo: set("69")</code></pre>
</div>
</div>
<div class="paragraph">
<p>This yields the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo = 69
mapped = 69!</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asynchronous_programming_helpers_gololang_async">21.5. Asynchronous programming helpers (<code>gololang.Async</code>)</h3>
<div class="paragraph">
<p>This <a href="./golodoc/gololang.Async">module</a> offers asynchronous programming helpers, especially execution context agnostic promises
and futures. The provided APIs are orthogonal to the execution strategy: it is up to you to execute
code from the same thread, from a separate thread, or by pushing new tasks to a service executor.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">module samples.Concurrency

import java.util.concurrent
import gololang.Async

local function fib = |n| {
  if n &lt;= 1 {
    return n
  } else {
    return fib(n - 1) + fib(n - 2)
  }
}

function main = |args| {
  let executor = Executors.newFixedThreadPool(2)
  let results = [30, 34, 35, 38, 39, 40, 41, 42]:
    map(|n| -&gt; executor: enqueue(-&gt; fib(n)):
      map(|res| -&gt; [n, res]))
  reduce(results, "", |acc, next| -&gt; acc + next: get(0) + " -&gt; " + next: get(1) + "\n"):
    onSet(|s| -&gt; println("Results:\n" + s)):
    onFail(|e| -&gt; e: printStackTrace())
  executor: shutdown()
  executor: awaitTermination(120_L, TimeUnit.SECONDS())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example takes advantages of an executor augmentation and composable promises and futures to
compute Fibonacci numbers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lazy_lists_gololang_lazylists">21.6. Lazy lists (<code>gololang.LazyLists</code>)</h3>
<div class="paragraph">
<p>This <a href="./golodoc/gololang/LazyLists">module</a> defines a lazy list structure, as well as some utilities to work
with it.</p>
</div>
<div class="paragraph">
<p>A lazy list behaves like an <em>immutable</em> linked list whose elements are evaluated
only when needed, as can be found in Haskell for example.</p>
</div>
<div class="paragraph">
<p>The next element in the list (the tail) is represented by a closure. The generated value
is cached so that the closure representing the next element is evaluated only once.</p>
</div>
<div class="paragraph">
<p>This is very useful when using higher order function such as <code>map</code>. Mapping
a long lazy list with a function and using only the 3 first elements will only
apply the function to these elements, as opposed to regular lists.</p>
</div>
<div class="paragraph">
<p>Since the tail closure will be called at most once, and we can&#8217;t
guarantee when, or even if, it will be called, this closure must be
a pure, side-effect free, function.</p>
</div>
<div class="paragraph">
<p>Lazy lists can also be used to create infinite lists, also known as generators
(or anamorphisms).</p>
</div>
<div class="paragraph">
<p>Lastly, they allow for elegant recursive implementations of several classical
algorithms.</p>
</div>
<div class="paragraph">
<p>For instance, one can create a infinite lazy list containing integers as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function count = |start| -&gt; cons(start, -&gt; count(start + 1_L))
function count = -&gt; count(0_L)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To construct a infinite list of all even multiples of 3, one can then use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let l = count(): map(|x| -&gt; 3 * x): filter(|x| -&gt; (x % 2) == 0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>cons</code> function returns a new lazy list whose head is its first argument,
and the tail its second.</p>
</div>
<div class="paragraph">
<p>A lazy list implement the <code>Collection</code> interface, while remaining lazy. It is
thus possible to use it in imperative style with a <code>foreach</code> construct, or
recursively using <code>head</code> and <code>tail</code>.
On the other hand, functions or methods like <code>equals</code>, <code>size</code> or <code>contains</code> are
not very efficients, since they must evaluate the whole list, and thus negate
the laziness. They are here for completeness and compatibility with the regular
lists interface, but you should avoid such methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_console_ansi_codes_gololang_ansicodes">21.7. Console ANSI codes (<code>gololang.AnsiCodes</code>)</h3>
<div class="paragraph">
<p>The <a href="./golodoc/gololang/AnsiCodes"><code>gololang.AnsiCodes</code></a> modules offers a set of functions to work with
<a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI codes</a>.</p>
</div>
<div class="paragraph">
<p>The following would print <code>Hello world!</code> in blinking yellow text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import gololang.AnsiCodes

# (...)

function hello = {
  blink()
  fg_yellow()
  println("Hello world!")
  reset()
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ANSI codes support varies from terminal and operating system capacities. Microsoft Windows
does not support these codes without a 3rd-party driver. You may use the <a href="./golodoc/gololang/AnsiCodes#likelySupported_0"><code>likelySupported()</code></a> function
to test if the host operating system is <em>likely</em> to support ANSI codes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_functional_errors_gololang_errors">21.8. Functional errors (<code>gololang.Errors</code>)</h3>
<div class="paragraph">
<p>The <a href="./golodoc/gololang/gololang/Errors"><code>gololang.Errors</code></a> module offers types, augmentations and decorators to deal with errors in a more functional way. This is similar for instance to Haskell
<a href="https://hackage.haskell.org/package/base/docs/Data-Maybe.html"><code>Maybe</code></a> and
<a href="https://hackage.haskell.org/package/base/docs/Data-Either.html"><code>Either</code></a> or Rust
<a href="https://doc.rust-lang.org/std/option/"><code>Option</code></a> and
<a href="https://doc.rust-lang.org/std/result/"><code>Result</code></a>.</p>
</div>
<div class="sect3">
<h4 id="_option">21.8.1. Option</h4>
<div class="paragraph">
<p>This is just an augmentation of the java <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>java.util.Optional</code></a> class together with factory functions and decorators. The added methods allows to better chain optional results and improve matching.</p>
</div>
<div class="paragraph">
<p>This is particularly useful to chain and compose functions that can return no result. Instead of returning <code>null</code>, a <code>None()</code> value can be returned. Such functions can then be chained using the <code>andThen</code> method. The <code>option</code> decorator can be used to transform a regular function into a function returning an <code>Option</code>.</p>
</div>
<div class="paragraph">
<p>For instance, given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">function foo = |arg| {
  # can return an integer, null or even throw an exception
}

function bar = -&gt; 42

function plus2 = |x| -&gt; x + 2
function mult2 = |x| -&gt; x * 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>code such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">var r
try {
  r = foo(x)
  if r is null {
    r = bar()
  } else {
    r = mult2(plus2(r))
  }
} catch (e) {
 r = bar()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be rewritten:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let optionalFoo = option(foo)

r = optionalFoo(x): andThen(^plus2): either(^mult2, ^bar)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, <code>Optional</code> methods such as <code>flatMap</code> and <code>orElseGet</code> can also be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@option
function safeGetter = |aMap, aKey| -&gt; aMap: get(aKey)

let m = map[["a", 2], ["answer", 12]]

# (19 + 2) * 2 = 42
safeGetter(m, "answer"): map(^plus2): map(^mult2): orElseGet(^bar)

# get null, option returns None, bar gives 42
safeGetter(m, "plop"): map(^plus2): map(^mult2): orElseGet(^bar)

# null pointer exception, option returns None, bar gives 42
safeGetter(null, "answer"): map(^plus2): map(^mult2): orElseGet(^bar)</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="./golodoc/gololang/Errors.html"><code>gololang.Errors</code></a> module documentation for a full description of the added methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_result">21.8.2. Result</h4>
<div class="paragraph">
<p><code>Result</code> is a similar object, but it keep the errors, meaning that a result can be empty (similar to <code>None</code>), containing an error (a <code>Throwable</code>) or a result. It can be used in a way very similar to <code>Optional</code>, but gives more control on the behavior.</p>
</div>
<div class="paragraph">
<p>The <code>result</code> decorator is the equivalent to <code>option</code>. The <code>trying</code> higher order function takes an anonymous block, executes it and returns a corresponding <code>Result</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="./golodoc/gololang/Errors.html"><code>gololang.Errors</code></a> module documentation and the javadoc for the <a href="./javadoc/gololang/error/Result.html"><code>gololang.error.Result</code></a> class for more details.</p>
</div>
<div class="paragraph">
<p>As a bonus, <code>Result</code> objects can be destructured into the error and the value. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">@result
function foo = {
  # can throw an exception, return null or a plain value
}

let e, v = foo()

let err, val = trying({
  # statements sequence than can throw an exception
  ...
  return somevalue
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error is the left value, the correct one the right (mnemonic: “right” also means “correct”). This allows to deal with error in the same way as Go does for instance.</p>
</div>
<div class="paragraph">
<p>The decorators <code>nullify</code> and <code>raising</code> are the duals of <code>option</code> or <code>result</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_pitfalls">22. Common pitfalls</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Discovering a new programming language is fun. Yet, we all make mistakes in the beginning, as we
idiomatically repeat habits from other languages.</p>
</div>
<div class="paragraph">
<p>Because Golo works closely with the Java programming language, it is likely that Java programmers
will make some of the following mistakes early on.</p>
</div>
<div class="sect2">
<h3 id="_new">22.1. <code>new</code></h3>
<div class="paragraph">
<p>Golo does not have a <code>new</code> operator for allocating objects. Instead, one should just call a
constructor as a function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Good
let foo = java.util.LinkedList()

# Compilation fails
let foo = new java.util.LinkedList()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_imports">22.2. Imports</h3>
<div class="paragraph">
<p>Golo does not have <strong>star</strong> imports like in Java. Imports are only used at runtime as Golo tries to
resolve names of types, functions, and so on.</p>
</div>
<div class="paragraph">
<p>You must think of <code>import</code> statements as a notational shortcut, nothing else. Golo tries to resolve
a name as-is, then tries to complete with every import until a match is found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">import java.util
import java.util.concurrent.AtomicInteger

# (...)

# Direct resolution at runtime
let foo = java.util.LinkedList()

# Resolution with the 1st import
let foo = LinkedList()

# Resolution with the 2nd import
let foo = AtomicInteger(666)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_method_invocations">22.3. Method invocations</h3>
<div class="paragraph">
<p>Keep in mind that instance methods are invoked using the <code>:</code> operator, not with dots (<code>.</code>) like in
many languages.</p>
</div>
<div class="paragraph">
<p>This is a common mistake!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs"># Calls toString() on foo
foo: toString()

# Looks for a function toString() in module foo
foo.toString()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_match_is_not_a_closure">22.4. <code>match</code> is not a closure</h3>
<div class="paragraph">
<p>One thing to keep in mind is that <code>match</code> returns a value, and that it is not a closure unless you
want it to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="golo" class="language-golo hljs">let foo = match {
  case plop then 1
  case ploped then 2
  otherwise -1
}

# Ok
println(foo)

# Bad! foo is an integer!
println(foo("abc"))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shebang_scans_sub_folders">22.5. Shebang scans sub-folders</h3>
<div class="paragraph">
<p>When running <em>shebang</em> scripts, the sub-folders are being scanned for <code>.jar</code> and <code>.golo</code> files.
This is useful for automatically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>putting all third-party libraries into the classpath, and</p>
</li>
<li>
<p>dynamically compiling and loading other Golo source files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Be aware that this may lead to surprising errors if you run code from, say, a clone of the Golo source code repository since it contains duplicated type and module definitions, as well as files from the test suite that have errors on purpose.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_index">23. Index</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="http://www.sparkjava.com/">Spark micro-framework</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="http://www.oraclejavamagazine-digital.com/javamagazine_open/20130102#pg50">Oracle Java Magazine 2013-01-02</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="http://www.oraclejavamagazine-digital.com/javamagazine/20130506#pg42">Oracle Java Magazine 2013-05-06</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/invoke/MethodHandles.html#constant(java.lang.Class,%20java.lang.Object)">Constant MethodHandle</a>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. Actually, named arguments can be used in a macro call, but are seen as <code>NamedArgument</code> nodes in the macro body and thus require a special handling… see for instance <a href="./golodoc/gololang/macros/Utils.html#parseArguments_2"><code>gololang.macros.Utils.parseArguments</code></a>
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="https://en.wikipedia.org/wiki/Hygienic_macro#The_hygiene_problem">Wikipedia on the hygiene problem</a>
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. <a href="http://daringfireball.net/projects/markdown/syntax">Markdown text</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.4.0<br>
Last updated 2021-02-04 17:37:12 +0100
</div>
</div>
<link rel="stylesheet" href="./styles/github.min.css">
<script src="./highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>