<!DOCTYPE html>


<html>
<head>
  <title>gololang.meta.Annotations (Golo 3.4.0)</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon"
        href="data:image/x-icon;base64,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"/>
  <style>
    body {
      font-family: Helvetica, Arial, sans-serif;
      color: #333;
      background-color: #fff;
      border-color: #999999;
      border-width: 2px;
      margin: 1em auto;
      margin-left: 20em;
      max-width: 50em;
      text-align: left;
      padding: 0.5em;
    }
    pre {
      background-color: #eee;
      -webkit-border-radius: 5px;
      -moz-border-radius: 5px;
      border-radius: 5px;
      overflow: auto;
    }
    code {
      font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
      background-color: #eee;
      padding: 1px 3px;
      -webkit-border-radius: 2px;
      -moz-border-radius: 2px;
      border-radius: 2px;
    }
    pre code {
      padding-left: 0px;
      padding-right: 0px;
    }

    .listing:hover code[data-lang]:before {
      display: block;
    }

    .listing code {
      position: relative;
    }

    .listing code[data-lang]:before {
      display: none;
      content: attr(data-lang);
      position: absolute;
      font-size: 0.75em;
      top: .5rem;
      right: 0.5rem;
      line-height: 1;
      text-transform: uppercase;
      color: #000;
    }

    li p {
      margin: 0.3em;
    }

    ul > li {
      list-style-type: disc;
    }
    a:link, a:visited {
      color: #33e;
      text-decoration: none;
    }
    a:hover {
      color: #00f;
      text-decoration:underline;
    }
    h1 {
      color: #999;
      font-weight: 400;
      font-size: 250%;
    }
    h2 {
      border-bottom: 1px dotted #aaa;
      margin-bottom: 1em;
      color: #333;
      font-size: 200%;
      font-style: normal;
      font-weight: bold;
    }

    h3 {
      color: #666;
      font-size: 180%;
      font-style: normal;
      font-weight: bold;
    }
    h4 {
      font-size: 130%;
      font-style: normal;
      font-weight: bold;
    }
    h5 {
      font-size: 100%;
      font-style: normal;
      font-weight: bold;
    }
    h6 {
      font-size: 100%;
      font-style: italic;
      font-weight: normal;
    }

    #global-nav {
      display: block;
      font-size: 80%;
    }

    #global-nav > a {
      margin: 0em;
      padding: 0 0.5em;
    }

    #toc {
      margin: 0;
      padding: 0;
      position: fixed;
      top: 0px;
      bottom: 0px;
      left: 0px;
      width: 20em;
      overflow: auto;
      white-space: nowrap;
    }

    #toc h1 {
      margin: .5em;
      padding: 1ex;
      font-size: 90%;
      font-weight: bold;
      font-style: normal;
      color: #333;
      background-color: #eee;
      text-align: center;
    }

    #toc ul {
      padding-left: 1em;
    }

    #toc > ul {
      font-size: 80%;
      margin: 0.5em;
    }

    #toc > ul > li {
      list-style: none;
      margin-bottom: 2ex;
    }

    #toc > ul > li > a {
      font-weight: bold;
      color: #333;
      display: block;
      padding: 1ex;
      margin: 0 1em 1ex 0;
      border-bottom: 1px solid #999;
    }

    #toc li {
      list-style-type: none;
    }

    :target {
      background-color: yellow;
    }

    .permalink {
      margin-left: .3em;
      font-size: 70%;
      visibility: hidden;
    }

    *:hover > .permalink {
      visibility: visible;
    }

    .golodoc {
      margin: 0;
      padding: 0;
      padding-left: 1.5em;
    }

    .srclink {
      float:  right;
      text-align: right;
      color: #999;
      font-size: 75%;
      margin-top: -2em;
    }

    .srclink a {
      color: inherit;
    }

    .modules-list li p {
      display: inline-block;
      margin: 0 0.5em;
    }

    @media (max-width: 50em) {
      #toc {
        margin: auto;
        position: static;
        width: 100%;
        overflow: visible;
        white-space: normal;
      }

      #toc ul {
        padding-left: 1em;
        margin: 0;
      }

      #toc > ul {
        font-size: 100%;
        margin: 0em;
        padding: 0;
      }

      #toc > ul > li {
        list-style: none;
        margin-bottom: 1ex;
      }

      #toc > ul > li > a {
        font-weight: bold;
        color: #333;
        display: block;
        padding: 0ex;
        margin: 0;
        border-bottom: none;
      }

      #toc h1 {
        display: none;
      }

      #global-nav {
        display: block;
        font-size: 100%;
        z-index: 1000;
        background-color: #fff;
        position: fixed;
        top: 0;
        width: 100%;
        height: 1.5rem;
      }

      :target {
        padding-top: 1.5rem;
      }

      body {
        margin: 0;
        padding: 0.5em;
      }

      h1 {
        font-size: 200%;
      }
    }

  </style>
</head>
<body>
<h1>Documentation for gololang.meta.Annotations</h1>


<div class="golodoc">
  <p>Module to deal with java annotations.</p>
<p>To flag a golo element with a Java annotation, one must add some metadata to the IR element.
The metadata will be used by the compiler to add the required bytecode.</p>
<p>To add such metadata, the most direct way is to create a macro that modify the IR node.</p>
<p>This module provides functions to ease the creation of such macros by:</p>
<ul>
<li>adding the annotation metadata (<a href="#annotateElements_3v"><code>annotateElements</code></a>)</li>
<li>parsing the macro arguments and match them with the annotation fields (<a href="#extractAnnotationArguments_2"><code>extractAnnotationArguments</code></a>)</li>
<li>checking that the target has a valid type w.r.t. the annotation definition (<a href="#checkApplicableTo_2"><code>checkApplicableTo</code></a>)</li>
</ul>
<p>Moreover, since the creation of simple macro that only adds the metadata to the element is just boilerplate code,
macros to generate such macros are provided (
<a href="#annotationWrapper_1"><code>annotationWrapper</code></a>,
<a href="#annotationWrapper_2"><code>annotationWrapper</code></a> and
<a href="#annotationWrapper_3"><code>annotationWrapper</code></a>)</p>
<p>Finally, a helper function to mark a element as deprecated is also provided.</p>

</div>


<!-- begin table of content -->
<nav id="toc">
<h1>gololang.meta.Annotations</h1>
  <section id="global-nav">
    <a href="../../index.html" rel="home">Module Index</a>
    <a href="../../index-all.html" rel="index">Global Index</a>
    
    <a href="../meta.html" rel="up">Package Index</a>
    
  </section>
<ul>
  

  

  

  


  
  <li><a href="#macros">Macros</a><ul>
    
    <li><a href="#annotationWrapper_1">annotationWrapper(annotation)</a></li>
    
    <li><a href="#annotationWrapper_2">annotationWrapper(annotation, name)</a></li>
    
    <li><a href="#annotationWrapper_3">annotationWrapper(annotation, name, doc)</a></li>
    
  </ul></li>
  

  
  <li><a href="#functions">Functions</a><ul>
    
    <li><a href="#addAnnotationMetadata_3">addAnnotationMetadata(annotationClass, args, target)</a></li>
    
    <li><a href="#annotateElements_3v">annotateElements(annotationClass, args, elts...)</a></li>
    
    <li><a href="#checkApplicableTo_2">checkApplicableTo(annotationClass, target)</a></li>
    
    <li><a href="#extractAnnotationArguments_2">extractAnnotationArguments(annotation, args)</a></li>
    
    <li><a href="#makeDeprecated_3v">makeDeprecated(since, comment, elts...)</a></li>
    
  </ul></li>
  
</ul>
</nav>
<!-- end table of content -->













  <h2 id="macros">Macros</h2>
  
    <h3 id="annotationWrapper_1">annotationWrapper(annotation)<a class="permalink" href="#annotationWrapper_1" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-122" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Macro to generate a macro to add a Java annotation to a golo element.</p>
<p>The name of the macro is the simple name of the annotation class, its documentation is auto-generated.</p>
<ul>
<li><em>param</em> <code>annotation</code>: the litteral fully qualified class reference to the annotation to use.</li>
<li><em>returns</em> a macro that will add the given annotation to a golo element</li>
</ul>
<p>See <a href="#annotationWrapper_3"><code>annotationWrapper</code></a></p>

    </div>
  
    <h3 id="annotationWrapper_2">annotationWrapper(annotation, name)<a class="permalink" href="#annotationWrapper_2" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-138" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Macro to generate a macro to add a Java annotation to a golo element.</p>
<p>The name of the generated macro is given and its documentation is auto-generated.</p>
<ul>
<li><em>param</em> <code>annotation</code>: the litteral fully qualified class reference to the annotation to use.</li>
<li><em>param</em> <code>name</code>: the name of the generated macro (as a reference lookup, i.e. a name, not a string).</li>
<li><em>returns</em> a macro that will add the given annotation to a golo element</li>
</ul>
<p>See <a href="#annotationWrapper_3"><code>annotationWrapper</code></a></p>

    </div>
  
    <h3 id="annotationWrapper_3">annotationWrapper(annotation, name, doc)<a class="permalink" href="#annotationWrapper_3" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-180" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Macro to generate a macro to add a Java annotation to a golo element.</p>
<p>For instance, to create a macro to apply the <code>mypackage.MyAnnotation</code> Java annotation, one must create a macro such as:</p>
<pre class="listing"><code class="lang-golo" data-lang="golo">---
Apply the `MyAnnotation` annotation
---
macro annotation = |args...| {
  let a, u, e = extractAnnotationArguments(mypackage.MyAnnotation.class, args)
  return annotateElements(mypackage.MyAnnotation.class, a, e)
}
</code></pre>
<p>used as</p>
<pre class="listing"><code class="lang-golo" data-lang="golo">@annotation(prop1="hello", prop2=42)
function foo = -&gt; null
</code></pre>
<p>(given the annotation has the <code>prop1</code> and <code>prop2</code> properties.</p>
<p>This macro generate the corresponding macro, thus allowing to simply write</p>
<pre class="listing"><code class="lang-golo" data-lang="golo">&amp;annotationWrapper(
    mypackage.MyAnnotation.class,
    annotation,
    "Apply the `MyAnnotation` annotation")
</code></pre>
<ul>
<li><em>param</em> <code>annotation</code>: the litteral fully qualified class reference to the annotation to use.</li>
<li><em>param</em> <code>name</code>: the name of the generated macro (as a reference lookup, i.e. a name, not a string).</li>
<li><em>param</em> <code>doc</code>: the litteral string of the documentation for the generated macro.</li>
<li><em>returns</em> a macro that will add the given annotation to a golo element</li>
</ul>
<p>See also <a href="#extractAnnotationArguments_2"><code>extractAnnotationArguments</code></a> and <a href="#annotateElements_3v"><code>annotateElements</code></a></p>

    </div>
  



  <h2 id="functions">Functions</h2>
  
    <h3 id="addAnnotationMetadata_3">addAnnotationMetadata(annotationClass, args, target)<a class="permalink" href="#addAnnotationMetadata_3" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-54" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Adds an annotation metadata to an element.</p>
<p>This is a low-level function, no check is done.</p>
<p>See <a href="#annotateElements_3v"><code>annotateElements</code></a> for a higher level function.</p>
<ul>
<li><em>param</em> <code>annotationClass</code>: the class of the annotation to add</li>
<li><em>param</em> <code>args</code>: a map representing the annotation arguments</li>
<li><em>param</em> <code>target</code>: the element to annotate</li>
<li><em>returns</em> the element itself</li>
</ul>
<p>See <a href="#extractAnnotationArguments_2"><code>extractAnnotationArguments</code></a>.</p>

    </div>
  
    <h3 id="annotateElements_3v">annotateElements(annotationClass, args, elts...)<a class="permalink" href="#annotateElements_3v" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-247" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Adds an annotation to the given elements.</p>
<p>This function correctly deal with several elements by returning a <code>ToplevelElements</code>, and can therefore be used directly
by a macro.</p>
<p>The properties of the annotation are given in a map as returned by <a href="#extractAnnotationArguments_2"><code>extractAnnotationArguments</code></a>.
For instance, to have the equivalent of the Java code:</p>
<pre class="listing"><code class="lang-java" data-lang="java">@mypackage.MyAnnotation(prop1="hello", prop2=42)
public static Object foo() {
  return null;
}
</code></pre>
<p>one should annotate the <code>foo</code> function definition IR with:</p>
<pre class="listing"><code class="lang-golo" data-lang="golo">annotateElements(
    mypackage.MyAnnotation.class,
    map[
      ["prop1", "hello"],
      ["prop2", 42]
    ],
    theFooIR)
</code></pre>
<ul>
<li><em>param</em> <code>annotationClass</code>: The class of the annotation.</li>
<li><em>param</em> <code>args</code>: a map of the properties of the annotation.</li>
<li><em>param</em> <code>elts</code>: the IR elements to annotate.</li>
<li><em>returns</em> the annotated element itself if there is only one, or a <code>ToplevelElements</code> if there are several.</li>
</ul>
<p>See <a href="#annotationWrapper_3"><code>annotationWrapper</code></a>, <a href="#extractAnnotationArguments_2"><code>extractAnnotationArguments</code></a></p>

    </div>
  
    <h3 id="checkApplicableTo_2">checkApplicableTo(annotationClass, target)<a class="permalink" href="#checkApplicableTo_2" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-288" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Checks if a Java annotation can be applied to a golo element.</p>
<p>Inspect the annotation's <code>Target</code> annotation.</p>
<ul>
<li><em>param</em> <code>annotationClass</code>: the class of the Java annotation</li>
<li><em>param</em> <code>target</code>: the golo IR element to annotate</li>
<li><em>throws</em> an exception if the element can't be annotated.</li>
</ul>

    </div>
  
    <h3 id="extractAnnotationArguments_2">extractAnnotationArguments(annotation, args)<a class="permalink" href="#extractAnnotationArguments_2" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-361" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Parse the macro arguments according to an annotation class.</p>
<p>The named arguments of the macro are matched with the annotation fields.
If the annotation has at most one field, positional argument can be used.
The named is extracted using reflection on the annotation class.
The annotation fields are returned in a map of the name and values</p>
<ul>
<li><em>param</em> <code>annotation</code>: the annotation class</li>
<li><em>param</em> <code>args</code>: the full array of arguments of the macro</li>
<li><em>returns</em> a tuple containing a map of named arguments,<pre class="listing"><code class="lang-golo" data-lang="golo">    a map of named arguments not recognized by the annotation,
    and an array of elements to annotate
</code></pre>
</li>
</ul>
<p>See <a href="../macros/Utils.html#parseArguments_1"><code>parseArguments</code></a>,</p>
<pre class="listing"><code class="lang-golo" data-lang="golo">[`getLiteralValue`](../macros/Utils.html#getLiteralValue_1)
</code></pre>

    </div>
  
    <h3 id="makeDeprecated_3v">makeDeprecated(since, comment, elts...)<a class="permalink" href="#makeDeprecated_3v" title="link to this section">&#182;</a></h3><nav class="srclink"><a href="Annotations-src.html#l-84" rel="source" title="Link to the corresponding source">Source</a></nav>
    <div class="golodoc">
      <p>Mark the element as deprecated, by setting the <code>deprecated</code> metadata and adding
the <code>java.lang.Deprecated</code> annotation.
Indeed, the annotation by itself is not sufficient, since a bytecode flag must also be set for the element to be
considered deprecated by the Java compiler. The bytecode generator use the <code>deprecated</code> metadata to set this flag.</p>
<p>Moreover, the documentation of the concerned element is also updated to document the deprecation.</p>
<p>Can be applied to function declarations, types, or augmentations.
Otherwise, the element is returned unchanged.</p>
<ul>
<li><em>param</em> <code>since</code>: the version in which the element became deprecated.</li>
<li><em>param</em> <code>comment</code>: a comment to append to the element documentation.</li>
<li><em>param</em> <code>elts</code>: the element to mark as deprecated.</li>
<li><em>returns</em> the elements, wrapped in a <code>ToplevelElements</code> if required</li>
</ul>
<p>This function should not need to be called directly.
Use the <a href="../macros.html#deprecated_1v"><code>gololang.macros::deprecated</code></a> macro instead</p>

    </div>
  


<link rel="stylesheet" href="http://golo-lang.org/documentation/next/styles/github.min.css"/>
<script src="http://golo-lang.org/documentation/next/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>
